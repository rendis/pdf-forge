import{ac as se,r as t,j as e,A as J,m as E,e as T,L as ve,X as be,ad as je}from"./index-B8Ga1Y4S.js";import{C as Q,F as re,c as Ne,d as ae,a as P,f as ye,u as we,g as Z,e as Se,v as ke,R as Ce,S as Ee,L as Ie,b as De,I as Re}from"./ImportValidationDialog-CQmDOHCR.js";import{u as L,e as Te}from"./dropdown-menu-B7qwKr18.js";import{F as Fe}from"./file-text-B8zcgY8E.js";import{B}from"./button-rKxiF78C.js";import{C as G}from"./circle-alert-D4Eu6p8n.js";import{R as Pe,P as Be,O as Le,C as _e,T as Ae,D as Me,a as Oe}from"./index-CDh6BRB2.js";import{g as Ve,h as ze,i as ee,j as te}from"./badge-hUvqyhUT.js";import{d as ne}from"./send-CXE85jxD.js";import{v as oe}from"./templates-api-CWSj1hvb.js";import"./page-transition-store-DuNvn-qo.js";import"./dialog-U4ZKjE_C.js";import{A as Ue}from"./arrow-left-DifWTf-j.js";import"./index-BGeAJ-xm.js";import"./label-CW3RntpI.js";import"./scroll-area-z1lPWght.js";import"./index-BdQq_4o_.js";import"./select-CvAe_b8K.js";import"./index-DvEvrN1E.js";import"./chevron-down-CZ299nQu.js";import"./chevron-left-Dm9LmvfD.js";import"./plus-D9CgxYyM.js";import"./trash-2-Gp3AXfLc.js";import"./list-PJN3saQF.js";import"./ellipsis-bZq0jd_Y.js";import"./square-check-big-DUdsvLXC.js";import"./variable-D7O4VVy2.js";import"./search-BywKWcvQ.js";import"./arrow-right-DI377DKf.js";import"./layers-D6h6D_i1.js";import"./i18n-o03nGOaq.js";import"./clock-BW3eXK1V.js";import"./folder-open-Db6vEPle.js";import"./power-Dbo-bYWT.js";import"./square-pen-CJNsZW2Z.js";import"./trash-BtePnFAf.js";function Je(s,a){if(s===void 0)return{shouldBlockFn:()=>!0,withResolver:!1};if("shouldBlockFn"in s)return s;if(typeof s=="function")return{shouldBlockFn:async()=>await s(),enableBeforeUnload:!0,withResolver:!1};const i=!!(s.condition??!0),c=s.blockerFn;return{shouldBlockFn:async()=>i&&c!==void 0?await c():i,enableBeforeUnload:i,withResolver:c===void 0}}function $e(s,a){const{shouldBlockFn:i,enableBeforeUnload:c=!0,disabled:l=!1,withResolver:r=!1}=Je(s),d=se(),{history:n}=d,[h,g]=t.useState({status:"idle",current:void 0,next:void 0,action:void 0,proceed:void 0,reset:void 0});return t.useEffect(()=>{const o=async p=>{function j(w){const k=d.parseLocation(w),S=d.getMatchedRoutes(k.pathname);return S.foundRoute===void 0?{routeId:"__notFound__",fullPath:k.pathname,pathname:k.pathname,params:S.routeParams,search:d.options.parseSearch(w.search)}:{routeId:S.foundRoute.id,fullPath:S.foundRoute.fullPath,pathname:k.pathname,params:S.routeParams,search:d.options.parseSearch(w.search)}}const N=j(p.currentLocation),f=j(p.nextLocation);if(N.routeId==="__notFound__"&&f.routeId!=="__notFound__")return!1;const u=await i({action:p.action,current:N,next:f});if(!r)return u;if(!u)return!1;const v=await new Promise(w=>{g({status:"blocked",current:N,next:f,action:p.action,proceed:()=>w(!1),reset:()=>w(!0)})});return g({status:"idle",current:void 0,next:void 0,action:void 0,proceed:void 0,reset:void 0}),v};return l?void 0:n.block({blockerFn:o,enableBeforeUnload:c})},[i,c,l,r,n,d]),h}function He(s){return s?s.status==="PUBLISHED"?"PUBLISHED":s.status==="ARCHIVED"?"ARCHIVED":s.scheduledPublishAt?"SCHEDULED":"DRAFT":"DRAFT"}function Ge(s){return He(s)==="DRAFT"}function Xe({isVisible:s,documentName:a}){const{t:i}=L();return e.jsx(J,{children:s&&e.jsx(E.div,{initial:{opacity:1},exit:{opacity:0},transition:{duration:.4,ease:"easeOut"},className:"fixed inset-0 z-50 flex items-center justify-center bg-background",children:e.jsxs(E.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.3,ease:"easeOut"},className:"flex flex-col items-center gap-6",children:[e.jsxs("div",{className:"relative",children:[e.jsx(E.div,{animate:{scale:[1,1.15,1],opacity:[.12,.04,.12]},transition:{duration:2.5,repeat:1/0,ease:"easeInOut"},className:"absolute inset-0 rounded-2xl bg-muted-foreground",style:{margin:"-16px"}}),e.jsx("div",{className:"relative flex h-14 w-14 items-center justify-center rounded-xl bg-secondary border border-border shadow-sm",children:e.jsx(Fe,{className:"h-6 w-6 text-muted-foreground"})})]}),e.jsxs("div",{className:"flex flex-col items-center gap-2 text-center min-h-[52px]",children:[e.jsx("h2",{className:"text-base font-medium text-foreground",children:i("editor.preparation.title","Preparando documento")}),a&&e.jsx("p",{className:"text-sm text-muted-foreground max-w-[280px] truncate",children:a})]}),e.jsx("div",{className:"h-0.5 w-32 overflow-hidden rounded-full bg-border",children:e.jsx(E.div,{animate:{x:["-100%","100%"]},transition:{duration:1.5,repeat:1/0,ease:"easeInOut"},className:"h-full w-1/2 rounded-full bg-muted-foreground/50"})})]})})})}function Ye(s,a){const c=new Date().getTime()-s.getTime(),l=Math.floor(c/1e3),r=Math.floor(l/60);return l<5?a("editor.autoSave.justNow")||"ahora mismo":l<60?a("editor.autoSave.secondsAgo",{count:l})||`hace ${l}s`:r<60?a("editor.autoSave.minutesAgo",{count:r})||`hace ${r}m`:s.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}const qe=[.4,0,.2,1],Ke=[.4,0,1,1],We={initial:{opacity:0,x:30,filter:"blur(4px)"},animate:{opacity:1,x:0,filter:"blur(0px)",transition:{duration:.5,ease:qe}},exit:{opacity:0,x:30,filter:"blur(4px)",transition:{duration:.4,ease:Ke}}},Qe={type:"spring",stiffness:150,damping:20,duration:.6},Ze=[.34,1.56,.64,1],et=[.4,0,1,1],tt={initial:{scale:.5,opacity:0},animate:{scale:1,opacity:1,transition:{duration:.4,ease:Ze}},exit:{scale:.5,opacity:0,transition:{duration:.25,ease:et}}};function st({status:s}){const a={idle:e.jsx(Q,{className:"h-4 w-4 text-muted-foreground"}),pending:e.jsx(Q,{className:"h-4 w-4 text-muted-foreground"}),saving:e.jsx(ve,{className:"h-4 w-4 text-primary animate-spin"}),saved:e.jsx(Te,{className:"h-4 w-4 text-green-600 dark:text-green-500"}),error:e.jsx(G,{className:"h-4 w-4 text-destructive"})};return e.jsx(E.div,{layoutId:"save-status-icon",className:"flex items-center justify-center w-5 h-5",transition:Qe,children:e.jsx(J,{mode:"wait",children:e.jsx(E.div,{variants:tt,initial:"initial",animate:"animate",exit:"exit",children:a[s]},s)})})}function rt({status:s,lastSavedAt:a,error:i,onRetry:c,className:l}){const{t:r}=L(),d=()=>{switch(s){case"idle":return a?`${r("editor.autoSave.saved")||"Guardado"} ${Ye(a,r)}`:null;case"pending":return r("editor.autoSave.pending")||"Sin guardar...";case"saving":return r("editor.autoSave.saving")||"Guardando...";case"saved":return r("editor.autoSave.saved")||"Guardado";case"error":return r("editor.autoSave.error")||"Error al guardar";default:return null}},n=()=>{switch(s){case"idle":case"pending":return"text-muted-foreground";case"saving":return"text-primary";case"saved":return"text-green-600 dark:text-green-500";case"error":return"text-destructive";default:return"text-muted-foreground"}},h=d();return e.jsxs(E.div,{layout:!0,className:T("flex items-center gap-2 text-xs h-5 min-w-[120px] justify-end overflow-hidden",s==="idle"&&"opacity-60",l),children:[e.jsx(J,{mode:"wait",children:h&&e.jsx(E.span,{className:T("whitespace-nowrap",n()),variants:We,initial:"initial",animate:"animate",exit:"exit",children:h},`${s}-${h}`)}),e.jsx(st,{status:s}),e.jsx(J,{children:s==="error"&&c&&e.jsx(E.div,{initial:{opacity:0,scale:.8,x:20},animate:{opacity:1,scale:1,x:0},exit:{opacity:0,scale:.8,x:20},transition:{duration:.3,ease:"easeOut"},children:e.jsx(B,{variant:"ghost",size:"sm",className:"h-5 px-1.5 text-xs text-destructive hover:text-destructive",onClick:c,children:r("common.retry")||"Reintentar"})})})]})}function at({onDocumentReady:s}){const{t:a}=L(),i=t.useRef(null),[c,l]=t.useState(null),[r,d]=t.useState(null),[n,h]=t.useState(!1),g=t.useCallback(()=>{var u;(u=i.current)==null||u.click()},[]),o=t.useCallback(async u=>{if(d(null),l(null),h(!1),!u.name.endsWith(".json")){const x=a("editor.import.invalidFileType");d(x),s(null,x);return}try{const x=await u.text(),v=JSON.parse(x);l(u.name),s(v)}catch{const x=a("editor.import.invalidJson");d(x),s(null,x)}},[s,a]),p=t.useCallback(async u=>{var v;const x=(v=u.target.files)==null?void 0:v[0];x&&(await o(x),i.current&&(i.current.value=""))},[o]),j=t.useCallback(u=>{u.preventDefault(),u.stopPropagation(),h(!0)},[]),N=t.useCallback(u=>{u.preventDefault(),u.stopPropagation(),h(!1)},[]),f=t.useCallback(async u=>{u.preventDefault(),u.stopPropagation();const x=u.dataTransfer.files[0];if(!x){h(!1);return}await o(x)},[o]);return e.jsxs("div",{className:"space-y-4",children:[e.jsx("input",{ref:i,type:"file",accept:".json",onChange:p,className:"hidden"}),e.jsxs("div",{onClick:g,onDragOver:j,onDragLeave:N,onDrop:f,className:T("w-full flex flex-col items-center justify-center gap-3 p-8 border-2 border-dashed rounded-lg cursor-pointer transition-colors",n?"border-primary bg-primary/5":"border-border hover:border-foreground/50 hover:bg-muted/50"),children:[e.jsx("div",{className:T("p-3 rounded-full transition-colors",n?"bg-primary/10":"bg-muted"),children:e.jsx(re,{className:T("h-6 w-6",n?"text-primary":"text-muted-foreground")})}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:T("text-sm font-medium",n&&"text-primary"),children:a(n?"editor.import.dropHere":"editor.import.fileTabDescription")}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:a("editor.import.acceptedFormat")})]})]}),c&&!r&&e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-success-muted border border-success-border rounded-lg",children:[e.jsx(Ne,{className:"h-5 w-5 text-success"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-success-foreground truncate",children:c}),e.jsx("p",{className:"text-xs text-success-foreground/80",children:a("editor.import.fileSelected")})]}),e.jsx(ne,{className:"h-5 w-5 text-success"})]}),r&&e.jsx("div",{className:"p-3 bg-destructive/10 border border-destructive/20 rounded-lg",children:e.jsx("p",{className:"text-sm text-destructive",children:r})})]})}function nt({onDocumentReady:s}){const{t:a}=L(),[i,c]=t.useState(""),[l,r]=t.useState(null),[d,n]=t.useState(null),h=t.useCallback(()=>{if(!i.trim()){n(a("editor.import.emptyContent")),r(!1),s(null);return}try{const p=JSON.parse(i);r(!0),n(null),s(p)}catch{const p=a("editor.import.invalidJson");n(p),r(!1),s(null,p)}},[i,s,a]),g=t.useCallback(p=>{c(p.target.value),l!==null&&(r(null),n(null),s(null))},[l,s]),o=t.useCallback(async()=>{try{const p=await navigator.clipboard.readText();c(p),r(null),n(null),s(null)}catch{}},[s]);return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("label",{className:"text-sm font-medium",children:a("editor.import.pasteLabel")}),e.jsxs(B,{type:"button",variant:"ghost",size:"sm",onClick:o,className:"h-7 px-2 text-xs",children:[e.jsx(ae,{className:"h-3 w-3 mr-1"}),a("editor.import.pasteFromClipboard")]})]}),e.jsx("textarea",{value:i,onChange:g,placeholder:a("editor.import.pastePlaceholder"),className:"w-full h-48 p-3 text-sm font-mono bg-muted border border-border rounded-lg resize-none focus:outline-none focus:ring-2 focus:ring-ring"})]}),e.jsx(B,{type:"button",variant:"outline",onClick:h,disabled:!i.trim(),className:"w-full",children:a("editor.import.parseButton")}),l===!0&&e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-success-muted border border-success-border rounded-lg",children:[e.jsx(ne,{className:"h-5 w-5 text-success"}),e.jsx("p",{className:"text-sm text-success-foreground",children:a("editor.import.jsonValid")})]}),d&&e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-destructive/10 border border-destructive/20 rounded-lg",children:[e.jsx(G,{className:"h-5 w-5 text-destructive"}),e.jsx("p",{className:"text-sm text-destructive",children:d})]})]})}function ot({open:s,onOpenChange:a,onImport:i}){const{t:c}=L(),[l,r]=t.useState("file"),[d,n]=t.useState(null),[h,g]=t.useState(null);t.useEffect(()=>{s&&(n(null),g(null),r("file"))},[s]);const o=t.useCallback((f,u)=>{n(f),g(u||null)},[]),p=t.useCallback(()=>{d&&(i(d),a(!1))},[d,i,a]),j=t.useCallback(()=>{n(null),g(null),r("file"),a(!1)},[a]),N=t.useCallback(f=>{r(f),n(null),g(null)},[]);return e.jsx(Pe,{open:s,onOpenChange:j,children:e.jsxs(Be,{children:[e.jsx(Le,{className:"fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0"}),e.jsxs(_e,{className:T("fixed left-[50%] top-[50%] z-50 w-full max-w-lg translate-x-[-50%] translate-y-[-50%] border border-border bg-background p-0 shadow-lg duration-200","data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95"),children:[e.jsxs("div",{className:"flex items-start justify-between border-b border-border p-6",children:[e.jsxs("div",{children:[e.jsx(Ae,{className:"font-mono text-sm font-medium uppercase tracking-widest text-foreground",children:c("editor.import.title")}),e.jsx(Me,{className:"mt-1 text-sm font-light text-muted-foreground",children:c("editor.import.description")})]}),e.jsxs(Oe,{className:"text-muted-foreground transition-colors hover:text-foreground",children:[e.jsx(be,{className:"h-5 w-5"}),e.jsx("span",{className:"sr-only",children:c("common.close")})]})]}),e.jsxs("div",{className:"p-6",children:[e.jsxs(Ve,{value:l,onValueChange:f=>N(f),children:[e.jsxs(ze,{className:"grid w-full grid-cols-2 rounded-none",children:[e.jsxs(ee,{value:"file",className:"gap-2 rounded-none font-mono text-xs uppercase tracking-wider",children:[e.jsx(re,{className:"h-4 w-4"}),c("editor.import.tabs.file")]}),e.jsxs(ee,{value:"paste",className:"gap-2 rounded-none font-mono text-xs uppercase tracking-wider",children:[e.jsx(ae,{className:"h-4 w-4"}),c("editor.import.tabs.paste")]})]}),e.jsx(te,{value:"file",className:"mt-4 min-h-[340px]",children:e.jsx(at,{onDocumentReady:o})}),e.jsx(te,{value:"paste",className:"mt-4 min-h-[340px]",children:e.jsx(nt,{onDocumentReady:o})})]}),h&&!["file","paste"].includes(l)&&e.jsx("div",{className:"mt-4 p-3 bg-destructive/10 border border-destructive/20 rounded-md",children:e.jsx("p",{className:"text-sm text-destructive",children:h})})]}),e.jsxs("div",{className:"flex justify-end gap-3 border-t border-border p-6",children:[e.jsx("button",{type:"button",onClick:j,className:"rounded-none border border-border bg-background px-6 py-2.5 font-mono text-xs uppercase tracking-wider text-muted-foreground transition-colors hover:border-foreground hover:text-foreground",children:c("common.cancel")}),e.jsx("button",{type:"button",onClick:p,disabled:!d,className:"rounded-none bg-foreground px-6 py-2.5 font-mono text-xs uppercase tracking-wider text-background transition-colors hover:bg-foreground/90 disabled:opacity-50 disabled:cursor-not-allowed",children:c("editor.import.importDocument")})]})]})]})})}const it=2e3,ct=2,lt=3e3;function ut({editor:s,templateId:a,versionId:i,enabled:c,debounceMs:l=it,meta:r}){const[d,n]=t.useState("idle"),[h,g]=t.useState(null),[o,p]=t.useState(null),[j,N]=t.useState(!1),f=t.useRef(null),u=t.useRef(null),x=t.useRef(0),v=t.useRef(!1),w=P(b=>b.pageSize),k=P(b=>b.margins),S=t.useMemo(()=>({pageSize:w,margins:k}),[w,k]);t.useEffect(()=>()=>{f.current&&clearTimeout(f.current),u.current&&clearTimeout(u.current)},[]);const I=t.useCallback(async()=>{if(!(!s||!c||v.current)){v.current=!0,n("saving"),p(null);try{const b={title:(r==null?void 0:r.title)||"Untitled",description:r==null?void 0:r.description,language:(r==null?void 0:r.language)||"es",customFields:r==null?void 0:r.customFields},$=ye(s,{pagination:S},b,{includeChecksum:!0});await oe.update(a,i,{contentStructure:$}),n("saved"),g(new Date),N(!1),x.current=0,u.current&&clearTimeout(u.current),u.current=setTimeout(()=>{n("idle")},lt)}catch(b){const O=b instanceof Error?b:new Error("Save failed");if(x.current<ct){x.current++,v.current=!1,setTimeout(()=>I(),1e3);return}n("error"),p(O),x.current=0}finally{v.current=!1}}},[s,c,a,i,r,S]),_=t.useCallback(async()=>{f.current&&(clearTimeout(f.current),f.current=null),await I()},[I]),A=t.useCallback(()=>{p(null),n(j?"pending":"idle")},[j]),M=t.useCallback(()=>{c&&(N(!0),n("pending"),f.current&&clearTimeout(f.current),f.current=setTimeout(()=>{f.current=null,I()},l))},[c,l,I]);return t.useEffect(()=>{if(!s||!c)return;const b=()=>{M()};return s.on("update",b),()=>{s.off("update",b)}},[s,c,M]),{status:d,lastSavedAt:h,error:o,isDirty:j,save:_,resetError:A}}function dt({isDirty:s,status:a,save:i,enabled:c=!0}){const l=t.useRef(!1),r=s||a==="pending",d=t.useCallback(async()=>{if(!r||l.current)return!1;l.current=!0;try{await i()}catch(n){console.warn("Failed to save on navigation:",n)}finally{l.current=!1}return!1},[r,i]);$e({shouldBlockFn:d,disabled:!c,enableBeforeUnload:c&&r})}function Yt(){const{workspaceId:s,templateId:a,versionId:i}=je.useParams(),c=se(),{t:l}=L(),{variables:r}=we(),d=t.useRef(null),[n,h]=t.useState(null),g=t.useRef(!1),[o,p]=t.useState(null),[j,N]=t.useState(!0),[f,u]=t.useState(null),[x,v]=t.useState(null),[w,k]=t.useState(!1),[S,I]=t.useState(null),[_,A]=t.useState(null),[M,b]=t.useState(!1),[O,$]=t.useState(!0),[X,ie]=t.useState(!1),[Y,ce]=t.useState(!1);t.useRef(Date.now());const q=t.useRef(!1),K=t.useRef(null),H=t.useCallback(async()=>{N(!0),u(null),v(null),g.current=!1;try{const m=await oe.get(a,i);p(m)}catch(m){console.error("Failed to fetch version:",m),u(m instanceof Error?m:new Error("Failed to load version"))}finally{N(!1)}},[a,i]);t.useEffect(()=>{const m=`${a}:${i}`;q.current&&K.current===m||(q.current=!0,K.current=m,H())},[H,a,i]);const D=Ge(o),F=t.useCallback(()=>r.map(m=>({id:m.id,variableId:m.variableId,type:m.type,label:m.label})),[r]),V=t.useCallback(()=>({setPaginationConfig:m=>{const{pageSize:y,margins:R}=m;y&&P.getState().setPageSize(y),R&&P.getState().setMargins(R)}}),[]),z=t.useCallback(m=>{if(!n)return;const y=Z(m,n,V(),F());y.success||console.error("Import failed:",y.validation.errors),b(!1),A(null),I(null)},[n,V,F]),le=t.useCallback(()=>{if(!n)return;const m={pagination:{pageSize:P.getState().pageSize,margins:P.getState().margins}},y={title:(o==null?void 0:o.name)||"Document",language:"es"},R=`${(o==null?void 0:o.name)||"document"}.json`;Se(n,m,y,R)},[n,o]),ue=t.useCallback(()=>{n&&k(!0)},[n]),de=t.useCallback(m=>{const y=ke(m,F());if(!y.valid||y.warnings.length>0){I(y),A(m),b(!0);return}z(m)},[F,z]),me=t.useCallback(()=>{_&&z(_)},[_,z]);t.useEffect(()=>{if(!d.current||!o||g.current)return;const m=d.current;if(!(o.contentStructure&&Object.keys(o.contentStructure).length>0)){g.current=!0;return}const R=o.contentStructure,U=Z(R,m,V(),F());if(!U.success){const he=U.validation.errors.map(ge=>ge.message).join(", ");v(he||l("editor.errors.importFailed")),console.error("Import failed:",U.validation.errors),console.error("Import failed - Full errors:",JSON.stringify(U.validation.errors,null,2)),console.error("Import failed - Document:",JSON.stringify(R,null,2))}g.current=!0},[o,d.current,F,V]);const C=ut({editor:n,templateId:a,versionId:i,enabled:D&&g.current,debounceMs:2e3,meta:{title:(o==null?void 0:o.name)||l("editor.document"),language:"es"}});dt({isDirty:C.isDirty,status:C.status,save:C.save,enabled:D});const W=t.useCallback(async()=>{await C.save()},[C]),fe=2e3;t.useEffect(()=>{const m=setTimeout(()=>{ce(!0)},fe);return()=>clearTimeout(m)},[]),t.useEffect(()=>{X&&Y&&requestAnimationFrame(()=>{$(!1)})},[X,Y]);const pe=t.useCallback(()=>{ie(!0)},[]);if(f||x)return e.jsxs("div",{className:"flex flex-col h-full bg-background items-center justify-center",children:[e.jsx(G,{className:"h-8 w-8 text-destructive"}),e.jsx("p",{className:"mt-4 text-sm text-destructive",children:(f==null?void 0:f.message)||x||l("editor.errors.versionLoadFailed")}),e.jsxs(B,{variant:"outline",size:"sm",className:"mt-4",onClick:()=>{v(null),H()},children:[e.jsx(Ce,{className:"h-4 w-4 mr-2"}),l("common.retry")||"Reintentar"]})]});const xe=j||O;return e.jsxs(e.Fragment,{children:[e.jsx(Xe,{isVisible:xe,documentName:o==null?void 0:o.name}),e.jsxs("div",{className:"flex flex-col h-[calc(100vh-4rem)]",children:[e.jsxs("header",{className:"flex items-center justify-between px-4 py-2 border-b bg-card",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(B,{variant:"ghost",size:"icon",onClick:()=>c.history.back(),children:e.jsx(Ue,{className:"h-4 w-4"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-sm font-semibold",children:(o==null?void 0:o.name)||"Editor"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-xs text-muted-foreground",children:["v",(o==null?void 0:o.versionNumber)||i]}),D&&e.jsx("span",{className:"text-[10px] bg-primary/10 text-primary px-1.5 py-0.5 rounded",children:l("editor.status.editable")})]})]})]}),e.jsx("div",{className:"flex items-center gap-3",children:D&&e.jsxs(e.Fragment,{children:[e.jsx(rt,{status:C.status,lastSavedAt:C.lastSavedAt,error:C.error,onRetry:W}),e.jsxs(B,{size:"sm",variant:"outline",onClick:W,disabled:C.status==="saving",children:[e.jsx(Ee,{className:"h-4 w-4 mr-2"}),l("common.save")||"Guardar"]})]})})]}),!D&&e.jsxs("div",{className:"flex items-center justify-center gap-2 px-4 py-2 bg-warning-muted border-b border-warning-border",children:[e.jsx(Ie,{className:"h-4 w-4 text-warning-foreground"}),e.jsx("span",{className:"text-sm font-medium text-warning-foreground",children:l("editor.status.readOnlyBanner")})]}),e.jsx("div",{className:"flex-1 overflow-hidden",children:!j&&e.jsx(De,{initialContent:"",editable:D,variables:r,editorRef:d,onEditorReady:h,onFullyReady:pe,onExport:D?le:void 0,onImport:D?ue:void 0,templateId:a,versionId:i},"editor")})]}),e.jsx(ot,{open:w,onOpenChange:k,onImport:de}),S&&e.jsx(Re,{open:M,onOpenChange:b,validation:S,onConfirm:me})]})}export{Yt as component};
