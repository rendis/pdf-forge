import{a as d,u as F}from"./useMutation-hns_lWEu.js";import{y as m,Q as O,a as z,r as g,j as e,e as S,X as P,L as R,U as E,T as B,n as U,o as W}from"./index-B8Ga1Y4S.js";import{v as N,c as G,b as X,f as _,d as H,e as J,u as Y,a as Z,r as $,g as I,h as ee}from"./templates-api-CWSj1hvb.js";import{u as D,e as K,D as te,a as se,b as ne,d as M}from"./dropdown-menu-B7qwKr18.js";import{S as re}from"./search-BywKWcvQ.js";import{a as ae}from"./plus-D9CgxYyM.js";import{c as oe}from"./useDocumentTypes-ly4dpU7R.js";import{C as ie}from"./chevron-down-CZ299nQu.js";import{D as le,B as ue,T as ce,a as de,c as me,b as xe}from"./dialog-U4ZKjE_C.js";const x={all:["template-detail"],detail:t=>[...x.all,t]};function Se(t){return F({queryKey:x.detail(t),queryFn:()=>_(t),enabled:!!t,staleTime:300*1e3,gcTime:600*1e3})}function Ke(t){const s=m();return d({mutationFn:n=>G(t,n),onSuccess:()=>{s.invalidateQueries({queryKey:x.detail(t)}),s.invalidateQueries({queryKey:p.all})}})}function De(t){const s=m();return d({mutationFn:n=>X(t,n),onSuccess:()=>{s.invalidateQueries({queryKey:x.detail(t)}),s.invalidateQueries({queryKey:p.all})}})}function Qe(t){const s=m();return d({mutationFn:n=>N.publish(t,n),onSuccess:()=>{s.invalidateQueries({queryKey:x.detail(t)}),s.invalidateQueries({queryKey:p.all})}})}function Fe(t){const s=m();return d({mutationFn:({versionId:n,publishAt:u})=>N.schedulePublish(t,n,u),onSuccess:()=>{s.invalidateQueries({queryKey:x.detail(t)})}})}function Le(t){const s=m();return d({mutationFn:n=>N.cancelSchedule(t,n),onSuccess:()=>{s.invalidateQueries({queryKey:x.detail(t)})}})}function Me(t){const s=m();return d({mutationFn:n=>N.archive(t,n),onSuccess:()=>{s.invalidateQueries({queryKey:x.detail(t)}),s.invalidateQueries({queryKey:p.all})}})}function Ve(t){const s=m();return d({mutationFn:n=>N.delete(t,n),onSuccess:()=>{s.invalidateQueries({queryKey:x.detail(t)}),s.invalidateQueries({queryKey:p.all})}})}const p={all:["templates"],list:t=>[...p.all,"list",t]};function ze(t={}){return F({queryKey:p.list(t),queryFn:()=>ee(t),staleTime:0,gcTime:0,placeholderData:O})}function Pe(){const t=m();return d({mutationFn:s=>H(s),onSuccess:()=>{t.invalidateQueries({queryKey:p.all})}})}function Ae(){const t=m();return d({mutationFn:({templateId:s,data:n})=>Y(s,n),onSuccess:()=>{t.invalidateQueries({queryKey:p.all}),t.invalidateQueries({queryKey:x.all})}})}function Oe(){const t=m();return d({mutationFn:s=>I(s),onSuccess:()=>{t.invalidateQueries({queryKey:p.all})}})}function Re(){const t=m();return d({mutationFn:({templateId:s,tagIds:n})=>Z(s,n),onSuccess:()=>{t.invalidateQueries({queryKey:p.all}),t.invalidateQueries({queryKey:x.all})}})}function Ee(){const t=m();return d({mutationFn:({templateId:s,tagId:n})=>$(s,n),onSuccess:()=>{t.invalidateQueries({queryKey:p.all}),t.invalidateQueries({queryKey:x.all})}})}function Be(){const t=m();return d({mutationFn:({templateId:s,data:n})=>J(s,n),onSuccess:()=>{t.invalidateQueries({queryKey:p.all}),t.invalidateQueries({queryKey:x.all})}})}async function pe(){return(await z.get("/workspace/tags")).data}async function fe(t){return(await z.post("/workspace/tags",t)).data}const L={all:["tags"],list:()=>[...L.all,"list"]};function ge(){return F({queryKey:L.list(),queryFn:pe,staleTime:300*1e3})}function he(){const t=m();return d({mutationFn:s=>fe(s),onSuccess:()=>{t.invalidateQueries({queryKey:L.all})}})}const V=["#ef4444","#f97316","#eab308","#22c55e","#14b8a6","#3b82f6","#8b5cf6","#ec4899","#6b7280","#000000"];function ye({defaultName:t,onCancel:s,onSubmit:n,isLoading:u=!1}){const{t:l}=D(),[o,i]=g.useState(t),[h,j]=g.useState(V[5]??"#3b82f6"),y=()=>{o.trim().length<3||n(o.trim(),h)},f=o.trim().length>=3&&o.trim().length<=50;return e.jsxs("div",{className:"border-t border-border bg-muted/30 p-4",children:[e.jsx("div",{className:"mb-3 font-mono text-[10px] font-medium uppercase tracking-widest text-muted-foreground",children:l("tags.create.title","Create New Tag")}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"mb-1 block font-mono text-[10px] font-medium uppercase tracking-widest text-muted-foreground",children:l("tags.create.nameLabel","Name")}),e.jsx("input",{type:"text",value:o,onChange:c=>i(c.target.value),placeholder:l("tags.create.namePlaceholder","Tag name (3-50 chars)"),maxLength:50,className:"w-full rounded-none border-0 border-b border-border bg-transparent py-2 text-base font-light text-foreground outline-none transition-all placeholder:text-muted-foreground/50 focus-visible:border-foreground focus-visible:ring-0",autoFocus:!0}),o.trim().length>0&&o.trim().length<3&&e.jsx("span",{className:"mt-1 block text-xs text-destructive",children:l("tags.create.minLength","Minimum 3 characters")})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"mb-2 block font-mono text-[10px] font-medium uppercase tracking-widest text-muted-foreground",children:l("tags.create.colorLabel","Color")}),e.jsx("div",{className:"flex flex-wrap gap-2",children:V.map(c=>e.jsx("button",{type:"button",onClick:()=>j(c),className:S("flex h-7 w-7 items-center justify-center rounded-full transition-all",h===c?"ring-2 ring-foreground ring-offset-2 ring-offset-background":"hover:scale-110"),style:{backgroundColor:c},children:h===c&&e.jsx(K,{size:14,className:S("text-white")})},c))})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("button",{type:"button",onClick:s,disabled:u,className:"rounded-none border border-border bg-background px-4 py-2 font-mono text-xs uppercase tracking-wider text-muted-foreground transition-colors hover:border-foreground hover:text-foreground disabled:opacity-50",children:l("common.cancel","Cancel")}),e.jsx("button",{type:"button",onClick:y,disabled:!f||u,className:"rounded-none bg-foreground px-4 py-2 font-mono text-xs uppercase tracking-wider text-background transition-colors hover:bg-foreground/90 disabled:opacity-50",children:u?l("common.creating","Creating..."):l("tags.create.submit","Create Tag")})]})]})}function Ue({selectedTagIds:t,onSelectionChange:s}){const{t:n}=D(),{data:u,isLoading:l}=ge(),o=he(),[i,h]=g.useState(""),[j,y]=g.useState(!1),f=g.useMemo(()=>(u==null?void 0:u.data)??[],[u==null?void 0:u.data]),c=g.useMemo(()=>{if(!i.trim())return f;const r=i.toLowerCase().trim();return f.filter(a=>a.name.toLowerCase().includes(r))},[f,i]),v=g.useMemo(()=>{if(!i.trim())return!0;const r=i.toLowerCase().trim();return f.some(a=>a.name.toLowerCase()===r)},[f,i]),b=g.useMemo(()=>f.filter(r=>t.includes(r.id)),[f,t]),C=r=>{t.includes(r)?s(t.filter(a=>a!==r)):s([...t,r])},Q=r=>{s(t.filter(a=>a!==r))},w=async(r,a)=>{try{const q=await o.mutateAsync({name:r,color:a});s([...t,q.id]),y(!1),h("")}catch{}},T=()=>{y(!0)};return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"group relative",children:[e.jsx(re,{className:"absolute left-0 top-1/2 -translate-y-1/2 text-muted-foreground/50 transition-colors group-focus-within:text-foreground",size:16}),e.jsx("input",{type:"text",value:i,onChange:r=>h(r.target.value),placeholder:n("tags.searchPlaceholder","Search or create tags..."),className:"w-full rounded-none border-0 border-b border-border bg-transparent py-2 pl-6 pr-4 text-base font-light text-foreground outline-none transition-all placeholder:text-muted-foreground/50 focus-visible:border-foreground focus-visible:ring-0"})]}),e.jsxs("div",{className:"border border-border bg-background",children:[e.jsx("div",{className:"max-h-[160px] overflow-y-auto",children:l?e.jsx("div",{className:"px-4 py-3 text-sm text-muted-foreground",children:n("common.loading","Loading...")}):c.length===0&&!i.trim()?e.jsx("div",{className:"px-4 py-3 text-sm text-muted-foreground",children:n("tags.noTags","No tags available")}):e.jsxs(e.Fragment,{children:[c.map(r=>e.jsxs("button",{type:"button",onClick:()=>C(r.id),className:S("flex w-full items-center justify-between gap-3 px-4 py-2 text-left transition-colors hover:bg-muted",t.includes(r.id)?"text-foreground":"text-muted-foreground"),children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"h-3 w-3 shrink-0 rounded-full",style:{backgroundColor:r.color}}),e.jsx("span",{className:"text-sm",children:r.name})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-mono text-xs text-muted-foreground",children:r.templateCount}),t.includes(r.id)&&e.jsx(K,{size:14,className:"text-foreground"})]})]},r.id)),i.trim()&&!v&&!j&&e.jsxs("button",{type:"button",onClick:T,className:"flex w-full items-center gap-2 border-t border-border px-4 py-3 text-left text-sm text-muted-foreground transition-colors hover:bg-muted hover:text-foreground",children:[e.jsx(ae,{size:14}),e.jsx("span",{children:n("tags.createNew",'Create "{{name}}"',{name:i.trim()})})]})]})}),j&&e.jsx(ye,{defaultName:i.trim(),onCancel:()=>y(!1),onSubmit:w,isLoading:o.isPending})]}),b.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2",children:b.map(r=>e.jsxs("span",{className:"inline-flex items-center gap-1.5 border border-border bg-muted/50 px-2 py-1 text-sm",children:[e.jsx("span",{className:"h-2 w-2 rounded-full",style:{backgroundColor:r.color}}),e.jsx("span",{className:"text-foreground",children:r.name}),e.jsx("button",{type:"button",onClick:()=>Q(r.id),className:"ml-1 text-muted-foreground transition-colors hover:text-foreground",children:e.jsx(P,{size:12})})]},r.id))})]})}function k(t,s){return t[s]||t.es||t.en||Object.values(t)[0]||""}function We({currentTypeId:t,currentTypeName:s,onAssign:n,disabled:u=!1}){var r;const{t:l,i18n:o}=D(),[i,h]=g.useState(!1),[j,y]=g.useState(!1),[f,c]=g.useState(null),{data:v}=oe(1,100),b=(v==null?void 0:v.data)??[],C=s??((r=b.find(a=>a.id===t))==null?void 0:r.name)??null,Q=C?k(C,o.language):null;g.useEffect(()=>{c(null)},[t]);const w=f!==null?f:Q,T=async a=>{if(a===t){y(!1);return}if(a===null)c("");else{const q=b.find(A=>A.id===a);c(q?k(q.name,o.language):null)}h(!0);try{await n(a),y(!1)}finally{h(!1)}};return e.jsxs(te,{open:j,onOpenChange:y,children:[e.jsx(se,{asChild:!0,disabled:u||i,children:e.jsxs("button",{className:S("inline-flex min-h-[24px] items-center gap-2 text-sm transition-colors","hover:text-foreground",w?"text-foreground":"text-muted-foreground italic",(u||i)&&"cursor-not-allowed opacity-50"),children:[e.jsx("span",{children:w||l("templates.detail.noDocumentType","No type assigned")}),i?e.jsx(R,{size:12,className:"animate-spin"}):e.jsx(ie,{size:14})]})}),e.jsxs(ne,{align:"start",className:"w-72 max-w-[90vw]",children:[e.jsxs(M,{onClick:()=>T(null),className:"flex items-center justify-between",children:[e.jsx("span",{className:"italic text-muted-foreground",children:l("templates.detail.noDocumentType","No type assigned")}),t===null&&e.jsx(K,{size:14})]}),b.length>0&&e.jsx("div",{className:"my-1 border-t border-border"}),b.map(a=>e.jsxs(M,{onClick:()=>T(a.id),className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex min-w-0 flex-1 items-center gap-2",children:[e.jsx(E,{delayDuration:300,children:e.jsxs(B,{children:[e.jsx(U,{asChild:!0,children:e.jsx("span",{className:"max-w-[140px] truncate",children:k(a.name,o.language)})}),e.jsx(W,{side:"top",children:e.jsx("p",{children:k(a.name,o.language)})})]})}),e.jsx("span",{className:"shrink-0 rounded-sm border px-1 py-0.5 font-mono text-[10px] uppercase text-muted-foreground",children:a.code})]}),t===a.id&&e.jsx(K,{size:14})]},a.id)),b.length===0&&e.jsx("div",{className:"px-2 py-3 text-center text-sm text-muted-foreground",children:l("templates.detail.noDocumentTypesAvailable","No document types available")})]})]})}function Ge({open:t,conflictTemplate:s,onCancel:n,onForce:u,isLoading:l=!1}){const{t:o}=D();return e.jsx(le,{open:t,onOpenChange:i=>!i&&n(),children:e.jsxs(ue,{className:"max-w-md",children:[e.jsxs("div",{className:"flex items-start justify-between border-b border-border p-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex h-10 w-10 items-center justify-center bg-warning/10",children:e.jsx(ce,{className:"h-5 w-5 text-warning"})}),e.jsx("div",{children:e.jsx(de,{className:"font-mono text-sm font-medium uppercase tracking-widest text-foreground",children:o("templates.documentType.conflictTitle","Document type in use")})})]}),e.jsxs(me,{className:"text-muted-foreground transition-colors hover:text-foreground",children:[e.jsx(P,{className:"h-5 w-5"}),e.jsx("span",{className:"sr-only",children:"Close"})]})]}),e.jsx("div",{className:"p-6",children:e.jsx(xe,{className:"text-sm font-light text-muted-foreground",children:o("templates.documentType.conflictDescription",'This document type is already assigned to "{{title}}". Do you want to replace it? The type will be removed from the other template.',{title:s==null?void 0:s.title})})}),e.jsxs("div",{className:"flex justify-end gap-3 border-t border-border p-6",children:[e.jsx("button",{type:"button",onClick:n,disabled:l,className:"rounded-none border border-border bg-background px-6 py-2.5 font-mono text-xs uppercase tracking-wider text-muted-foreground transition-colors hover:border-foreground hover:text-foreground disabled:opacity-50",children:o("common.cancel","Cancel")}),e.jsx("button",{type:"button",onClick:u,disabled:l,className:"rounded-none bg-primary px-6 py-2.5 font-mono text-xs uppercase tracking-wider text-primary-foreground transition-colors hover:bg-primary/90 disabled:opacity-50",children:l?o("common.loading","Loading..."):o("templates.documentType.replace","Replace")})]})]})})}export{We as D,Ue as T,Re as a,Ee as b,Oe as c,ge as d,ze as e,Pe as f,Be as g,Ge as h,Me as i,Le as j,De as k,Ke as l,Ve as m,Qe as n,Fe as o,Se as p,Ae as u};
