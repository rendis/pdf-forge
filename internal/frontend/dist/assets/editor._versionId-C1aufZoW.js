import{ab as I,r as t,j as e,w as E}from"./index-B8Ga1Y4S.js";import{u as N,a as p,D as y,P as D,e as R,i as A,S as P,b as L,I as T}from"./ImportValidationDialog-CQmDOHCR.js";import"./button-rKxiF78C.js";import"./badge-hUvqyhUT.js";import"./label-CW3RntpI.js";import"./select-CvAe_b8K.js";import{u as $}from"./dropdown-menu-B7qwKr18.js";import{A as F}from"./arrow-left-DifWTf-j.js";import"./index-BGeAJ-xm.js";import"./scroll-area-z1lPWght.js";import"./index-BdQq_4o_.js";import"./index-CDh6BRB2.js";import"./file-text-B8zcgY8E.js";import"./chevron-left-Dm9LmvfD.js";import"./chevron-down-CZ299nQu.js";import"./plus-D9CgxYyM.js";import"./trash-2-Gp3AXfLc.js";import"./circle-alert-D4Eu6p8n.js";import"./list-PJN3saQF.js";import"./ellipsis-bZq0jd_Y.js";import"./send-CXE85jxD.js";import"./square-check-big-DUdsvLXC.js";import"./variable-D7O4VVy2.js";import"./search-BywKWcvQ.js";import"./arrow-right-DI377DKf.js";import"./layers-D6h6D_i1.js";import"./i18n-o03nGOaq.js";import"./clock-BW3eXK1V.js";import"./folder-open-Db6vEPle.js";import"./power-Dbo-bYWT.js";import"./square-pen-CJNsZW2Z.js";import"./trash-BtePnFAf.js";import"./dialog-U4ZKjE_C.js";import"./index-DvEvrN1E.js";function be(){const{workspaceId:x,versionId:r}=I.useParams(),{t:i}=$(),[d,u]=t.useState(!1),{variables:c}=N(),[b,m]=t.useState(!1),[g,f]=t.useState(null),a=t.useRef(null);t.useEffect(()=>{p.setState({pageSize:D.A4,margins:y})},[]);const s=t.useRef("<p>Comienza a escribir tu documento aqui...</p>"),h=t.useCallback(o=>{s.current=o},[]),v=t.useCallback(async()=>{u(!0);try{console.log("Saving content for version:",r),console.log("Content:",s.current),await new Promise(o=>setTimeout(o,500))}finally{u(!1)}},[r]),S=t.useCallback(()=>{if(!a.current)return;const o=a.current,l={pagination:p.getState()},n={title:`Version ${r}`,language:"es"},k=`documento-${r}-${Date.now()}.json`;R(o,l,n,k)},[r]),j=t.useCallback(async()=>{if(!a.current)return;const o=a.current,l={pagination:p.getState()},n=await A(o,l,c,{validateReferences:!0,autoMigrate:!0});if(n){if(n.validation.errors.length>0||n.validation.warnings.length>0){f(n),m(!0);return}o&&(s.current=o.getHTML())}},[c]),w=t.useCallback(()=>{m(!1),f(null)},[]);return e.jsxs("div",{className:"flex flex-col h-screen",children:[e.jsxs("header",{className:"flex items-center justify-between px-4 py-2 border-b bg-card",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(E,{to:"/workspace/$workspaceId/templates",params:{workspaceId:x},children:e.jsxs("button",{className:"rounded-none border border-border bg-background px-6 py-2.5 font-mono text-xs uppercase tracking-wider text-muted-foreground transition-colors hover:border-foreground hover:text-foreground flex items-center",children:[e.jsx(F,{className:"mr-2 h-4 w-4"}),i("common.back")]})}),e.jsxs("span",{className:"text-sm text-muted-foreground font-mono",children:["Version: ",r]})]}),e.jsxs("button",{onClick:v,disabled:d,className:"rounded-none bg-foreground px-6 py-2.5 font-mono text-xs uppercase tracking-wider text-background transition-colors hover:bg-foreground/90 disabled:opacity-50 flex items-center",children:[e.jsx(P,{className:"mr-2 h-4 w-4"}),i(d?"common.saving":"common.save")]})]}),e.jsx("div",{className:"flex-1 overflow-hidden",children:e.jsx(L,{initialContent:s.current,onContentChange:h,variables:c,onExport:S,onImport:j,editorRef:a},"editor")}),g&&e.jsx(T,{open:b,onOpenChange:m,validation:g.validation,onConfirm:w})]})}export{be as component};
