import{D as xt,E as as,F as rs,a as K,y as ge,j as e,e as k,L as J,r as o,G as yt,H as os,I as is,P as Nt,J as cs,K as ls,X as Ne,M as ne,N as Ze,Q as ds,b as we,u as us,m as ms}from"./index-Mn5rH39a.js";import{G as ke,B as he,C as wt,a as me,U as xs,T as ps,I as fs,b as hs,H as gs,c as bs,d as kt,S as js,P as Ct,e as Oe,f as vs,g as pt,h as ft,i as xe,j as pe}from"./badge-XElsizj0.js";import{u as $,C as ve,e as He,D as Ce,a as Se,b as Ae,d as U,f as ye,g as ys,h as Ns,i as ws}from"./dropdown-menu-C1xsa6LN.js";import{S as W}from"./skeleton-CjBijqvk.js";import{u as ks,P as Cs}from"./usePermission-B1WV5ZF6.js";import{Q as Ss,b as As,u as Xe,a as H}from"./useMutation-BMcTncMI.js";import{B as de}from"./button-CtHMO38A.js";import{D as ae,d as Te,e as Ie,a as re,b as oe,T as se,f as Ee,B as $e,c as Ye}from"./dialog-CBYldx3V.js";import{F as Be}from"./folder-open-GvK6pB0S.js";import{C as Le}from"./chevron-left-CiKzdUFh.js";import{S as Y}from"./search-C-KX9vCT.js";import{u as Ts}from"./index-DEI3p7AC.js";import{S as Is,E as Es}from"./square-check-big-8fkl3Uv1.js";import{C as Ps,T as St,F as Ds,E as zs,A as At}from"./trash-2-DIs6o-B7.js";import{S as Ms,a as Rs,b as Ls,c as Fs,d as Os}from"./sheet-D0QsWxT8.js";import{a as _e,P as Je}from"./plus-Cfv6BkAk.js";import{L as Bs}from"./layers-DKfqMMQV.js";import{C as Fe}from"./chevron-down-BYG9_VU0.js";import{P as et,a as $s,b as _s,c as Tt,u as Us}from"./useWorkspaces-DugIde-S.js";import{u as Ws,a as Ks,b as qs,c as It}from"./useDocumentTypes-CiDeVJLE.js";import{E as tt}from"./ellipsis-D73O4n5e.js";import"./index-wkqwAxKy.js";var Qs=class extends Ss{constructor(t,r){super(t,r)}bindMethods(){super.bindMethods(),this.fetchNextPage=this.fetchNextPage.bind(this),this.fetchPreviousPage=this.fetchPreviousPage.bind(this)}setOptions(t){super.setOptions({...t,behavior:xt()})}getOptimisticResult(t){return t.behavior=xt(),super.getOptimisticResult(t)}fetchNextPage(t){return this.fetch({...t,meta:{fetchMore:{direction:"forward"}}})}fetchPreviousPage(t){return this.fetch({...t,meta:{fetchMore:{direction:"backward"}}})}createResult(t,r){var h,y;const{state:a}=t,n=super.createResult(t,r),{isFetching:s,isRefetching:l,isError:i,isRefetchError:d}=n,c=(y=(h=a.fetchMeta)==null?void 0:h.fetchMore)==null?void 0:y.direction,u=i&&c==="forward",g=s&&c==="forward",p=i&&c==="backward",b=s&&c==="backward";return{...n,fetchNextPage:this.fetchNextPage,fetchPreviousPage:this.fetchPreviousPage,hasNextPage:rs(r,a.data),hasPreviousPage:as(r,a.data),isFetchNextPageError:u,isFetchingNextPage:g,isFetchPreviousPageError:p,isFetchingPreviousPage:b,isRefetchError:d&&!u&&!p,isRefetching:l&&!g&&!b}}};function Et(t,r){return As(t,Qs)}const ee="/system/injectables";async function Vs(){return(await K.get(ee)).data.injectables}async function Gs(t){await K.patch(`${ee}/${t}/activate`)}async function Hs(t){await K.patch(`${ee}/${t}/deactivate`)}async function Zs(t){return(await K.get(`${ee}/${t}/assignments`)).data.assignments}async function Xs(t,r){return(await K.post(`${ee}/${t}/assignments`,r)).data}async function Ys(t,r){await K.delete(`${ee}/${t}/assignments/${r}`)}async function Js(t,r){return(await K.patch(`${ee}/${t}/assignments/${r}/exclude`)).data}async function en(t,r){return(await K.patch(`${ee}/${t}/assignments/${r}/include`)).data}async function tn(t){return(await K.patch(`${ee}/bulk/activate`,{keys:t})).data}async function sn(t){return(await K.patch(`${ee}/bulk/deactivate`,{keys:t})).data}async function nn(t){return(await K.post(`${ee}/bulk/assignments`,t)).data}async function an(t){return(await K.delete(`${ee}/bulk/assignments`,{data:t})).data}const ue={all:["system-injectables"],lists:()=>[...ue.all,"list"],assignments:t=>[...ue.all,"assignments",t]};function ie(){const t=ge();return()=>t.invalidateQueries({queryKey:ue.lists()})}function st(t){const r=ge();return()=>r.invalidateQueries({queryKey:ue.assignments(t)})}function rn(){return Xe({queryKey:ue.lists(),queryFn:Vs,staleTime:300*1e3})}function on(t){return Xe({queryKey:ue.assignments(t??""),queryFn:()=>Zs(t),enabled:!!t,staleTime:120*1e3})}function Pt(){const t=ie();return H({mutationFn:Gs,onSuccess:t})}function Dt(){const t=ie();return H({mutationFn:Hs,onSuccess:t})}function cn(t){const r=ge();return H({mutationFn:a=>Xs(t,a),onSuccess:()=>{r.invalidateQueries({queryKey:ue.assignments(t)}),r.invalidateQueries({queryKey:ue.lists()})}})}function ln(t){const r=st(t),a=ie();return H({mutationFn:n=>Ys(t,n),onSuccess:()=>{r(),a()}})}function zt(t){const r=st(t),a=ie();return H({mutationFn:n=>Js(t,n),onSuccess:()=>{r(),a()}})}function dn(t){const r=st(t),a=ie();return H({mutationFn:n=>en(t,n),onSuccess:()=>{r(),a()}})}function un(){const t=ie();return H({mutationFn:tn,onSuccess:t})}function mn(){const t=ie();return H({mutationFn:sn,onSuccess:t})}function xn(){const t=ie();return H({mutationFn:r=>nn(r),onSuccess:t})}function pn(){const t=ie();return H({mutationFn:r=>an(r),onSuccess:t})}const fn={activate:{titleKey:"systemInjectables.bulk.confirmActivate",titleDefault:"Activate Injectables",descKey:"systemInjectables.bulk.confirmActivateDescription",descDefault:"The following {{count}} injectables will be activated globally:",warningKey:"systemInjectables.bulk.warningActivate",warningDefault:"Activated injectables will be available for assignment to workspaces.",confirmKey:"systemInjectables.bulk.activate",confirmDefault:"Activate",variant:"success"},deactivate:{titleKey:"systemInjectables.bulk.confirmDeactivate",titleDefault:"Deactivate Injectables",descKey:"systemInjectables.bulk.confirmDeactivateDescription",descDefault:"The following {{count}} injectables will be deactivated globally:",warningKey:"systemInjectables.bulk.warningDeactivate",warningDefault:"Deactivated injectables will not be available in any workspace, regardless of their assignments.",confirmKey:"systemInjectables.bulk.deactivate",confirmDefault:"Deactivate",variant:"danger"},"make-public":{titleKey:"systemInjectables.bulk.confirmMakePublic",titleDefault:"Make Injectables Public",descKey:"systemInjectables.bulk.confirmMakePublicDescription",descDefault:"The following {{count}} injectables will be made PUBLIC:",warningKey:"systemInjectables.bulk.warningMakePublic",warningDefault:"PUBLIC injectables are available to ALL workspaces without explicit assignments.",confirmKey:"systemInjectables.bulk.makePublic",confirmDefault:"Make Public",variant:"success"},"remove-public":{titleKey:"systemInjectables.bulk.confirmRemovePublic",titleDefault:"Remove Public Access",descKey:"systemInjectables.bulk.confirmRemovePublicDescription",descDefault:"PUBLIC access will be removed from the following {{count}} injectables:",warningKey:"systemInjectables.bulk.warningRemovePublic",warningDefault:"Removing PUBLIC access will restrict these injectables to their scoped assignments only.",confirmKey:"systemInjectables.bulk.removePublic",confirmDefault:"Remove Public",variant:"danger"}},hn={success:{warning:"border-warning-border bg-warning-muted",warningIcon:"text-warning",button:"bg-emerald-600 text-white hover:bg-emerald-700"},danger:{warning:"border-destructive/30 bg-destructive/10",warningIcon:"text-destructive",button:"bg-rose-600 text-white hover:bg-rose-700"},warning:{warning:"border-warning-border bg-warning-muted",warningIcon:"text-warning",button:"bg-amber-600 text-white hover:bg-amber-700"}};function gn({open:t,onOpenChange:r,action:a,selectedKeys:n,onConfirm:s,isPending:l}){const{t:i}=$(),d=n.length,c=a?fn[a]:null,u=c?hn[c.variant]:null;return e.jsx(ae,{open:t,onOpenChange:r,children:e.jsxs(Te,{className:"sm:max-w-md",children:[e.jsxs(Ie,{children:[e.jsx(re,{className:"font-mono text-sm uppercase tracking-widest",children:c&&i(c.titleKey,c.titleDefault)}),e.jsx(oe,{children:c&&i(c.descKey,c.descDefault,{count:d})})]}),e.jsx("div",{className:"max-h-48 overflow-y-auto rounded-sm border border-border bg-muted/30 p-3",children:e.jsx("ul",{className:"space-y-1",children:n.map(g=>e.jsxs("li",{className:"font-mono text-xs text-muted-foreground",children:["• ",g]},g))})}),c&&u&&e.jsxs("div",{className:k("flex items-start gap-2 rounded-sm border p-3",u.warning),children:[e.jsx(se,{size:16,className:k("mt-0.5 shrink-0",u.warningIcon)}),e.jsx("p",{className:"text-xs text-muted-foreground",children:i(c.warningKey,c.warningDefault)})]}),e.jsxs(Ee,{className:"gap-2 sm:gap-0",children:[e.jsx(de,{variant:"ghost",onClick:()=>r(!1),disabled:l,className:"font-mono text-xs uppercase",children:i("common.cancel","Cancel")}),e.jsx(de,{onClick:s,disabled:l,className:k("font-mono text-xs uppercase",u==null?void 0:u.button),children:l?e.jsxs(e.Fragment,{children:[e.jsx(J,{size:14,className:"mr-2 animate-spin"}),i("common.processing","Processing...")]}):c&&i(c.confirmKey,c.confirmDefault)})]})]})})}async function Mt(t=1,r=10,a){return(await K.get("/system/tenants",{params:{page:t,perPage:r,...a&&{q:a}}})).data}async function bn(t,r=1,a=10,n){return(await K.get(`/system/tenants/${t}/workspaces`,{params:{page:r,perPage:a,...n&&{q:n}}})).data}async function jn(t){return(await K.post("/system/tenants",t)).data}async function vn(t,r){return(await K.put(`/system/tenants/${t}`,r)).data}async function yn(t,r){return(await K.patch(`/system/tenants/${t}/status`,{status:r})).data}const Nn=10;function Rt(t){return Et({queryKey:["infinite-tenants",t],queryFn:async({pageParam:r})=>{const a=await Mt(r,Nn,t.length>=3?t:void 0);return{items:a.data.map(n=>({id:n.id,name:n.name,subtitle:n.code})),nextPage:a.pagination.page<a.pagination.totalPages?a.pagination.page+1:void 0,hasMore:a.pagination.page<a.pagination.totalPages}},getNextPageParam:r=>r.nextPage,initialPageParam:1})}const wn=10;function Lt(t,r){return Et({queryKey:["infinite-workspaces",t,r],queryFn:async({pageParam:a})=>{if(!t)return{items:[],nextPage:void 0,hasMore:!1};const n=await bn(t,a,wn,r.length>=3?r:void 0);return{items:n.data.map(s=>({id:s.id,name:s.name,subtitle:s.type})),nextPage:n.pagination.page<n.pagination.totalPages?n.pagination.page+1:void 0,hasMore:n.pagination.page<n.pagination.totalPages}},getNextPageParam:a=>a.nextPage,initialPageParam:1,enabled:!!t})}function ht({onIntersect:t,isLoading:r,hasMore:a}){const n=o.useRef(null);return o.useEffect(()=>{const s=new IntersectionObserver(l=>{l[0].isIntersecting&&a&&!r&&t()},{threshold:.1});return n.current&&s.observe(n.current),()=>s.disconnect()},[t,a,r]),a?e.jsx("div",{ref:n,className:"flex items-center justify-center p-3",children:r&&e.jsx(J,{size:16,className:"animate-spin text-muted-foreground"})}):null}function kn({open:t,onOpenChange:r,action:a,selectedKeys:n,onConfirm:s,isPending:l}){const{t:i}=$(),[d,c]=o.useState("scope"),[u,g]=o.useState(null),[p,b]=o.useState(null),[j,h]=o.useState(null),[y,A]=o.useState(""),[v,T]=o.useState("");o.useEffect(()=>{t&&(c("scope"),g(null),b(null),h(null),A(""),T(""))},[t]);const S=Rt(y),N=Lt((p==null?void 0:p.id)??null,v),f=o.useMemo(()=>{var m;return((m=S.data)==null?void 0:m.pages.flatMap(R=>R.items))??[]},[S.data]),w=o.useMemo(()=>{var m;return((m=N.data)==null?void 0:m.pages.flatMap(R=>R.items))??[]},[N.data]),z=o.useCallback(m=>{g(m),c(m==="PUBLIC"?"confirm":"tenant")},[]),P=o.useCallback(m=>{b({id:m.id,name:m.name}),c(u==="TENANT"?"confirm":"workspace")},[u]),D=o.useCallback(m=>{h({id:m.id,name:m.name}),c("confirm")},[]),_=o.useCallback(()=>{d==="confirm"?u==="PUBLIC"?c("scope"):u==="TENANT"?(b(null),c("tenant")):(h(null),c("workspace")):d==="workspace"?(b(null),c("tenant")):d==="tenant"&&(g(null),c("scope"))},[d,u]),B=o.useCallback(()=>{if(!u)return;const m={keys:n,scopeType:u,tenantId:p==null?void 0:p.id,workspaceId:j==null?void 0:j.id};s(m)},[u,n,p,j,s]),C=a==="assign",L=n.length,F=u==="PUBLIC"?"PUBLIC":u==="TENANT"?(p==null?void 0:p.name)??"TENANT":(j==null?void 0:j.name)??"WORKSPACE";return e.jsx(ae,{open:t,onOpenChange:r,children:e.jsxs(Te,{className:"sm:max-w-md",children:[e.jsxs(Ie,{children:[e.jsx(re,{className:"font-mono text-sm uppercase tracking-widest",children:C?i("systemInjectables.bulk.assignScopeTitle","Assign Scope"):i("systemInjectables.bulk.removeScopeTitle","Remove Scope Assignment")}),e.jsx(oe,{children:C?i("systemInjectables.bulk.assignScopeDescription","Create scope assignments for {{count}} selected injectables.",{count:L}):i("systemInjectables.bulk.removeScopeDescription","Remove scope assignments from {{count}} selected injectables.",{count:L})})]}),d==="scope"&&e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"mb-3 font-mono text-[10px] uppercase tracking-widest text-muted-foreground",children:i("systemInjectables.bulk.selectScope","Select scope type")}),["PUBLIC","TENANT","WORKSPACE"].map(m=>e.jsxs("button",{onClick:()=>z(m),className:"flex w-full items-center gap-3 rounded-sm border border-border p-3 text-left transition-colors hover:bg-muted",children:[m==="PUBLIC"&&e.jsx(ke,{size:16,className:"text-emerald-500"}),m==="TENANT"&&e.jsx(he,{size:16,className:"text-blue-500"}),m==="WORKSPACE"&&e.jsx(Be,{size:16,className:"text-amber-500"}),e.jsx("div",{className:"flex-1",children:e.jsx("span",{className:"font-mono text-xs uppercase tracking-wider",children:m})}),e.jsx(ve,{size:14,className:"text-muted-foreground"})]},m))]}),d==="tenant"&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("button",{onClick:_,className:"flex items-center gap-1 font-mono text-[10px] uppercase tracking-widest text-muted-foreground hover:text-foreground",children:[e.jsx(Le,{size:12}),i("common.back","Back")]}),e.jsx("p",{className:"font-mono text-[10px] uppercase tracking-widest text-muted-foreground",children:i("systemInjectables.bulk.selectTenant","Select tenant")}),e.jsxs("div",{className:"relative",children:[e.jsx(Y,{className:"absolute left-2 top-1/2 -translate-y-1/2 text-muted-foreground",size:14}),e.jsx("input",{type:"text",placeholder:i("systemInjectables.searchTenant","Search tenants (min 3 chars)..."),value:y,onChange:m=>A(m.target.value),className:"w-full rounded-sm border border-border bg-transparent py-2 pl-8 pr-3 text-sm outline-none focus:border-foreground"})]}),e.jsxs("div",{className:"max-h-60 overflow-y-auto rounded-sm border border-border",children:[f.map(m=>e.jsxs("button",{onClick:()=>P(m),className:"flex w-full items-center gap-2 border-b border-border p-3 text-left transition-colors last:border-b-0 hover:bg-muted",children:[e.jsx(he,{size:14,className:"text-muted-foreground"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm",children:m.name}),m.subtitle&&e.jsx("p",{className:"font-mono text-[10px] text-muted-foreground",children:m.subtitle})]}),e.jsx(ve,{size:14,className:"text-muted-foreground"})]},m.id)),e.jsx(ht,{onIntersect:()=>S.fetchNextPage(),isLoading:S.isFetchingNextPage,hasMore:S.hasNextPage??!1}),f.length===0&&!S.isLoading&&e.jsx("p",{className:"p-4 text-center text-xs text-muted-foreground",children:i("systemInjectables.noTenants","No tenants found")})]})]}),d==="workspace"&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("button",{onClick:_,className:"flex items-center gap-1 font-mono text-[10px] uppercase tracking-widest text-muted-foreground hover:text-foreground",children:[e.jsx(Le,{size:12}),(p==null?void 0:p.name)??i("common.back","Back")]}),e.jsx("p",{className:"font-mono text-[10px] uppercase tracking-widest text-muted-foreground",children:i("systemInjectables.bulk.selectWorkspace","Select workspace")}),e.jsxs("div",{className:"relative",children:[e.jsx(Y,{className:"absolute left-2 top-1/2 -translate-y-1/2 text-muted-foreground",size:14}),e.jsx("input",{type:"text",placeholder:i("systemInjectables.searchWorkspace","Search workspaces (min 3 chars)..."),value:v,onChange:m=>T(m.target.value),className:"w-full rounded-sm border border-border bg-transparent py-2 pl-8 pr-3 text-sm outline-none focus:border-foreground"})]}),e.jsxs("div",{className:"max-h-60 overflow-y-auto rounded-sm border border-border",children:[w.map(m=>e.jsxs("button",{onClick:()=>D(m),className:"flex w-full items-center gap-2 border-b border-border p-3 text-left transition-colors last:border-b-0 hover:bg-muted",children:[e.jsx(Be,{size:14,className:"text-muted-foreground"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm",children:m.name}),m.subtitle&&e.jsx("p",{className:"font-mono text-[10px] text-muted-foreground",children:m.subtitle})]})]},m.id)),e.jsx(ht,{onIntersect:()=>N.fetchNextPage(),isLoading:N.isFetchingNextPage,hasMore:N.hasNextPage??!1}),w.length===0&&!N.isLoading&&e.jsx("p",{className:"p-4 text-center text-xs text-muted-foreground",children:i("systemInjectables.noWorkspaces","No workspaces found")})]})]}),d==="confirm"&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("button",{onClick:_,className:"flex items-center gap-1 font-mono text-[10px] uppercase tracking-widest text-muted-foreground hover:text-foreground",children:[e.jsx(Le,{size:12}),i("common.back","Back")]}),e.jsxs("div",{className:"rounded-sm border border-border bg-muted/30 p-3",children:[e.jsx("p",{className:"font-mono text-[10px] uppercase tracking-widest text-muted-foreground",children:C?i("systemInjectables.bulk.confirmAssignSummary","Will create {{scope}} assignments for:"):i("systemInjectables.bulk.confirmRemoveSummary","Will remove {{scope}} assignments from:")}),e.jsx("p",{className:"mt-1 text-sm font-medium",children:F})]}),e.jsx("div",{className:"max-h-36 overflow-y-auto rounded-sm border border-border bg-muted/30 p-3",children:e.jsx("ul",{className:"space-y-1",children:n.map(m=>e.jsxs("li",{className:"font-mono text-xs text-muted-foreground",children:["• ",m]},m))})}),e.jsxs("div",{className:k("flex items-start gap-2 rounded-sm border p-3",C?"border-warning-border bg-warning-muted":"border-destructive/30 bg-destructive/10"),children:[e.jsx(se,{size:16,className:k("mt-0.5 shrink-0",C?"text-warning":"text-destructive")}),e.jsx("p",{className:"text-xs text-muted-foreground",children:C?i("systemInjectables.bulk.warningAssign","This will make the selected injectables available at the chosen scope."):i("systemInjectables.bulk.warningRemoveAssign","This will remove the assignments, potentially restricting injectable availability.")})]}),e.jsxs(Ee,{className:"gap-2 sm:gap-0",children:[e.jsx(de,{variant:"ghost",onClick:()=>r(!1),disabled:l,className:"font-mono text-xs uppercase",children:i("common.cancel","Cancel")}),e.jsx(de,{onClick:B,disabled:l,className:k("font-mono text-xs uppercase",C?"bg-emerald-600 text-white hover:bg-emerald-700":"bg-rose-600 text-white hover:bg-rose-700"),children:l?e.jsxs(e.Fragment,{children:[e.jsx(J,{size:14,className:"mr-2 animate-spin"}),i("common.processing","Processing...")]}):C?i("systemInjectables.bulk.confirmAssign","Create Assignments"):i("systemInjectables.bulk.confirmRemoveAssign","Remove Assignments")})]})]})]})})}var Ue="Switch",[Cn]=is(Ue),[Sn,An]=Cn(Ue),Ft=o.forwardRef((t,r)=>{const{__scopeSwitch:a,name:n,checked:s,defaultChecked:l,required:i,disabled:d,value:c="on",onCheckedChange:u,form:g,...p}=t,[b,j]=o.useState(null),h=yt(r,S=>j(S)),y=o.useRef(!1),A=b?g||!!b.closest("form"):!0,[v,T]=os({prop:s,defaultProp:l??!1,onChange:u,caller:Ue});return e.jsxs(Sn,{scope:a,checked:v,disabled:d,children:[e.jsx(Nt.button,{type:"button",role:"switch","aria-checked":v,"aria-required":i,"data-state":_t(v),"data-disabled":d?"":void 0,disabled:d,value:c,...p,ref:h,onClick:cs(t.onClick,S=>{T(N=>!N),A&&(y.current=S.isPropagationStopped(),y.current||S.stopPropagation())})}),A&&e.jsx($t,{control:b,bubbles:!y.current,name:n,value:c,checked:v,required:i,disabled:d,form:g,style:{transform:"translateX(-100%)"}})]})});Ft.displayName=Ue;var Ot="SwitchThumb",Bt=o.forwardRef((t,r)=>{const{__scopeSwitch:a,...n}=t,s=An(Ot,a);return e.jsx(Nt.span,{"data-state":_t(s.checked),"data-disabled":s.disabled?"":void 0,...n,ref:r})});Bt.displayName=Ot;var Tn="SwitchBubbleInput",$t=o.forwardRef(({__scopeSwitch:t,control:r,checked:a,bubbles:n=!0,...s},l)=>{const i=o.useRef(null),d=yt(i,l),c=Ts(a),u=ls(r);return o.useEffect(()=>{const g=i.current;if(!g)return;const p=window.HTMLInputElement.prototype,j=Object.getOwnPropertyDescriptor(p,"checked").set;if(c!==a&&j){const h=new Event("click",{bubbles:n});j.call(g,a),g.dispatchEvent(h)}},[c,a,n]),e.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:a,...s,tabIndex:-1,ref:d,style:{...s.style,...u,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});$t.displayName=Tn;function _t(t){return t?"checked":"unchecked"}var Ut=Ft,In=Bt;const nt=o.forwardRef(({className:t,...r},a)=>e.jsx(Ut,{className:k("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",t),...r,ref:a,children:e.jsx(In,{className:k("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})}));nt.displayName=Ut.displayName;const En={TEXT:bs,NUMBER:gs,DATE:Ps,CURRENCY:hs,BOOLEAN:Is,IMAGE:fs,TABLE:ps,ROLE_TEXT:xs};function Pn(t){return En[t.toUpperCase()]||kt}function Dn({injectable:t,onToggle:r,onSelect:a,canManage:n,isToggling:s,selectable:l=!1,selected:i=!1,onSelectChange:d}){const{t:c,i18n:u}=$(),g=Pn(t.dataType),p=t.label[u.language]||t.label.en||t.key,b=t.description[u.language]||t.description.en||"";function j(h){const y=h.target;if(!(y.closest("[data-switch-area]")||y.closest("[data-checkbox-area]"))){if(l){d==null||d(!i);return}a(t)}}return e.jsxs("div",{role:"button",tabIndex:0,className:k("group flex cursor-pointer items-center justify-between border-b border-border px-3 py-2.5 transition-colors hover:bg-muted/30",i&&"bg-muted/50"),onClick:j,onKeyDown:h=>{(h.key==="Enter"||h.key===" ")&&(h.preventDefault(),l?d==null||d(!i):a(t))},children:[e.jsxs("div",{className:"flex flex-1 items-center gap-3 text-left",children:[l&&e.jsx("div",{"data-checkbox-area":!0,className:"flex items-center",onClick:h=>h.stopPropagation(),children:e.jsx(wt,{checked:i,onCheckedChange:h=>d==null?void 0:d(h===!0),className:"h-4 w-4"})}),e.jsx("div",{className:"flex h-8 w-8 shrink-0 items-center justify-center rounded-sm bg-muted/50",children:e.jsx(g,{size:16,className:"text-muted-foreground"})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-medium",children:p}),e.jsx(me,{variant:"outline",className:"font-mono text-[10px] uppercase",children:t.key}),e.jsx(me,{variant:"outline",className:"font-mono text-[10px] uppercase",children:t.dataType}),t.isPublic?e.jsx(me,{variant:"secondary",className:"bg-success-muted font-mono text-[10px] uppercase text-success-foreground",children:c("systemInjectables.visibility.public","Public")}):e.jsx(me,{variant:"secondary",className:"bg-warning-muted font-mono text-[10px] uppercase text-warning-foreground",children:c("systemInjectables.visibility.scoped","Scoped")})]}),b&&e.jsx("p",{className:"mt-0.5 truncate text-xs text-muted-foreground",children:b})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{"data-switch-area":!0,className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-mono text-[10px] uppercase tracking-widest text-muted-foreground",children:t.isActive?"Active":"Inactive"}),e.jsx(nt,{checked:t.isActive,onCheckedChange:h=>r(t.key,h),disabled:!n||s,"aria-label":`Toggle ${t.key}`})]}),e.jsx(ve,{size:14,className:"text-muted-foreground transition-transform group-hover:translate-x-1"})]})]})}function zn({onIntersect:t,isLoading:r,hasMore:a}){const n=o.useRef(null);return o.useEffect(()=>{const s=new IntersectionObserver(l=>{l[0].isIntersecting&&a&&!r&&t()},{threshold:.1});return n.current&&s.observe(n.current),()=>s.disconnect()},[t,a,r]),a?e.jsx("div",{ref:n,className:"flex items-center justify-center p-3",children:r&&e.jsx(J,{size:16,className:"animate-spin text-muted-foreground"})}):null}function Mn({tenant:t,onBack:r}){const{t:a}=$();return e.jsxs("button",{type:"button",onClick:r,className:"group flex w-full items-center gap-2 border-b border-border bg-muted/30 p-3 text-left transition-colors hover:bg-muted/50",children:[e.jsx(Le,{size:16,className:"text-muted-foreground transition-transform group-hover:-translate-x-0.5"}),e.jsx(he,{size:16,className:"text-muted-foreground"}),e.jsx("span",{className:"flex-1 text-sm font-medium",children:t.name}),e.jsx("span",{className:"font-mono text-[10px] uppercase tracking-widest text-muted-foreground opacity-0 transition-opacity group-hover:opacity-100",children:a("systemInjectables.change","Change")})]})}function We({items:t,selectedId:r,onSelect:a,showArrow:n=!1,isLoading:s,hasMore:l,onLoadMore:i,emptyMessage:d}){const c=o.useRef(null);return!s&&t.length===0?e.jsx("div",{className:"flex h-[200px] items-center justify-center border border-border",children:e.jsx("span",{className:"text-sm text-muted-foreground",children:d})}):e.jsxs("div",{ref:c,className:"max-h-[240px] overflow-y-auto border border-border",children:[t.map(u=>e.jsxs("button",{type:"button",onClick:()=>a(u.id,u.name),className:k("flex w-full items-center justify-between border-b border-border p-3 text-left transition-colors last:border-b-0",r===u.id?"bg-muted/50":"hover:bg-muted/30"),children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("div",{className:"truncate text-sm font-medium",children:u.name}),u.subtitle&&e.jsx("div",{className:"font-mono text-[10px] uppercase tracking-widest text-muted-foreground",children:u.subtitle})]}),n?e.jsx(ve,{size:16,className:"shrink-0 text-muted-foreground"}):r===u.id&&e.jsx(He,{size:16,className:"shrink-0 text-foreground"})]},u.id)),e.jsx(zn,{onIntersect:i,isLoading:s,hasMore:l}),s&&t.length===0&&e.jsx("div",{className:"flex h-[200px] items-center justify-center",children:e.jsx(J,{size:20,className:"animate-spin text-muted-foreground"})})]})}function Rn({injectableKey:t,open:r,onOpenChange:a}){var ce,le;const{t:n}=$(),[s,l]=o.useState("TENANT"),[i,d]=o.useState(null),[c,u]=o.useState(null),[g,p]=o.useState("include"),[b,j]=o.useState("tenant"),[h,y]=o.useState(null),[A,v]=o.useState(""),[T,S]=o.useState(""),N=Rt(A),f=Lt((i==null?void 0:i.id)??null,T),w=((ce=N.data)==null?void 0:ce.pages.flatMap(O=>O.items))??[],z=((le=f.data)==null?void 0:le.pages.flatMap(O=>O.items))??[],P=cn(t),D=zt(t),_=s==="PUBLIC"||s==="TENANT"&&i||s==="WORKSPACE"&&i&&c,B=P.isPending||D.isPending;o.useEffect(()=>{r||(l("TENANT"),d(null),u(null),p("include"),j("tenant"),y(null),v(""),S(""))},[r]),o.useEffect(()=>{b==="tenant"&&S("")},[b]),o.useEffect(()=>{if(h){const O=setTimeout(()=>{y(null)},300);return()=>clearTimeout(O)}},[h]);function C(O){y(O==="PUBLIC"&&s!=="PUBLIC"?s:null),l(O),j("tenant"),d(null),u(null),v(""),S("")}function L(O,Z){d({id:O,name:Z}),s==="WORKSPACE"&&j("workspace")}function F(O,Z){u({id:O,name:Z})}function m(){j("tenant"),u(null),S("")}const R=o.useCallback(()=>{N.hasNextPage&&!N.isFetchingNextPage&&N.fetchNextPage()},[N]),I=o.useCallback(()=>{f.hasNextPage&&!f.isFetchingNextPage&&f.fetchNextPage()},[f]);async function q(O){if(O.preventDefault(),!_)return;const Z={scopeType:s,...s!=="PUBLIC"&&i&&{tenantId:i.id},...s==="WORKSPACE"&&c&&{workspaceId:c.id}};try{const E=await P.mutateAsync(Z);g==="exclude"&&await D.mutateAsync(E.id),G()}catch{}}function G(){a(!1),l("TENANT"),d(null),u(null),p("include"),j("tenant"),y(null),v(""),S("")}return e.jsx(ae,{open:r,onOpenChange:a,children:e.jsx($e,{className:"sm:max-w-xl",children:e.jsxs("form",{onSubmit:q,children:[e.jsxs("div",{className:"flex items-center justify-between border-b border-border p-6",children:[e.jsxs("div",{children:[e.jsx(re,{className:"font-mono text-sm font-medium uppercase tracking-widest",children:n("systemInjectables.createAssignment","Create Assignment")}),e.jsx(oe,{className:"mt-1 text-sm text-muted-foreground",children:n("systemInjectables.createAssignmentDesc","Assign this injectable to a specific scope")})]}),e.jsxs("button",{type:"button",onClick:G,className:"rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",children:[e.jsx(Ne,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Close"})]})]}),e.jsxs("div",{className:"max-h-[60vh] space-y-6 overflow-y-auto p-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{className:"font-mono text-[10px] font-medium uppercase tracking-widest text-muted-foreground",children:n("systemInjectables.scopeType","Scope Type")}),e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsxs("button",{type:"button",onClick:()=>C("PUBLIC"),className:k("flex items-center gap-2 rounded-sm border px-3 py-2 transition-colors",s==="PUBLIC"?"border-foreground bg-muted/50":"border-border hover:border-muted-foreground/50"),children:[e.jsx(ke,{size:16,className:"shrink-0 text-muted-foreground"}),e.jsx("span",{className:"text-sm font-medium",children:n("systemInjectables.public","Public")})]}),e.jsxs("button",{type:"button",onClick:()=>C("TENANT"),className:k("flex items-center gap-2 rounded-sm border px-3 py-2 transition-colors",s==="TENANT"?"border-foreground bg-muted/50":"border-border hover:border-muted-foreground/50"),children:[e.jsx(he,{size:16,className:"shrink-0 text-muted-foreground"}),e.jsx("span",{className:"text-sm font-medium",children:n("systemInjectables.tenant","Tenant")})]}),e.jsxs("button",{type:"button",onClick:()=>C("WORKSPACE"),className:k("flex items-center gap-2 rounded-sm border px-3 py-2 transition-colors",s==="WORKSPACE"?"border-foreground bg-muted/50":"border-border hover:border-muted-foreground/50"),children:[e.jsx(Be,{size:16,className:"shrink-0 text-muted-foreground"}),e.jsx("span",{className:"text-sm font-medium",children:n("systemInjectables.workspaceLabel","Workspace")})]})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("label",{className:"font-mono text-[10px] font-medium uppercase tracking-widest text-muted-foreground",children:n("systemInjectables.assignmentMode","Assignment Mode")}),e.jsxs("div",{className:"flex items-center gap-1 rounded-sm border border-border p-1",children:[e.jsxs("button",{type:"button",onClick:()=>p("include"),className:k("flex items-center gap-1.5 rounded-sm px-3 py-1.5 text-xs font-medium transition-colors",g==="include"?"bg-emerald-500/10 text-emerald-600":"text-muted-foreground hover:text-foreground"),children:[e.jsx("div",{className:k("h-2 w-2 rounded-full",g==="include"?"bg-emerald-500":"bg-muted-foreground/30")}),n("systemInjectables.include","Include")]}),e.jsxs("button",{type:"button",onClick:()=>p("exclude"),className:k("flex items-center gap-1.5 rounded-sm px-3 py-1.5 text-xs font-medium transition-colors",g==="exclude"?"bg-rose-500/10 text-rose-600":"text-muted-foreground hover:text-foreground"),children:[e.jsx("div",{className:k("h-2 w-2 rounded-full",g==="exclude"?"bg-rose-500":"bg-muted-foreground/30")}),n("systemInjectables.exclude","Exclude")]})]})]}),e.jsx("div",{className:k("grid transition-[grid-template-rows] duration-300 ease-out",s==="PUBLIC"?"grid-rows-[0fr]":"grid-rows-[1fr]"),children:e.jsxs("div",{className:"relative min-h-[340px] overflow-hidden",children:[e.jsxs("div",{className:k("space-y-3 transition-opacity duration-200",s==="TENANT"||h==="TENANT"?"relative":"pointer-events-none absolute inset-x-0 top-0",s==="TENANT"?"opacity-100":"opacity-0"),"aria-hidden":s!=="TENANT",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("label",{className:"font-mono text-[10px] font-medium uppercase tracking-widest text-muted-foreground",children:n("systemInjectables.selectTenant","Select Tenant")}),i&&e.jsx("span",{className:"font-mono text-[10px] text-foreground",children:i.name})]}),e.jsxs("div",{className:"relative",children:[e.jsx(Y,{size:16,className:"pointer-events-none absolute left-0 top-1/2 -translate-y-1/2 text-muted-foreground/50"}),e.jsx("input",{type:"text",value:A,onChange:O=>v(O.target.value),placeholder:n("systemInjectables.searchTenants","Search organizations..."),className:"w-full border-b border-border bg-transparent py-2 pl-6 pr-4 text-sm outline-none transition-colors placeholder:text-muted-foreground/50 focus-visible:border-foreground"}),A.length>0&&A.length<3&&e.jsx("span",{className:"absolute -bottom-5 left-0 text-[10px] text-muted-foreground",children:n("systemInjectables.minChars","Type at least 3 characters")})]}),e.jsx(We,{items:w,selectedId:(i==null?void 0:i.id)??null,onSelect:L,showArrow:!1,isLoading:N.isLoading||N.isFetchingNextPage,hasMore:N.hasNextPage??!1,onLoadMore:R,emptyMessage:n("systemInjectables.noTenants","No organizations found")})]}),e.jsx("div",{className:k("relative overflow-hidden transition-opacity duration-200",s==="WORKSPACE"||h==="WORKSPACE"?"relative":"pointer-events-none absolute inset-x-0 top-0",s==="WORKSPACE"?"opacity-100":"opacity-0"),"aria-hidden":s!=="WORKSPACE",children:e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:k("space-y-3 transition-all duration-200 ease-out",b==="tenant"?"relative translate-x-0 opacity-100":"absolute inset-x-0 top-0 -translate-x-full opacity-0 pointer-events-none"),children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("label",{className:"font-mono text-[10px] font-medium uppercase tracking-widest text-muted-foreground",children:n("systemInjectables.selectOrganization","Select Organization")}),e.jsx("span",{className:"font-mono text-[10px] text-muted-foreground",children:n("systemInjectables.stepOf","Step {{current}} of {{total}}",{current:1,total:2})})]}),e.jsxs("div",{className:"relative",children:[e.jsx(Y,{size:16,className:"pointer-events-none absolute left-0 top-1/2 -translate-y-1/2 text-muted-foreground/50"}),e.jsx("input",{type:"text",value:A,onChange:O=>v(O.target.value),placeholder:n("systemInjectables.searchTenants","Search organizations..."),className:"w-full border-b border-border bg-transparent py-2 pl-6 pr-4 text-sm outline-none transition-colors placeholder:text-muted-foreground/50 focus-visible:border-foreground"}),A.length>0&&A.length<3&&e.jsx("span",{className:"absolute -bottom-5 left-0 text-[10px] text-muted-foreground",children:n("systemInjectables.minChars","Type at least 3 characters")})]}),e.jsx(We,{items:w,selectedId:null,onSelect:L,showArrow:!0,isLoading:N.isLoading||N.isFetchingNextPage,hasMore:N.hasNextPage??!1,onLoadMore:R,emptyMessage:n("systemInjectables.noTenants","No organizations found")})]}),e.jsxs("div",{className:k("space-y-3 transition-all duration-200 ease-out",b==="workspace"?"relative translate-x-0 opacity-100":"absolute inset-x-0 top-0 translate-x-full opacity-0 pointer-events-none"),children:[i&&e.jsx(Mn,{tenant:i,onBack:m}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("label",{className:"font-mono text-[10px] font-medium uppercase tracking-widest text-muted-foreground",children:n("systemInjectables.selectWorkspace","Select Workspace")}),e.jsx("span",{className:"font-mono text-[10px] text-muted-foreground",children:n("systemInjectables.stepOf","Step {{current}} of {{total}}",{current:2,total:2})})]}),e.jsxs("div",{className:"relative",children:[e.jsx(Y,{size:16,className:"pointer-events-none absolute left-0 top-1/2 -translate-y-1/2 text-muted-foreground/50"}),e.jsx("input",{type:"text",value:T,onChange:O=>S(O.target.value),placeholder:n("systemInjectables.searchWorkspaces","Search workspaces..."),className:"w-full border-b border-border bg-transparent py-2 pl-6 pr-4 text-sm outline-none transition-colors placeholder:text-muted-foreground/50 focus-visible:border-foreground"}),T.length>0&&T.length<3&&e.jsx("span",{className:"absolute -bottom-5 left-0 text-[10px] text-muted-foreground",children:n("systemInjectables.minChars","Type at least 3 characters")})]}),e.jsx(We,{items:z,selectedId:(c==null?void 0:c.id)??null,onSelect:F,showArrow:!1,isLoading:f.isLoading||f.isFetchingNextPage,hasMore:f.hasNextPage??!1,onLoadMore:I,emptyMessage:n("systemInjectables.noWorkspaces","No workspaces found")})]})]})})]})})]}),e.jsxs("div",{className:"flex justify-end gap-3 border-t border-border p-6",children:[e.jsx(de,{type:"button",variant:"outline",onClick:G,className:"rounded-none font-mono text-xs uppercase",children:n("common.cancel","Cancel")}),e.jsx(de,{type:"submit",disabled:!_||B,className:k("rounded-none font-mono text-xs uppercase",g==="include"?"bg-emerald-600 text-white hover:bg-emerald-700":"bg-rose-600 text-white hover:bg-rose-700"),children:B?n("common.saving","Saving..."):g==="include"?n("systemInjectables.addInclusion","Add Inclusion"):n("systemInjectables.addExclusion","Add Exclusion")})]})]})})})}const Ke=7;function Ln(t){const r=t.find(s=>s.scopeType==="PUBLIC")||null,a=new Map;for(const s of t){if(s.scopeType==="PUBLIC")continue;const l=s.tenantId,i=s.tenantName||l.slice(0,8);a.has(l)||a.set(l,{tenantId:l,tenantName:i,tenantAssignment:null,workspaceAssignments:[]});const d=a.get(l);s.scopeType==="TENANT"?d.tenantAssignment=s:d.workspaceAssignments.push(s)}for(const s of a.values())s.workspaceAssignments.sort((l,i)=>(l.workspaceName||"").localeCompare(i.workspaceName||""));const n=Array.from(a.values()).sort((s,l)=>s.tenantName.localeCompare(l.tenantName));return{publicAssignment:r,tenantGroups:n}}function Fn(t,r){if(!r.trim())return t;const a=r.toLowerCase();return t.map(n=>{const s=n.tenantName.toLowerCase().includes(a),l=n.workspaceAssignments.filter(i=>{var d;return(d=i.workspaceName)==null?void 0:d.toLowerCase().includes(a)});return s?n:l.length>0?{...n,workspaceAssignments:l}:null}).filter(n=>n!==null)}function On({injectable:t,open:r,onOpenChange:a,canManage:n}){const{t:s,i18n:l}=$(),[i,d]=o.useState(!1),[c,u]=o.useState(""),[g,p]=o.useState(null);o.useEffect(()=>{r||(u(""),p(null))},[r]);const b=t?t.label[l.language]||t.label.en||t.key:"",j=t&&(t.description[l.language]||t.description.en)||"",{data:h,isLoading:y}=on(r?(t==null?void 0:t.key)??null:null),A=Pt(),v=Dt(),T=ln((t==null?void 0:t.key)??""),S=zt((t==null?void 0:t.key)??""),N=dn((t==null?void 0:t.key)??""),f=A.isPending||v.isPending,{publicAssignment:w,tenantGroups:z}=o.useMemo(()=>h?Ln(h):{publicAssignment:null,tenantGroups:[]},[h]),P=o.useMemo(()=>Fn(z,c),[z,c]);o.useEffect(()=>{if(c.trim()&&P.length>0){const m=P.find(R=>R.workspaceAssignments.length>0&&!R.tenantName.toLowerCase().includes(c.toLowerCase()));m&&p(m.tenantId)}},[c,P]);function D(m){t&&(m?A.mutate(t.key):v.mutate(t.key))}function _(m){T.mutate(m)}function B(m){m.isActive?S.mutate(m.id):N.mutate(m.id)}function C(m){p(R=>R===m?null:m)}if(!t)return e.jsx(e.Fragment,{});const L=((h==null?void 0:h.length)??0)>0,F=w&&(!c||"public".includes(c.toLowerCase()));return e.jsxs(e.Fragment,{children:[e.jsx(Ms,{open:r,onOpenChange:a,children:e.jsxs(Rs,{className:"flex flex-col overflow-hidden sm:max-w-md",children:[e.jsxs(Ls,{className:"border-b border-border pb-4 pr-8",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx(Fs,{className:"text-lg",children:b}),e.jsx(Os,{className:"mt-1",children:j||s("common.noDescription","No description")})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-mono text-[10px] uppercase tracking-widest text-muted-foreground",children:t.isActive?"Active":"Inactive"}),e.jsx(nt,{checked:t.isActive,onCheckedChange:D,disabled:!n||f})]})]}),e.jsxs("div",{className:"mt-3 flex items-center gap-2",children:[e.jsx(me,{variant:"outline",className:"font-mono text-[10px] uppercase",children:t.key}),e.jsx(me,{variant:"outline",className:"font-mono text-[10px] uppercase",children:t.dataType})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto py-4",children:[e.jsxs("div",{className:"mb-4 flex items-center justify-between",children:[e.jsx("h3",{className:"font-mono text-xs font-medium uppercase tracking-widest text-muted-foreground",children:s("systemInjectables.scopeAssignments","Scope Assignments")}),n&&e.jsxs(de,{variant:"ghost",size:"sm",className:"h-8 gap-1.5 font-mono text-xs uppercase",onClick:()=>d(!0),children:[e.jsx(_e,{size:14}),s("systemInjectables.addScope","Add")]})]}),L&&!y&&e.jsxs("div",{className:"relative mb-4",children:[e.jsx(Y,{size:14,className:"pointer-events-none absolute left-0 top-1/2 -translate-y-1/2 text-muted-foreground/50"}),e.jsx("input",{type:"text",value:c,onChange:m=>u(m.target.value),placeholder:s("systemInjectables.filterPlaceholder","Filter by name..."),className:"w-full border-b border-border bg-transparent py-2 pl-5 pr-2 text-sm outline-none transition-colors placeholder:text-muted-foreground/50 focus-visible:border-foreground"})]}),y&&e.jsxs("div",{className:"space-y-3",children:[e.jsx(W,{className:"h-14 w-full"}),e.jsx(W,{className:"h-14 w-full"})]}),!y&&F&&e.jsx(Bn,{assignment:w,canManage:n,onDelete:()=>_(w.id),onToggle:()=>B(w),isDeleting:T.isPending,isToggling:S.isPending||N.isPending}),!y&&P.length>0&&e.jsx("div",{className:"space-y-2",children:P.map(m=>e.jsx($n,{group:m,isExpanded:g===m.tenantId,onToggleExpand:()=>C(m.tenantId),canManage:n,onDeleteAssignment:_,onToggleAssignment:B,isDeleting:T.isPending,isToggling:S.isPending||N.isPending},m.tenantId))}),!y&&!L&&e.jsxs("div",{className:"py-8 text-center",children:[e.jsx(ke,{size:32,className:"mx-auto mb-3 text-muted-foreground/50"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s("systemInjectables.globalAvailability","Available globally to all workspaces")}),e.jsx("p",{className:"mt-1 text-xs text-muted-foreground/70",children:s("systemInjectables.globalHint","Add assignments to restrict availability to specific scopes")})]}),!y&&L&&c&&P.length===0&&!F&&e.jsxs("div",{className:"py-8 text-center",children:[e.jsx(Y,{size:24,className:"mx-auto mb-3 text-muted-foreground/50"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s("systemInjectables.noMatchingAssignments","No assignments match your search")})]})]})]})}),e.jsx(Rn,{injectableKey:t.key,open:i,onOpenChange:d})]})}function at({status:t,size:r="sm"}){const a=r==="sm"?"h-2 w-2":"h-2.5 w-2.5";return t==="included"?e.jsx("div",{className:k(a,"rounded-full bg-emerald-500")}):t==="excluded"?e.jsx("div",{className:k(a,"rounded-full bg-rose-500")}):e.jsx("div",{className:k(a,"rounded-full border border-muted-foreground/50")})}function Bn({assignment:t,canManage:r,onDelete:a,onToggle:n,isDeleting:s,isToggling:l}){const{t:i}=$();return e.jsxs("div",{className:"mb-4 flex items-center justify-between rounded-sm border border-dashed border-border bg-muted/20 p-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex h-8 w-8 items-center justify-center rounded-sm bg-muted/50",children:e.jsx(ke,{size:16,className:"text-muted-foreground"})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-mono text-xs uppercase tracking-widest",children:i("systemInjectables.public","Public")}),e.jsx(at,{status:t.isActive?"included":"excluded"}),e.jsx("span",{className:"font-mono text-[10px] uppercase text-muted-foreground",children:t.isActive?i("systemInjectables.included","Included"):i("systemInjectables.excluded","Excluded")})]}),e.jsx("p",{className:"mt-0.5 text-xs text-muted-foreground",children:i("systemInjectables.globalAvailability","Available globally")})]})]}),r&&e.jsx(rt,{assignment:t,onDelete:a,onToggle:n,isDeleting:s,isToggling:l})]})}function $n({group:t,isExpanded:r,onToggleExpand:a,canManage:n,onDeleteAssignment:s,onToggleAssignment:l,isDeleting:i,isToggling:d}){const{t:c}=$(),[u,g]=o.useState(Ke),p=o.useRef(null);o.useEffect(()=>{r||g(Ke)},[r]),o.useEffect(()=>{if(!r||!p.current)return;const v=new IntersectionObserver(T=>{T[0].isIntersecting&&u<t.workspaceAssignments.length&&g(S=>Math.min(S+Ke,t.workspaceAssignments.length))},{threshold:.1});return v.observe(p.current),()=>v.disconnect()},[r,u,t.workspaceAssignments.length]);const b=t.tenantAssignment!==null,j=b?t.tenantAssignment.isActive?"included":"excluded":"none",h=t.workspaceAssignments.length,y=t.workspaceAssignments.slice(0,u),A=u<h;return e.jsxs("div",{className:"rounded-sm border border-border",children:[e.jsxs("button",{type:"button",onClick:a,className:"flex w-full items-center justify-between p-3 text-left transition-colors hover:bg-muted/30",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex h-8 w-8 items-center justify-center rounded-sm bg-muted/50",children:e.jsx(he,{size:16,className:"text-muted-foreground"})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-medium",children:t.tenantName}),e.jsx(ve,{size:14,className:k("text-muted-foreground transition-transform duration-200",r&&"rotate-90")})]}),e.jsxs("div",{className:"mt-0.5 flex items-center gap-2",children:[e.jsx(at,{status:j}),e.jsx("span",{className:"font-mono text-[10px] uppercase text-muted-foreground",children:b?t.tenantAssignment.isActive?c("systemInjectables.included","Included"):c("systemInjectables.excluded","Excluded"):c("systemInjectables.noRule","No rule")}),h>0&&e.jsxs("span",{className:"font-mono text-[10px] text-muted-foreground/70",children:["· ",h," ",h===1?c("systemInjectables.workspace","workspace"):c("systemInjectables.workspaces","workspaces")]})]})]})]}),n&&b&&e.jsx("div",{onClick:v=>v.stopPropagation(),children:e.jsx(rt,{assignment:t.tenantAssignment,onDelete:()=>s(t.tenantAssignment.id),onToggle:()=>l(t.tenantAssignment),isDeleting:i,isToggling:d})})]}),e.jsxs("div",{className:k("overflow-hidden transition-all duration-200",r?"max-h-[500px]":"max-h-0"),children:[h>0&&e.jsxs("div",{className:"max-h-[350px] overflow-y-auto border-t border-border",children:[y.map((v,T)=>e.jsx(_n,{assignment:v,isLast:T===y.length-1&&!A,canManage:n,onDelete:()=>s(v.id),onToggle:()=>l(v),isDeleting:i,isToggling:d},v.id)),A&&e.jsxs("div",{ref:p,className:"flex items-center justify-center py-3",children:[e.jsx(J,{size:14,className:"animate-spin text-muted-foreground"}),e.jsx("span",{className:"ml-2 font-mono text-[10px] text-muted-foreground",children:c("systemInjectables.loadingMore","Loading more...")})]})]}),h===0&&e.jsx("div",{className:"border-t border-border py-4 text-center",children:e.jsx("p",{className:"text-xs text-muted-foreground/70",children:c("systemInjectables.noWorkspaces","No workspace rules")})})]})]})}function _n({assignment:t,isLast:r,canManage:a,onDelete:n,onToggle:s,isDeleting:l,isToggling:i}){var c;const{t:d}=$();return e.jsxs("div",{className:k("flex items-center justify-between px-3 py-2 pl-6 transition-colors hover:bg-muted/20",!r&&"border-b border-border"),children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Be,{size:14,className:"text-muted-foreground/70"}),e.jsx("span",{className:"text-sm",children:t.workspaceName||((c=t.workspaceId)==null?void 0:c.slice(0,8))}),e.jsx(at,{status:t.isActive?"included":"excluded"}),e.jsx("span",{className:"font-mono text-[10px] uppercase text-muted-foreground",children:t.isActive?d("systemInjectables.included","Included"):d("systemInjectables.excluded","Excluded")})]}),a&&e.jsx(rt,{assignment:t,onDelete:n,onToggle:s,isDeleting:l,isToggling:i,size:"sm"})]})}function rt({assignment:t,onDelete:r,onToggle:a,isDeleting:n,isToggling:s,size:l="md"}){const{t:i}=$();return e.jsxs(Ce,{modal:!1,children:[e.jsx(Se,{asChild:!0,children:e.jsx(de,{variant:"ghost",size:"icon",className:l==="sm"?"h-6 w-6":"h-8 w-8",disabled:n||s,children:e.jsx(Es,{size:l==="sm"?12:14})})}),e.jsxs(Ae,{align:"end",children:[e.jsx(U,{onClick:a,disabled:s,children:t.isActive?i("systemInjectables.exclude","Exclude"):i("systemInjectables.include","Include")}),e.jsxs(U,{onClick:r,disabled:n,className:"text-destructive focus:text-destructive",children:[e.jsx(St,{size:14,className:"mr-2"}),i("common.delete","Delete")]})]})]})}const qe=6;function Un(){var dt,ut;const{t,i18n:r}=$(),{toast:a}=ne(),{hasPermission:n}=ks(),s=n(Cs.SYSTEM_INJECTABLES_MANAGE),{data:l,isLoading:i,error:d}=rn(),c=Pt(),u=Dt(),g=un(),p=mn(),b=xn(),j=pn(),[h,y]=o.useState(null),[A,v]=o.useState(!1),[T,S]=o.useState(!1),[N,f]=o.useState(new Set),[w,z]=o.useState(null),[P,D]=o.useState(null),_=g.isPending||p.isPending||b.isPending||j.isPending,B=o.useMemo(()=>(l==null?void 0:l.find(x=>x.key===h))??null,[l,h]),[C,L]=o.useState(""),[F,m]=o.useState("all"),[R,I]=o.useState("name"),[q,G]=o.useState(!1),[ce,le]=o.useState(!1),O=o.useRef(null),Z=o.useRef(null),[E,X]=o.useState(qe),ot=o.useRef(null);o.useEffect(()=>{function x(M){O.current&&!O.current.contains(M.target)&&G(!1),Z.current&&!Z.current.contains(M.target)&&le(!1)}return document.addEventListener("mousedown",x),()=>document.removeEventListener("mousedown",x)},[]);const Q=o.useMemo(()=>l?l.filter(x=>{if(C){const M=C.toLowerCase(),V=x.label[r.language]||x.label.en||"",te=x.key.toLowerCase().includes(M),ze=V.toLowerCase().includes(M);if(!te&&!ze)return!1}return!(F==="active"&&!x.isActive||F==="inactive"&&x.isActive)}).sort((x,M)=>{let V=0;switch(R){case"name":return x.key.localeCompare(M.key);case"status":V=Number(M.isActive)-Number(x.isActive);break;case"type":V=x.dataType.localeCompare(M.dataType);break}return V!==0?V:x.key.localeCompare(M.key)}):[],[l,C,F,R,r.language]);o.useEffect(()=>{X(qe)},[C,F,R]),o.useEffect(()=>{const x=ot.current;if(!x)return;const M=new IntersectionObserver(V=>{V[0].isIntersecting&&E<Q.length&&X(te=>Math.min(te+qe,Q.length))},{threshold:.1});return M.observe(x),()=>M.disconnect()},[E,Q.length]);const it=o.useMemo(()=>Q.slice(0,E),[Q,E]);function Kt(x,M){M?c.mutate(x):u.mutate(x)}function qt(x){y(x.key),v(!0)}const Qt=o.useCallback(()=>{S(x=>(x&&f(new Set),!x))},[]),Vt=o.useCallback((x,M)=>{f(V=>{const te=new Set(V);return M?te.add(x):te.delete(x),te})},[]),Gt=o.useCallback(()=>{f(new Set(Q.map(x=>x.key)))},[Q]),Ht=o.useCallback(()=>{f(new Set)},[]),Zt=o.useCallback(()=>{S(!1),f(new Set)},[]),De=o.useCallback(x=>{const M=(x==null?void 0:x.succeeded)??[],V=(x==null?void 0:x.failed)??[],te=M.length,ze=V.length;if(ze===0)a({title:t("systemInjectables.bulk.success","Bulk operation completed"),description:t("systemInjectables.bulk.successDescription","{{count}} injectables updated",{count:te})});else{const ns=V.map(mt=>`${mt.key}: ${mt.error}`).join(`
`);a({title:t("systemInjectables.bulk.partialSuccess","Operation partially completed"),description:`${te} succeeded, ${ze} failed
${ns}`,variant:"destructive"})}},[t,a]),Xt=o.useCallback(async()=>{if(!w)return;const x=Array.from(N);try{let M;switch(w){case"activate":M=await g.mutateAsync(x);break;case"deactivate":M=await p.mutateAsync(x);break;case"make-public":M=await b.mutateAsync({keys:x,scopeType:"PUBLIC"});break;case"remove-public":M=await j.mutateAsync({keys:x,scopeType:"PUBLIC"});break}z(null),S(!1),f(new Set),De(M)}catch(M){z(null),a({title:t("common.error","Error"),description:t("systemInjectables.bulk.error","Failed to execute bulk operation"),variant:"destructive"}),console.error("Bulk operation error:",M)}},[w,N,g,p,b,j,De,t,a]),Yt=o.useCallback(async x=>{if(P)try{const V=await(P==="assign"?b:j).mutateAsync(x);D(null),S(!1),f(new Set),De(V)}catch(M){D(null),a({title:t("common.error","Error"),description:t("systemInjectables.bulk.error","Failed to execute bulk operation"),variant:"destructive"}),console.error("Bulk assignment error:",M)}},[P,b,j,De,t,a]),Jt=Q.length>0&&N.size===Q.length,es=N.size>0&&N.size<Q.length,ct=[{label:t("systemInjectables.filters.statusAll","All"),value:"all"},{label:t("systemInjectables.filters.statusActive","Active"),value:"active"},{label:t("systemInjectables.filters.statusInactive","Inactive"),value:"inactive"}],lt=[{label:t("systemInjectables.filters.sortName","Name"),value:"name"},{label:t("systemInjectables.filters.sortStatus","Status"),value:"status"},{label:t("systemInjectables.filters.sortType","Type"),value:"type"}],ts=((dt=ct.find(x=>x.value===F))==null?void 0:dt.label)??"All",ss=((ut=lt.find(x=>x.value===R))==null?void 0:ut.label)??"Name";return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:t("systemInjectables.description","Manage system-level injectable functions and their availability scopes.")}),!s&&e.jsxs("div",{className:"mt-3 flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(se,{size:14}),t("systemInjectables.readOnlyWarning","You have read-only access. Only SUPERADMIN can modify settings.")]})]}),e.jsxs("div",{className:"flex flex-col justify-between gap-4 md:flex-row md:items-center",children:[e.jsxs("div",{className:"group relative w-full md:max-w-xs",children:[e.jsx(Y,{className:"absolute left-0 top-1/2 -translate-y-1/2 text-muted-foreground/50 transition-colors group-focus-within:text-foreground",size:18}),e.jsx("input",{type:"text",placeholder:t("systemInjectables.filters.searchPlaceholder","Search by name..."),value:C,onChange:x=>L(x.target.value),className:"w-full rounded-none border-0 border-b border-border bg-transparent py-2 pl-7 pr-4 text-sm font-light text-foreground outline-none transition-all placeholder:text-muted-foreground/50 focus-visible:border-foreground focus-visible:ring-0"})]}),e.jsxs("div",{className:"flex items-center gap-6",children:[s&&e.jsxs("button",{onClick:Qt,className:k("flex items-center gap-2 font-mono text-xs uppercase tracking-wider transition-colors",T?"text-foreground":"text-muted-foreground hover:text-foreground"),children:[e.jsx(js,{size:14}),e.jsx("span",{children:t("systemInjectables.selectMode","Select")})]}),e.jsxs("div",{className:k("flex items-center gap-3 overflow-hidden transition-all duration-300 ease-out",T?"max-w-[500px] opacity-100":"max-w-0 opacity-0"),children:[e.jsxs("div",{className:"flex items-center gap-2 border-l border-border pl-4",children:[e.jsx(wt,{checked:Jt?!0:es?"indeterminate":!1,onCheckedChange:x=>{x?Gt():Ht()},className:"h-4 w-4"}),e.jsxs("span",{className:"font-mono text-[10px] uppercase tracking-wider text-muted-foreground",children:[N.size,"/",Q.length]})]}),e.jsxs("div",{className:"flex items-center gap-1 border-l border-border pl-3",children:[e.jsxs(Ce,{children:[e.jsxs(Se,{disabled:N.size===0||_,className:k("flex items-center gap-1.5 rounded-sm px-2 py-1 font-mono text-[10px] uppercase tracking-wider transition-colors",N.size>0?"text-foreground hover:bg-muted":"text-muted-foreground/50"),children:[e.jsx(Bs,{size:12}),e.jsx("span",{className:"hidden sm:inline",children:t("systemInjectables.bulk.actions","Actions")}),e.jsx(Fe,{size:10})]}),e.jsxs(Ae,{align:"start",className:"min-w-[200px]",children:[e.jsx(U,{onClick:()=>z("activate"),className:"font-mono text-xs uppercase tracking-wider",children:t("systemInjectables.bulk.activate","Activate")}),e.jsx(U,{onClick:()=>z("deactivate"),className:"font-mono text-xs uppercase tracking-wider text-destructive",children:t("systemInjectables.bulk.deactivate","Deactivate")}),e.jsx(ye,{}),e.jsx(U,{onClick:()=>z("make-public"),className:"font-mono text-xs uppercase tracking-wider",children:t("systemInjectables.bulk.makePublic","Make Public")}),e.jsx(U,{onClick:()=>z("remove-public"),className:"font-mono text-xs uppercase tracking-wider text-destructive",children:t("systemInjectables.bulk.removePublic","Remove Public")}),e.jsx(ye,{}),e.jsxs(ys,{children:[e.jsx(Ns,{className:"font-mono text-xs uppercase tracking-wider",children:t("systemInjectables.bulk.assignScope","Assign Scope")}),e.jsxs(ws,{children:[e.jsx(U,{onClick:()=>D("assign"),className:"font-mono text-xs uppercase tracking-wider",children:t("systemInjectables.bulk.createAssignments","Create Assignments")}),e.jsx(U,{onClick:()=>D("remove"),className:"font-mono text-xs uppercase tracking-wider text-destructive",children:t("systemInjectables.bulk.removeAssignments","Remove Assignments")})]})]})]})]}),e.jsx("button",{onClick:Zt,className:"ml-1 rounded-sm p-1 text-muted-foreground transition-colors hover:bg-muted hover:text-foreground",children:e.jsx(Ne,{size:14})})]})]}),e.jsxs("div",{ref:O,className:"relative",children:[e.jsxs("button",{onClick:()=>G(!q),className:"flex items-center gap-2 font-mono text-xs uppercase tracking-wider text-muted-foreground transition-colors hover:text-foreground",children:[e.jsxs("span",{children:[t("systemInjectables.filters.status","Status"),": ",ts]}),e.jsx(Fe,{size:14,className:k("transition-transform",q&&"rotate-180")})]}),q&&e.jsx("div",{className:"absolute right-0 top-full z-50 mt-2 min-w-[140px] border border-border bg-background shadow-lg",children:ct.map(x=>e.jsxs("button",{onClick:()=>{m(x.value),G(!1)},className:k("flex w-full items-center justify-between px-4 py-2 text-left font-mono text-xs uppercase tracking-wider transition-colors hover:bg-muted",F===x.value&&"text-foreground",F!==x.value&&"text-muted-foreground"),children:[e.jsx("span",{children:x.label}),F===x.value&&e.jsx(He,{size:12})]},x.value))})]}),e.jsxs("div",{ref:Z,className:"relative",children:[e.jsxs("button",{onClick:()=>le(!ce),className:"flex items-center gap-2 font-mono text-xs uppercase tracking-wider text-muted-foreground transition-colors hover:text-foreground",children:[e.jsxs("span",{children:[t("systemInjectables.filters.sortBy","Sort"),": ",ss]}),e.jsx(Fe,{size:14,className:k("transition-transform",ce&&"rotate-180")})]}),ce&&e.jsx("div",{className:"absolute right-0 top-full z-50 mt-2 min-w-[140px] border border-border bg-background shadow-lg",children:lt.map(x=>e.jsxs("button",{onClick:()=>{I(x.value),le(!1)},className:k("flex w-full items-center justify-between px-4 py-2 text-left font-mono text-xs uppercase tracking-wider transition-colors hover:bg-muted",R===x.value&&"text-foreground",R!==x.value&&"text-muted-foreground"),children:[e.jsx("span",{children:x.label}),R===x.value&&e.jsx(He,{size:12})]},x.value))})]})]})]}),e.jsxs("div",{className:"rounded-sm border border-border",children:[i&&e.jsx("div",{className:"space-y-0",children:[...Array(4)].map((x,M)=>e.jsx("div",{className:"border-b border-border p-4 last:border-b-0",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(W,{className:"h-10 w-10 shrink-0"}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx(W,{className:"h-4 w-48"}),e.jsx(W,{className:"h-3 w-72"})]}),e.jsx(W,{className:"h-6 w-16"})]})},M))}),d&&e.jsxs("div",{className:"flex flex-col items-center justify-center p-12 text-center",children:[e.jsx(se,{size:32,className:"mb-3 text-destructive"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:t("systemInjectables.loadError","Failed to load system injectables")})]}),!i&&!d&&(!l||l.length===0)&&e.jsxs("div",{className:"flex flex-col items-center justify-center p-12 text-center",children:[e.jsx(kt,{size:32,className:"mb-3 text-muted-foreground/50"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:t("systemInjectables.empty","No system injectables configured")})]}),!i&&!d&&l&&l.length>0&&Q.length===0&&e.jsxs("div",{className:"flex flex-col items-center justify-center p-12 text-center",children:[e.jsx(Y,{size:32,className:"mb-3 text-muted-foreground/50"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:t("systemInjectables.noResults","No injectables match your filters")})]}),!i&&!d&&Q.length>0&&e.jsxs("div",{children:[it.map(x=>e.jsx(Dn,{injectable:x,onToggle:Kt,onSelect:qt,canManage:s,isToggling:c.isPending&&c.variables===x.key||u.isPending&&u.variables===x.key,selectable:T,selected:N.has(x.key),onSelectChange:M=>Vt(x.key,M)},x.key)),E<Q.length&&e.jsx("div",{ref:ot,className:"flex items-center justify-center border-b border-border p-4",children:e.jsx("span",{className:"font-mono text-xs uppercase tracking-widest text-muted-foreground",children:t("systemInjectables.loadingMore","Loading more...")})}),e.jsx("div",{className:"border-t border-border p-3 text-center",children:e.jsx("span",{className:"font-mono text-xs text-muted-foreground",children:t("systemInjectables.showingOf","Showing {{visible}} of {{total}}",{visible:it.length,total:Q.length})})})]})]}),e.jsx(On,{injectable:B,open:A,onOpenChange:v,canManage:s}),e.jsx(gn,{open:w!==null,onOpenChange:x=>!x&&z(null),action:w,selectedKeys:Array.from(N),onConfirm:Xt,isPending:_}),e.jsx(kn,{open:P!==null,onOpenChange:x=>!x&&D(null),action:P,selectedKeys:Array.from(N),onConfirm:Yt,isPending:b.isPending||j.isPending})]})}const Me="p-4 text-left font-mono text-xs uppercase tracking-widest text-muted-foreground";function Wn(){const{t}=$(),r=[{id:"1",action:"User Login",user:"john@example.com",timestamp:"2 mins ago",details:"Successful login from 192.168.1.1"},{id:"2",action:"Template Created",user:"jane@example.com",timestamp:"1 hour ago",details:'Created "NDA Standard v3"'},{id:"3",action:"Document Signed",user:"bob@example.com",timestamp:"3 hours ago",details:'Signed "Contract-2024-001"'},{id:"4",action:"User Added",user:"admin@example.com",timestamp:"Yesterday",details:"Added user alice@example.com"},{id:"5",action:"Settings Changed",user:"admin@example.com",timestamp:"2 days ago",details:"Updated system security settings"}];return e.jsxs("div",{className:"space-y-6",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:t("administration.audit.description","View system activity and security logs.")}),e.jsx("div",{className:"rounded-sm border",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:Me,children:t("administration.audit.columns.action","Action")}),e.jsx("th",{className:Me,children:t("administration.audit.columns.user","User")}),e.jsx("th",{className:Me,children:t("administration.audit.columns.details","Details")}),e.jsx("th",{className:Me,children:t("administration.audit.columns.timestamp","Timestamp")})]})}),e.jsx("tbody",{children:r.map(a=>e.jsxs("tr",{className:"border-b last:border-0 hover:bg-muted/50",children:[e.jsx("td",{className:"p-4 font-medium",children:a.action}),e.jsx("td",{className:"p-4 font-mono text-sm text-muted-foreground",children:a.user}),e.jsx("td",{className:"p-4 text-sm text-muted-foreground",children:a.details}),e.jsx("td",{className:"p-4 font-mono text-sm text-muted-foreground",children:a.timestamp})]},a.id))})]})})]})}const Kn=/^[A-Z0-9]+(_[A-Z0-9]+)*$/;function qn(t){return t.toUpperCase().replace(/\s+/g,"_").replace(/[^A-Z0-9_]/g,"").replace(/_+/g,"_")}function Qe(t){return t.replace(/^_+|_+$/g,"")}function gt({open:t,onOpenChange:r,mode:a,documentType:n}){const{t:s}=$(),{toast:l}=ne(),[i,d]=o.useState(""),[c,u]=o.useState(""),[g,p]=o.useState(""),[b,j]=o.useState(""),[h,y]=o.useState(""),[A,v]=o.useState("es"),[T,S]=o.useState(""),[N,f]=o.useState(""),w=Ws(),z=Ks(),P=w.isPending||z.isPending;o.useEffect(()=>{var C,L,F,m;t&&(a==="edit"&&n?(d(n.code),u(((C=n.name)==null?void 0:C.es)||""),p(((L=n.name)==null?void 0:L.en)||""),j(((F=n.description)==null?void 0:F.es)||""),y(((m=n.description)==null?void 0:m.en)||"")):(d(""),u(""),p(""),j(""),y("")),v("es"),S(""),f(""))},[t,a,n]);const D=()=>{let C=!0;if(a==="create"){const L=Qe(i);L?L.length>50?(S(s("administration.documentTypes.form.codeTooLong","Code must be 50 characters or less")),C=!1):Kn.test(L)?S(""):(S(s("administration.documentTypes.form.codeInvalid","Code must contain only letters, numbers, and underscores")),C=!1):(S(s("administration.documentTypes.form.codeRequired","Code is required")),C=!1)}return c.trim()?f(""):(f(s("administration.documentTypes.form.nameRequired","Spanish name is required")),C=!1),C},_=()=>{const C=Qe(i);C!==i&&d(C)},B=async C=>{var R;C.preventDefault();const L=Qe(i);if(L!==i&&d(L),!D())return;const F={};c.trim()&&(F.es=c.trim()),g.trim()&&(F.en=g.trim());const m={};b.trim()&&(m.es=b.trim()),h.trim()&&(m.en=h.trim());try{a==="create"?(await w.mutateAsync({code:L,name:F,description:Object.keys(m).length>0?m:void 0}),l({title:s("administration.documentTypes.form.createSuccess","Document type created")})):n&&(await z.mutateAsync({id:n.id,data:{name:F,description:m}}),l({title:s("administration.documentTypes.form.updateSuccess","Document type updated")})),r(!1)}catch(I){Ze.isAxiosError(I)&&((R=I.response)==null?void 0:R.status)===409?S(s("administration.documentTypes.form.codeExists","A document type with this code already exists")):l({variant:"destructive",title:s("common.error","Error"),description:s("administration.documentTypes.form.saveError","Failed to save document type")})}};return e.jsx(ae,{open:t,onOpenChange:r,children:e.jsxs($e,{className:"max-w-md",children:[e.jsxs("div",{className:"flex items-start justify-between border-b border-border p-6",children:[e.jsxs("div",{children:[e.jsx(re,{className:"font-mono text-sm font-medium uppercase tracking-widest text-foreground",children:a==="create"?s("administration.documentTypes.form.createTitle","Create Document Type"):s("administration.documentTypes.form.editTitle","Edit Document Type")}),e.jsx(oe,{className:"mt-1 text-sm font-light text-muted-foreground",children:a==="create"?s("administration.documentTypes.form.createDescription","Add a new document type to organize templates."):s("administration.documentTypes.form.editDescription","Update the document type details.")})]}),e.jsxs(Ye,{className:"text-muted-foreground transition-colors hover:text-foreground",children:[e.jsx(Ne,{className:"h-5 w-5"}),e.jsx("span",{className:"sr-only",children:"Close"})]})]}),e.jsxs("form",{onSubmit:B,children:[e.jsxs("div",{className:"space-y-6 p-6",children:[a==="create"&&e.jsxs("div",{children:[e.jsxs("label",{className:"mb-2 block font-mono text-[10px] font-medium uppercase tracking-widest text-muted-foreground",children:[s("administration.documentTypes.form.code","Code")," *"]}),e.jsx("input",{type:"text",value:i,onChange:C=>{d(qn(C.target.value)),S("")},onBlur:_,placeholder:s("administration.documentTypes.form.codePlaceholder","CONTRACT_TYPE"),className:k("w-full rounded-none border-0 border-b bg-transparent py-2 font-mono text-base uppercase text-foreground outline-none transition-all placeholder:text-muted-foreground/50 focus-visible:border-foreground focus-visible:ring-0",T?"border-destructive":"border-border"),disabled:P,autoFocus:!0}),e.jsx("p",{className:k("mt-1 text-xs",T?"text-destructive":"text-muted-foreground"),children:T||s("administration.documentTypes.form.codeHint","Only uppercase letters, numbers, and underscores")})]}),a==="edit"&&n&&e.jsxs("div",{children:[e.jsx("label",{className:"mb-2 block font-mono text-[10px] font-medium uppercase tracking-widest text-muted-foreground",children:s("administration.documentTypes.form.code","Code")}),e.jsx("div",{className:"border-b border-border bg-transparent py-2",children:e.jsx("span",{className:"font-mono text-base uppercase text-muted-foreground",children:n.code})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex gap-1 border-b border-border",children:[e.jsxs("button",{type:"button",className:k("px-3 py-2 font-mono text-xs uppercase tracking-wider transition-colors",A==="es"?"border-b-2 border-foreground font-medium text-foreground":"text-muted-foreground hover:text-foreground"),onClick:()=>v("es"),children:["Español ",!c.trim()&&e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx("button",{type:"button",className:k("px-3 py-2 font-mono text-xs uppercase tracking-wider transition-colors",A==="en"?"border-b-2 border-foreground font-medium text-foreground":"text-muted-foreground hover:text-foreground"),onClick:()=>v("en"),children:"English"})]}),A==="es"&&e.jsxs("div",{className:"space-y-6 pt-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"mb-2 block font-mono text-[10px] font-medium uppercase tracking-widest text-muted-foreground",children:[s("administration.documentTypes.form.name","Name")," *"]}),e.jsx("input",{type:"text",value:c,onChange:C=>{u(C.target.value),f("")},placeholder:s("administration.documentTypes.form.namePlaceholder","Type name"),className:k("w-full rounded-none border-0 border-b bg-transparent py-2 text-base font-light text-foreground outline-none transition-all placeholder:text-muted-foreground/50 focus-visible:border-foreground focus-visible:ring-0",N?"border-destructive":"border-border"),disabled:P}),e.jsx("p",{className:k("mt-1 text-xs",N?"text-destructive":"text-transparent"),children:N||" "})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-2 block font-mono text-[10px] font-medium uppercase tracking-widest text-muted-foreground",children:s("administration.documentTypes.form.description","Description")}),e.jsx("textarea",{value:b,onChange:C=>j(C.target.value),placeholder:s("administration.documentTypes.form.descriptionPlaceholder","Optional description"),rows:3,className:"w-full rounded-none border-0 border-b border-border bg-transparent py-2 text-base font-light text-foreground outline-none transition-all placeholder:text-muted-foreground/50 focus-visible:border-foreground focus-visible:ring-0",disabled:P})]})]}),A==="en"&&e.jsxs("div",{className:"space-y-6 pt-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"mb-2 block font-mono text-[10px] font-medium uppercase tracking-widest text-muted-foreground",children:s("administration.documentTypes.form.name","Name")}),e.jsx("input",{type:"text",value:g,onChange:C=>p(C.target.value),placeholder:s("administration.documentTypes.form.namePlaceholder","Type name"),className:"w-full rounded-none border-0 border-b border-border bg-transparent py-2 text-base font-light text-foreground outline-none transition-all placeholder:text-muted-foreground/50 focus-visible:border-foreground focus-visible:ring-0",disabled:P})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-2 block font-mono text-[10px] font-medium uppercase tracking-widest text-muted-foreground",children:s("administration.documentTypes.form.description","Description")}),e.jsx("textarea",{value:h,onChange:C=>y(C.target.value),placeholder:s("administration.documentTypes.form.descriptionPlaceholder","Optional description"),rows:3,className:"w-full rounded-none border-0 border-b border-border bg-transparent py-2 text-base font-light text-foreground outline-none transition-all placeholder:text-muted-foreground/50 focus-visible:border-foreground focus-visible:ring-0",disabled:P})]})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 border-t border-border p-6",children:[e.jsx("button",{type:"button",onClick:()=>r(!1),className:"rounded-none border border-border bg-background px-6 py-2.5 font-mono text-xs uppercase tracking-wider text-muted-foreground transition-colors hover:border-foreground hover:text-foreground disabled:opacity-50",disabled:P,children:s("common.cancel","Cancel")}),e.jsxs("button",{type:"submit",className:"inline-flex items-center gap-2 rounded-none bg-foreground px-6 py-2.5 font-mono text-xs uppercase tracking-wider text-background transition-colors hover:bg-foreground/90 disabled:opacity-50",disabled:P,children:[P&&e.jsx(J,{size:16,className:"animate-spin"}),a==="create"?s("common.create","Create"):s("common.save","Save")]})]})]})]})})}function bt(t,r){return t[r]||t.es||t.en||Object.values(t)[0]||""}function Qn({open:t,onOpenChange:r,documentType:a}){const{t:n,i18n:s}=$(),{toast:l}=ne(),[i,d]=o.useState("confirm"),[c,u]=o.useState([]),[g,p]=o.useState(null),[b,j]=o.useState(""),h=qs(),{data:y}=It(1,100),A=h.isPending,v=(y==null?void 0:y.data.filter(f=>f.id!==(a==null?void 0:a.id)))??[];o.useEffect(()=>{t&&(d("confirm"),u([]),p(null),j(""))},[t]);const T=async()=>{if(a)try{if(i==="confirm"){const f=await h.mutateAsync({id:a.id});f.deleted?(l({title:n("administration.documentTypes.delete.success","Document type deleted")}),r(!1)):(u(f.templates),d("templates"))}else if(i==="templates"){if(!g)return;const f=g==="force"?{force:!0}:{replaceWithId:b};(await h.mutateAsync({id:a.id,options:f})).deleted&&(l({title:n("administration.documentTypes.delete.success","Document type deleted")}),r(!1))}}catch{l({variant:"destructive",title:n("common.error","Error"),description:n("administration.documentTypes.delete.error","Failed to delete document type")})}},S=i==="confirm"||i==="templates"&&(g==="force"||g==="replace"&&b);if(!a)return e.jsx(e.Fragment,{});const N=bt(a.name,s.language);return e.jsx(ae,{open:t,onOpenChange:r,children:e.jsxs(Te,{className:"sm:max-w-md",children:[e.jsxs(Ie,{children:[e.jsx(re,{children:n("administration.documentTypes.delete.title","Delete Document Type")}),e.jsx(oe,{children:i==="confirm"?n("administration.documentTypes.delete.confirm",'Are you sure you want to delete "{{name}}"?',{name:N}):n("administration.documentTypes.delete.hasTemplatesDescription","This document type is being used. Choose how to proceed.")})]}),i==="templates"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex gap-3 rounded-sm border border-warning-border bg-warning-muted p-3",children:[e.jsx(se,{size:20,className:"shrink-0 text-warning-foreground"}),e.jsx("p",{className:"text-sm text-warning-foreground",children:n("administration.documentTypes.delete.hasTemplates","This document type is used by {{count}} template(s)",{count:c.length})})]}),e.jsx("div",{className:"max-h-40 overflow-y-auto rounded-sm border border-border",children:c.map(f=>e.jsxs("div",{className:"border-b border-border px-3 py-2 last:border-0",children:[e.jsx("span",{className:"text-sm font-medium",children:f.title}),e.jsxs("span",{className:"ml-2 text-xs text-muted-foreground",children:["(",f.workspaceName,")"]})]},f.id))}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"flex cursor-pointer items-start gap-3",children:[e.jsx("input",{type:"radio",name:"deleteAction",checked:g==="force",onChange:()=>p("force"),className:"mt-0.5",disabled:A}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium",children:n("administration.documentTypes.delete.forceOption","Remove type from all templates")}),e.jsx("p",{className:"text-xs text-muted-foreground",children:n("administration.documentTypes.delete.forceHint","Templates will have no document type assigned")})]})]}),e.jsxs("label",{className:"flex cursor-pointer items-start gap-3",children:[e.jsx("input",{type:"radio",name:"deleteAction",checked:g==="replace",onChange:()=>p("replace"),className:"mt-0.5",disabled:A||v.length===0}),e.jsxs("div",{className:"flex-1",children:[e.jsx("span",{className:k("text-sm font-medium",v.length===0&&"text-muted-foreground"),children:n("administration.documentTypes.delete.replaceOption","Replace with another type")}),v.length===0&&e.jsx("p",{className:"text-xs text-muted-foreground",children:n("administration.documentTypes.delete.noOtherTypes","No other document types available")})]})]}),g==="replace"&&v.length>0&&e.jsxs("select",{value:b,onChange:f=>j(f.target.value),className:"ml-6 w-full rounded-sm border border-border bg-transparent px-3 py-2 text-sm outline-none focus:border-foreground",disabled:A,children:[e.jsx("option",{value:"",children:n("administration.documentTypes.delete.selectReplacement","Select replacement type...")}),v.map(f=>e.jsxs("option",{value:f.id,children:[bt(f.name,s.language)," (",f.code,")"]},f.id))]})]})]}),e.jsxs(Ee,{className:"gap-2 sm:gap-0",children:[e.jsx("button",{type:"button",onClick:()=>r(!1),className:"rounded-sm border border-border px-4 py-2 text-sm font-medium transition-colors hover:bg-muted",disabled:A,children:n("common.cancel","Cancel")}),e.jsxs("button",{type:"button",onClick:T,className:"inline-flex items-center gap-2 rounded-sm bg-destructive px-4 py-2 text-sm font-medium text-destructive-foreground transition-colors hover:bg-destructive/90 disabled:opacity-50",disabled:A||!S,children:[A&&e.jsx(J,{size:16,className:"animate-spin"}),n("common.delete","Delete")]})]})]})})}const Re="p-4 text-left font-mono text-xs uppercase tracking-widest text-muted-foreground",Vn=10,Gn=300;function Hn(t,r){return t[r]||t.es||t.en||Object.values(t)[0]||""}function jt(){var P;const{t,i18n:r}=$(),[a,n]=o.useState(1),[s,l]=o.useState(""),[i,d]=o.useState(""),[c,u]=o.useState(!1),[g,p]=o.useState(!1),[b,j]=o.useState(!1),[h,y]=o.useState(null);o.useEffect(()=>{const D=setTimeout(()=>{d(s)},Gn);return()=>clearTimeout(D)},[s]),o.useEffect(()=>{n(1)},[i]);const{data:A,isLoading:v,error:T,isFetching:S}=It(a,Vn,i.length>=3?i:void 0),N=(A==null?void 0:A.data)??[],f=((P=A==null?void 0:A.pagination)==null?void 0:P.totalPages)??1,w=D=>{y(D),p(!0)},z=D=>{y(D),j(!0)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:t("administration.documentTypes.description","Manage document types and their configurations.")}),e.jsxs("button",{onClick:()=>u(!0),className:"inline-flex items-center gap-2 rounded-sm bg-foreground px-4 py-2 text-sm font-medium text-background transition-colors hover:bg-foreground/90",children:[e.jsx(_e,{size:16}),t("administration.documentTypes.create","Create Type")]})]}),e.jsxs("div",{className:"group relative w-full md:max-w-xs",children:[e.jsx(Y,{className:"absolute left-0 top-1/2 -translate-y-1/2 text-muted-foreground/50 transition-colors group-focus-within:text-foreground",size:18}),e.jsx("input",{type:"text",placeholder:t("administration.documentTypes.searchPlaceholder","Search document types..."),value:s,onChange:D=>l(D.target.value),className:"w-full rounded-none border-0 border-b border-border bg-transparent py-2 pl-7 pr-4 text-sm font-light text-foreground outline-none transition-all placeholder:text-muted-foreground/50 focus-visible:border-foreground focus-visible:ring-0"}),e.jsx("p",{className:`absolute left-0 top-full pt-1 text-xs text-muted-foreground transition-opacity duration-200 ${s.length>0&&s.length<3?"opacity-100":"opacity-0 pointer-events-none"}`,children:t("common.searchMinChars","Type at least 3 characters to search")})]}),e.jsxs("div",{className:"rounded-sm border",children:[v&&e.jsx("div",{className:"divide-y",children:[...Array(5)].map((D,_)=>e.jsxs("div",{className:"flex items-center gap-4 p-4",children:[e.jsx(W,{className:"h-4 w-24"}),e.jsx(W,{className:"h-4 w-40"}),e.jsx(W,{className:"h-4 w-12"}),e.jsx(W,{className:"h-4 w-8"})]},_))}),T&&!v&&e.jsxs("div",{className:"flex flex-col items-center justify-center p-12 text-center",children:[e.jsx(se,{size:32,className:"mb-3 text-destructive"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:t("administration.documentTypes.loadError","Failed to load document types")})]}),!v&&!T&&N.length===0&&e.jsxs("div",{className:"flex flex-col items-center justify-center p-12 text-center",children:[e.jsx(Ds,{size:32,className:"mb-3 text-muted-foreground/50"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:i.length>=3?t("administration.documentTypes.noResults","No document types match your search"):t("administration.documentTypes.empty","No document types found")})]}),!v&&!T&&N.length>0&&e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:Re,children:t("administration.documentTypes.columns.code","Code")}),e.jsx("th",{className:Re,children:t("administration.documentTypes.columns.name","Name")}),e.jsx("th",{className:Re,children:t("administration.documentTypes.columns.templates","Templates")}),e.jsx("th",{className:`${Re} w-12`,children:t("administration.documentTypes.columns.actions","Actions")})]})}),e.jsx("tbody",{className:S?"opacity-50":void 0,children:N.map(D=>e.jsxs("tr",{className:"border-b last:border-0 hover:bg-muted/50",children:[e.jsx("td",{className:"p-4",children:e.jsx("span",{className:"inline-flex items-center rounded-sm border px-2 py-0.5 font-mono text-xs uppercase",children:D.code})}),e.jsx("td",{className:"p-4 font-medium",children:e.jsxs("div",{className:"flex items-center gap-2",children:[Hn(D.name,r.language),D.isGlobal&&e.jsxs(me,{variant:"secondary",className:"gap-1 text-xs",children:[e.jsx(ke,{size:10}),t("administration.documentTypes.global","Global")]})]})}),e.jsx("td",{className:"p-4 font-mono text-sm text-muted-foreground",children:D.templatesCount??0}),e.jsx("td",{className:"p-4",children:D.isGlobal?e.jsx("span",{className:"text-xs text-muted-foreground",children:t("administration.documentTypes.readOnly","Read-only")}):e.jsxs(Ce,{children:[e.jsx(Se,{asChild:!0,children:e.jsx("button",{className:"rounded-sm p-1 hover:bg-muted",children:e.jsx(tt,{size:16})})}),e.jsxs(Ae,{align:"end",children:[e.jsxs(U,{onClick:()=>w(D),children:[e.jsx(Je,{size:14,className:"mr-2"}),t("common.edit","Edit")]}),e.jsxs(U,{onClick:()=>z(D),className:"text-destructive focus:text-destructive",children:[e.jsx(St,{size:14,className:"mr-2"}),t("common.delete","Delete")]})]})]})})]},D.id))})]})]}),!v&&!T&&e.jsx(et,{page:a,totalPages:f,onPageChange:n,disabled:S,className:"py-2"}),e.jsx(gt,{open:c,onOpenChange:u,mode:"create"}),e.jsx(gt,{open:g,onOpenChange:p,mode:"edit",documentType:h}),e.jsx(Qn,{open:b,onOpenChange:j,documentType:h})]})}const Pe={all:["system-tenants"],list:(t,r,a)=>[...Pe.all,"list",t,r,a]};function Zn(t,r,a){return Xe({queryKey:Pe.list(t,r,a),queryFn:()=>Mt(t,r,a),placeholderData:ds,staleTime:120*1e3})}function Xn(){const t=ge();return H({mutationFn:r=>jn(r),onSuccess:()=>{t.invalidateQueries({queryKey:Pe.all})}})}function Yn(){const t=ge();return H({mutationFn:({id:r,data:a})=>vn(r,a),onSuccess:()=>{t.invalidateQueries({queryKey:Pe.all})}})}function Wt(){const t=ge();return H({mutationFn:({id:r,status:a})=>yn(r,a),onSuccess:()=>{t.invalidateQueries({queryKey:Pe.all})}})}const Jn=/^[A-Z0-9]+(_[A-Z0-9]+)*$/;function ea(t){return t.toUpperCase().replace(/\s+/g,"_").replace(/[^A-Z0-9_]/g,"").replace(/_+/g,"_")}function Ve(t){return t.replace(/^_+|_+$/g,"")}function ta({open:t,onOpenChange:r,mode:a,tenant:n}){const{t:s}=$(),{toast:l}=ne(),[i,d]=o.useState(""),[c,u]=o.useState(""),[g,p]=o.useState(""),[b,j]=o.useState(""),[h,y]=o.useState(""),A=Xn(),v=Yn(),T=A.isPending||v.isPending;o.useEffect(()=>{t&&(a==="edit"&&n?(d(n.name),u(n.code),p(n.description||"")):(d(""),u(""),p("")),j(""),y(""))},[t,a,n]);const S=()=>{let w=!0;if(i.trim()?i.length>100?(j(s("administration.tenants.form.nameTooLong","Name must be 100 characters or less")),w=!1):j(""):(j(s("administration.tenants.form.nameRequired","Name is required")),w=!1),a==="create"){const z=Ve(c);z?z.length<2||z.length>10?(y(s("administration.tenants.form.codeLength","Code must be 2-10 characters")),w=!1):Jn.test(z)?y(""):(y(s("administration.tenants.form.codeInvalid","Code must contain only letters, numbers, and underscores")),w=!1):(y(s("administration.tenants.form.codeRequired","Code is required")),w=!1)}return w},N=()=>{const w=Ve(c);w!==c&&u(w)},f=async w=>{var P;w.preventDefault();const z=Ve(c);if(z!==c&&u(z),!!S())try{a==="create"?(await A.mutateAsync({name:i.trim(),code:z,description:g.trim()||void 0}),l({title:s("administration.tenants.form.createSuccess","Tenant created")}),we.getState().setSingleTenant(!1)):n&&(await v.mutateAsync({id:n.id,data:{name:i.trim(),description:g.trim()||void 0}}),l({title:s("administration.tenants.form.updateSuccess","Tenant updated")})),r(!1)}catch(D){Ze.isAxiosError(D)&&((P=D.response)==null?void 0:P.status)===409?y(s("administration.tenants.form.codeExists","A tenant with this code already exists")):l({variant:"destructive",title:s("common.error","Error"),description:s("administration.tenants.form.saveError","Failed to save tenant")})}};return e.jsx(ae,{open:t,onOpenChange:r,children:e.jsxs($e,{className:"max-w-md",children:[e.jsxs("div",{className:"flex items-start justify-between border-b border-border p-6",children:[e.jsxs("div",{children:[e.jsx(re,{className:"font-mono text-sm font-medium uppercase tracking-widest text-foreground",children:a==="create"?s("administration.tenants.form.createTitle","Create Tenant"):s("administration.tenants.form.editTitle","Edit Tenant")}),e.jsx(oe,{className:"mt-1 text-sm font-light text-muted-foreground",children:a==="create"?s("administration.tenants.form.createDescription","Create a new tenant organization."):s("administration.tenants.form.editDescription","Update tenant details.")})]}),e.jsxs(Ye,{className:"text-muted-foreground transition-colors hover:text-foreground",children:[e.jsx(Ne,{className:"h-5 w-5"}),e.jsx("span",{className:"sr-only",children:"Close"})]})]}),e.jsxs("form",{onSubmit:f,children:[e.jsxs("div",{className:"space-y-6 p-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"mb-2 block font-mono text-[10px] font-medium uppercase tracking-widest text-muted-foreground",children:[s("administration.tenants.form.name","Name")," *"]}),e.jsx("input",{type:"text",value:i,onChange:w=>{d(w.target.value),j("")},placeholder:s("administration.tenants.form.namePlaceholder","Tenant name"),className:k("w-full rounded-none border-0 border-b bg-transparent py-2 text-base font-light text-foreground outline-none transition-all placeholder:text-muted-foreground/50 focus-visible:border-foreground focus-visible:ring-0",b?"border-destructive":"border-border"),disabled:T,autoFocus:!0}),e.jsx("p",{className:k("mt-1 text-xs",b?"text-destructive":"text-transparent"),children:b||" "})]}),a==="create"&&e.jsxs("div",{children:[e.jsxs("label",{className:"mb-2 block font-mono text-[10px] font-medium uppercase tracking-widest text-muted-foreground",children:[s("administration.tenants.form.code","Code")," *"]}),e.jsx("input",{type:"text",value:c,onChange:w=>{u(ea(w.target.value)),y("")},onBlur:N,placeholder:s("administration.tenants.form.codePlaceholder","TENANT_CODE"),className:k("w-full rounded-none border-0 border-b bg-transparent py-2 font-mono text-base uppercase text-foreground outline-none transition-all placeholder:text-muted-foreground/50 focus-visible:border-foreground focus-visible:ring-0",h?"border-destructive":"border-border"),disabled:T,maxLength:10}),e.jsx("p",{className:k("mt-1 text-xs",h?"text-destructive":"text-muted-foreground"),children:h||s("administration.tenants.form.codeHint","2-10 uppercase characters")})]}),a==="edit"&&n&&e.jsxs("div",{children:[e.jsx("label",{className:"mb-2 block font-mono text-[10px] font-medium uppercase tracking-widest text-muted-foreground",children:s("administration.tenants.form.code","Code")}),e.jsx("div",{className:"border-b border-border bg-transparent py-2",children:e.jsx("span",{className:"font-mono text-base uppercase text-muted-foreground",children:n.code})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-2 block font-mono text-[10px] font-medium uppercase tracking-widest text-muted-foreground",children:s("administration.tenants.form.description","Description")}),e.jsx("textarea",{value:g,onChange:w=>p(w.target.value),placeholder:s("administration.tenants.form.descriptionPlaceholder","Optional description"),rows:3,className:"w-full rounded-none border-0 border-b border-border bg-transparent py-2 text-base font-light text-foreground outline-none transition-all placeholder:text-muted-foreground/50 focus-visible:border-foreground focus-visible:ring-0",disabled:T})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 border-t border-border p-6",children:[e.jsx("button",{type:"button",onClick:()=>r(!1),className:"rounded-none border border-border bg-background px-6 py-2.5 font-mono text-xs uppercase tracking-wider text-muted-foreground transition-colors hover:border-foreground hover:text-foreground disabled:opacity-50",disabled:T,children:s("common.cancel","Cancel")}),e.jsxs("button",{type:"submit",className:"inline-flex items-center gap-2 rounded-none bg-foreground px-6 py-2.5 font-mono text-xs uppercase tracking-wider text-background transition-colors hover:bg-foreground/90 disabled:opacity-50",disabled:T,children:[T&&e.jsx(J,{size:16,className:"animate-spin"}),a==="create"?s("common.create","Create"):s("common.save","Save")]})]})]})]})})}const sa={ACTIVE:"border-success-border bg-success-muted text-success-foreground",SUSPENDED:"border-warning-border bg-warning-muted text-warning-foreground",ARCHIVED:"border-border bg-muted text-muted-foreground"},na={ACTIVE:"bg-green-500",SUSPENDED:"bg-yellow-500",ARCHIVED:"bg-gray-400 dark:bg-gray-500"};function aa({status:t,className:r}){return e.jsxs("span",{className:k("inline-flex min-w-[90px] items-center justify-center gap-1.5 rounded-sm border px-2 py-0.5 font-mono text-xs uppercase",sa[t],r),children:[e.jsx("span",{className:k("h-1.5 w-1.5 shrink-0 rounded-full",na[t])}),t]})}function ra({open:t,onOpenChange:r,tenant:a}){const{t:n}=$(),{toast:s}=ne(),l=Wt(),i=l.isPending,d=async()=>{if(a)try{await l.mutateAsync({id:a.id,status:"ARCHIVED"}),s({title:n("administration.tenants.archive.success","Tenant archived")}),r(!1)}catch{s({variant:"destructive",title:n("common.error","Error"),description:n("administration.tenants.archive.error","Failed to archive tenant")})}};return a?e.jsx(ae,{open:t,onOpenChange:r,children:e.jsxs(Te,{className:"sm:max-w-md",children:[e.jsxs(Ie,{children:[e.jsxs(re,{className:"flex items-center gap-2 font-mono text-sm uppercase tracking-widest",children:[e.jsx(se,{size:18,className:"text-destructive"}),n("administration.tenants.archive.title","Archive Tenant")]}),e.jsx(oe,{children:n("administration.tenants.archive.confirm",'Are you sure you want to archive "{{name}}"?',{name:a.name})})]}),e.jsx("div",{className:"py-4",children:e.jsx("p",{className:"text-sm text-muted-foreground",children:n("administration.tenants.archive.description","This will hide the tenant from all users. The data will be preserved and can be restored by an administrator.")})}),e.jsxs(Ee,{className:"gap-2 sm:gap-0",children:[e.jsx("button",{type:"button",onClick:()=>r(!1),className:"rounded-none border border-border bg-background px-6 py-2.5 font-mono text-xs uppercase tracking-wider text-muted-foreground transition-colors hover:border-foreground hover:text-foreground",disabled:i,children:n("common.cancel","Cancel")}),e.jsxs("button",{type:"button",onClick:d,className:"inline-flex items-center gap-2 rounded-none bg-destructive px-6 py-2.5 font-mono text-xs uppercase tracking-wider text-destructive-foreground transition-colors hover:bg-destructive/90 disabled:opacity-50",disabled:i,children:[i&&e.jsx(J,{size:14,className:"animate-spin"}),n("common.archive","Archive")]})]})]})}):e.jsx(e.Fragment,{})}const be="p-4 text-left font-mono text-xs uppercase tracking-widest text-muted-foreground",oa=10,ia=300;function ca(t){return new Date(t).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})}function la(){var R;const{t}=$(),{toast:r}=ne(),[a,n]=o.useState(1),[s,l]=o.useState(""),[i,d]=o.useState(""),[c,u]=o.useState(!1),[g,p]=o.useState("create"),[b,j]=o.useState(null),[h,y]=o.useState(!1),A=us(),{setCurrentTenant:v,setSingleTenant:T}=we(),S=Wt();o.useEffect(()=>{const I=setTimeout(()=>{d(s)},ia);return()=>clearTimeout(I)},[s]),o.useEffect(()=>{n(1)},[i]);const{data:N,isLoading:f,error:w,isFetching:z}=Zn(a,oa,i.length>=3?i:void 0),P=(N==null?void 0:N.data)??[],D=((R=N==null?void 0:N.pagination)==null?void 0:R.totalPages)??1,_=()=>{j(null),p("create"),u(!0)},B=I=>{j(I),p("edit"),u(!0)},C=async(I,q)=>{try{await S.mutateAsync({id:I.id,status:q}),r({title:t("administration.tenants.statusUpdated","Status updated")})}catch{r({variant:"destructive",title:t("common.error","Error"),description:t("administration.tenants.statusError","Failed to update status")})}},L=I=>{j(I),y(!0)},F=I=>{const q={...I,role:"SUPERADMIN"};T(!1),v(q),A({to:"/select-tenant",search:{intent:"switch"}})},m=I=>I.status==="ACTIVE"?{label:t("administration.tenants.actions.suspend","Suspend"),icon:Ct,onClick:()=>C(I,"SUSPENDED")}:I.status==="SUSPENDED"?{label:t("administration.tenants.actions.activate","Activate"),icon:Oe,onClick:()=>C(I,"ACTIVE")}:{label:t("administration.tenants.actions.activate","Activate"),icon:Oe,onClick:()=>C(I,"ACTIVE")};return e.jsxs("div",{className:"space-y-6",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:t("administration.tenants.description","Manage tenant organizations and their configurations.")}),e.jsxs("div",{className:"flex flex-col gap-4 md:flex-row md:items-center md:justify-between",children:[e.jsxs("div",{className:"group relative w-full md:max-w-xs",children:[e.jsx(Y,{className:"absolute left-0 top-1/2 -translate-y-1/2 text-muted-foreground/50 transition-colors group-focus-within:text-foreground",size:18}),e.jsx("input",{type:"text",placeholder:t("administration.tenants.searchPlaceholder","Search tenants..."),value:s,onChange:I=>l(I.target.value),className:"w-full rounded-none border-0 border-b border-border bg-transparent py-2 pl-7 pr-4 text-sm font-light text-foreground outline-none transition-all placeholder:text-muted-foreground/50 focus-visible:border-foreground focus-visible:ring-0"}),e.jsx("p",{className:`absolute left-0 top-full pt-1 text-xs text-muted-foreground transition-opacity duration-200 ${s.length>0&&s.length<3?"opacity-100":"opacity-0 pointer-events-none"}`,children:t("common.searchMinChars","Type at least 3 characters to search")})]}),e.jsxs("button",{onClick:_,className:"inline-flex items-center gap-2 rounded-sm bg-foreground px-4 py-2 font-mono text-xs uppercase tracking-wider text-background transition-colors hover:bg-foreground/90",children:[e.jsx(_e,{size:14}),t("administration.tenants.addTenant","Add Tenant")]})]}),e.jsxs("div",{className:"rounded-sm border",children:[f&&e.jsx("div",{className:"divide-y",children:[...Array(5)].map((I,q)=>e.jsxs("div",{className:"flex items-center gap-4 p-4",children:[e.jsx(W,{className:"h-4 w-40"}),e.jsx(W,{className:"h-4 w-20"}),e.jsx(W,{className:"h-4 w-20"}),e.jsx(W,{className:"h-4 w-28"})]},q))}),w&&!f&&e.jsxs("div",{className:"flex flex-col items-center justify-center p-12 text-center",children:[e.jsx(se,{size:32,className:"mb-3 text-destructive"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:t("administration.tenants.loadError","Failed to load tenants")})]}),!f&&!w&&P.length===0&&e.jsxs("div",{className:"flex flex-col items-center justify-center p-12 text-center",children:[e.jsx(he,{size:32,className:"mb-3 text-muted-foreground/50"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:i.length>=3?t("administration.tenants.noResults","No tenants match your search"):t("administration.tenants.empty","No tenants found")})]}),!f&&!w&&P.length>0&&e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:`${be} w-[35%]`,children:t("administration.tenants.columns.name","Name")}),e.jsx("th",{className:`${be} w-[15%]`,children:t("administration.tenants.columns.code","Code")}),e.jsx("th",{className:`${be} w-[15%]`,children:t("administration.tenants.columns.status","Status")}),e.jsx("th",{className:`${be} w-[20%]`,children:t("administration.tenants.columns.created","Created")}),e.jsx("th",{className:`${be} w-[15%]`})]})}),e.jsx("tbody",{className:z?"opacity-50":void 0,children:P.map(I=>e.jsxs("tr",{className:"border-b last:border-0 hover:bg-muted/50",children:[e.jsxs("td",{className:"p-4",children:[e.jsx("button",{onClick:()=>F(I),className:"font-medium hover:underline",children:I.name}),I.isSystem&&e.jsx("span",{className:"ml-2 rounded-sm bg-muted px-1.5 py-0.5 text-[10px] font-medium uppercase text-muted-foreground",children:t("administration.tenants.system","System")})]}),e.jsx("td",{className:"p-4",children:e.jsx("span",{className:"inline-flex items-center rounded-sm border px-2 py-0.5 font-mono text-xs uppercase",children:I.code})}),e.jsx("td",{className:"whitespace-nowrap p-4",children:e.jsx(aa,{status:I.status})}),e.jsx("td",{className:"whitespace-nowrap p-4 font-mono text-sm text-muted-foreground",children:ca(I.createdAt)}),e.jsx("td",{className:"p-4",children:!I.isSystem&&e.jsxs(Ce,{children:[e.jsx(Se,{asChild:!0,children:e.jsx("button",{className:"rounded-sm p-1 hover:bg-muted",children:e.jsx(tt,{size:16})})}),e.jsxs(Ae,{align:"end",children:[e.jsxs(U,{onClick:()=>F(I),children:[e.jsx(zs,{size:14,className:"mr-2"}),t("administration.tenants.actions.open","Open")]}),e.jsx(ye,{}),e.jsxs(U,{onClick:()=>B(I),children:[e.jsx(Je,{size:14,className:"mr-2"}),t("administration.tenants.actions.edit","Edit")]}),e.jsx(U,{onClick:m(I).onClick,children:(()=>{const q=m(I),G=q.icon;return e.jsxs(e.Fragment,{children:[e.jsx(G,{size:14,className:"mr-2"}),q.label]})})()}),I.status!=="ARCHIVED"&&e.jsxs(e.Fragment,{children:[e.jsx(ye,{}),e.jsxs(U,{onClick:()=>L(I),className:"text-destructive focus:text-destructive",children:[e.jsx(At,{size:14,className:"mr-2"}),t("administration.tenants.actions.archive","Archive")]})]})]})]})})]},I.id))})]})]}),!f&&!w&&e.jsx(et,{page:a,totalPages:D,onPageChange:n,disabled:z,className:"py-2"}),e.jsx(ta,{open:c,onOpenChange:u,mode:g,tenant:b}),e.jsx(ra,{open:h,onOpenChange:y,tenant:b})]})}const da={ACTIVE:"border-success-border bg-success-muted text-success-foreground",SUSPENDED:"border-warning-border bg-warning-muted text-warning-foreground",ARCHIVED:"border-border bg-muted text-muted-foreground"},ua={ACTIVE:"bg-green-500",SUSPENDED:"bg-yellow-500",ARCHIVED:"bg-gray-400 dark:bg-gray-500"};function ma({status:t,className:r}){return e.jsxs("span",{className:k("inline-flex min-w-[90px] items-center justify-center gap-1.5 rounded-sm border px-2 py-0.5 font-mono text-xs uppercase",da[t],r),children:[e.jsx("span",{className:k("h-1.5 w-1.5 shrink-0 rounded-full",ua[t])}),t]})}const xa=/^[A-Z0-9]+(_[A-Z0-9]+)*$/;function pa(t){return t.toUpperCase().replace(/\s+/g,"_").replace(/[^A-Z0-9_]/g,"").replace(/_+/g,"_")}function Ge(t){return t.replace(/^_+|_+$/g,"")}function fa({open:t,onOpenChange:r,mode:a,workspace:n}){const{t:s}=$(),{toast:l}=ne(),{currentWorkspace:i}=we(),[d,c]=o.useState(""),[u,g]=o.useState(""),[p,b]=o.useState(""),[j,h]=o.useState(""),y=$s(),A=_s(),v=y.isPending||A.isPending;o.useEffect(()=>{t&&(a==="edit"&&n?(c(n.code),b(n.name)):(c(""),b("")),g(""),h(""))},[t,a,n]);const T=()=>{c(Ge(d))},S=()=>{let f=!0;const w=Ge(d);return w?w.length<2||w.length>50?(g(s("administration.workspaces.form.codeLength","Code must be 2-10 characters")),f=!1):xa.test(w)?g(""):(g(s("administration.workspaces.form.codeInvalid","Code must contain only letters, numbers, and underscores")),f=!1):(g(s("administration.workspaces.form.codeRequired","Code is required")),f=!1),p.trim()?p.trim().length<3?(h(s("administration.workspaces.form.nameTooShort","Name must be at least 3 characters")),f=!1):p.length>255?(h(s("administration.workspaces.form.nameTooLong","Name must be 255 characters or less")),f=!1):h(""):(h(s("administration.workspaces.form.nameRequired","Name is required")),f=!1),f},N=async f=>{var z;if(f.preventDefault(),!S())return;const w=Ge(d);try{if(a==="create")await y.mutateAsync({code:w,name:p.trim(),type:"CLIENT"}),l({title:s("administration.workspaces.form.createSuccess","Workspace created")});else if(n)if((i==null?void 0:i.id)===n.id)await A.mutateAsync({code:w,name:p.trim()}),l({title:s("administration.workspaces.form.updateSuccess","Workspace updated")});else{l({variant:"destructive",title:s("common.error","Error"),description:s("administration.workspaces.form.editContextError","Cannot edit workspace outside its context")});return}r(!1)}catch(P){Ze.isAxiosError(P)&&((z=P.response)==null?void 0:z.status)===409?g(s("administration.workspaces.form.codeExists","A workspace with this code already exists")):l({variant:"destructive",title:s("common.error","Error"),description:s("administration.workspaces.form.saveError","Failed to save workspace")})}};return e.jsx(ae,{open:t,onOpenChange:r,children:e.jsxs($e,{className:"max-w-md",children:[e.jsxs("div",{className:"flex items-start justify-between border-b border-border p-6",children:[e.jsxs("div",{children:[e.jsx(re,{className:"font-mono text-sm font-medium uppercase tracking-widest text-foreground",children:a==="create"?s("administration.workspaces.form.createTitle","Create Workspace"):s("administration.workspaces.form.editTitle","Edit Workspace")}),e.jsx(oe,{className:"mt-1 text-sm font-light text-muted-foreground",children:a==="create"?s("administration.workspaces.form.createDescription","Create a new workspace for this tenant."):s("administration.workspaces.form.editDescription","Update workspace details.")})]}),e.jsxs(Ye,{className:"text-muted-foreground transition-colors hover:text-foreground",children:[e.jsx(Ne,{className:"h-5 w-5"}),e.jsx("span",{className:"sr-only",children:"Close"})]})]}),e.jsxs("form",{onSubmit:N,children:[e.jsxs("div",{className:"space-y-6 p-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"mb-2 block font-mono text-[10px] font-medium uppercase tracking-widest text-muted-foreground",children:[s("administration.workspaces.form.name","Name")," *"]}),e.jsx("input",{type:"text",value:p,onChange:f=>{b(f.target.value),h("")},placeholder:s("administration.workspaces.form.namePlaceholder","Workspace name"),className:k("w-full rounded-none border-0 border-b bg-transparent py-2 text-base font-light text-foreground outline-none transition-all placeholder:text-muted-foreground/50 focus-visible:border-foreground focus-visible:ring-0",j?"border-destructive":"border-border"),disabled:v,autoFocus:!0}),e.jsx("p",{className:k("mt-1 text-xs",j?"text-destructive":"text-transparent"),children:j||" "})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"mb-2 block font-mono text-[10px] font-medium uppercase tracking-widest text-muted-foreground",children:[s("administration.workspaces.form.code","Code")," *"]}),e.jsx("input",{type:"text",value:d,onChange:f=>{c(pa(f.target.value)),g("")},onBlur:T,placeholder:s("administration.workspaces.form.codePlaceholder","WS_CODE"),className:k("w-full rounded-none border-0 border-b bg-transparent py-2 font-mono text-base uppercase text-foreground outline-none transition-all placeholder:text-muted-foreground/50 focus-visible:border-foreground focus-visible:ring-0",u?"border-destructive":"border-border"),disabled:v,maxLength:50}),e.jsx("p",{className:k("mt-1 text-xs",u?"text-destructive":"text-muted-foreground"),children:u||s("administration.workspaces.form.codeHelper","2-50 uppercase characters")})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 border-t border-border p-6",children:[e.jsx("button",{type:"button",onClick:()=>r(!1),className:"rounded-none border border-border bg-background px-6 py-2.5 font-mono text-xs uppercase tracking-wider text-muted-foreground transition-colors hover:border-foreground hover:text-foreground disabled:opacity-50",disabled:v,children:s("common.cancel","Cancel")}),e.jsxs("button",{type:"submit",className:"inline-flex items-center gap-2 rounded-none bg-foreground px-6 py-2.5 font-mono text-xs uppercase tracking-wider text-background transition-colors hover:bg-foreground/90 disabled:opacity-50",disabled:v,children:[v&&e.jsx(J,{size:16,className:"animate-spin"}),a==="create"?s("common.create","Create"):s("common.save","Save")]})]})]})]})})}function ha({open:t,onOpenChange:r,workspace:a}){const{t:n}=$(),{toast:s}=ne(),l=Tt(),i=l.isPending,d=async()=>{if(a)try{await l.mutateAsync({id:a.id,status:"ARCHIVED"}),s({title:n("administration.workspaces.archive.success","Workspace archived")}),r(!1)}catch{s({variant:"destructive",title:n("common.error","Error"),description:n("administration.workspaces.archive.error","Failed to archive workspace")})}};return a?e.jsx(ae,{open:t,onOpenChange:r,children:e.jsxs(Te,{className:"sm:max-w-md",children:[e.jsxs(Ie,{children:[e.jsxs(re,{className:"flex items-center gap-2 font-mono text-sm uppercase tracking-widest",children:[e.jsx(se,{size:18,className:"text-destructive"}),n("administration.workspaces.archive.title","Archive Workspace")]}),e.jsx(oe,{children:n("administration.workspaces.archive.confirm",'Are you sure you want to archive "{{name}}"?',{name:a.name})})]}),e.jsxs("div",{className:"space-y-3 py-4",children:[e.jsx("div",{className:"rounded-sm border border-warning-border bg-warning-muted p-3",children:e.jsx("p",{className:"text-sm text-warning-foreground",children:n("administration.workspaces.archive.warning","This workspace may contain templates and documents that will become inaccessible.")})}),e.jsx("p",{className:"text-sm text-muted-foreground",children:n("administration.workspaces.archive.description","Archiving will hide this workspace from all users. The data will be preserved and can be restored by an administrator.")})]}),e.jsxs(Ee,{className:"gap-2 sm:gap-0",children:[e.jsx("button",{type:"button",onClick:()=>r(!1),className:"rounded-none border border-border bg-background px-6 py-2.5 font-mono text-xs uppercase tracking-wider text-muted-foreground transition-colors hover:border-foreground hover:text-foreground",disabled:i,children:n("common.cancel","Cancel")}),e.jsxs("button",{type:"button",onClick:d,className:"inline-flex items-center gap-2 rounded-none bg-destructive px-6 py-2.5 font-mono text-xs uppercase tracking-wider text-destructive-foreground transition-colors hover:bg-destructive/90 disabled:opacity-50",disabled:i,children:[i&&e.jsx(J,{size:14,className:"animate-spin"}),n("common.archive","Archive")]})]})]})}):e.jsx(e.Fragment,{})}const je="p-4 text-left font-mono text-xs uppercase tracking-widest text-muted-foreground",ga=10,ba=300,vt=[{value:"",labelKey:"administration.workspaces.filter.allStatuses",fallback:"All Statuses"},{value:"ACTIVE",labelKey:"administration.workspaces.filter.active",fallback:"Active"},{value:"SUSPENDED",labelKey:"administration.workspaces.filter.suspended",fallback:"Suspended"},{value:"ARCHIVED",labelKey:"administration.workspaces.filter.archived",fallback:"Archived"}];function ja(t){return new Date(t).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})}function va({workspace:t,index:r,isEntering:a,isFilterAnimating:n,onEdit:s,onArchive:l,getStatusAction:i,t:d}){const c=r<10,u=c?r*.05:0,g=()=>a&&c?{opacity:0,x:50}:n&&c?{opacity:0,x:20}:{opacity:1,x:0},p=i(t),b=p.icon;return e.jsxs(ms.tr,{initial:g(),animate:{opacity:1,x:0},transition:{duration:n?.15:.2,ease:"easeOut",delay:a||n?u:0},className:"border-b last:border-0 hover:bg-muted/50",style:{overflow:"hidden"},children:[e.jsx("td",{className:"p-4",children:e.jsx("span",{className:"font-medium",children:t.name})}),e.jsx("td",{className:"p-4",children:e.jsx("span",{className:"inline-flex items-center rounded-sm border px-2 py-0.5 font-mono text-xs uppercase",children:t.code})}),e.jsx("td",{className:"whitespace-nowrap p-4",children:e.jsx(ma,{status:t.status})}),e.jsx("td",{className:"whitespace-nowrap p-4 font-mono text-sm text-muted-foreground",children:ja(t.createdAt)}),e.jsx("td",{className:"p-4",children:e.jsxs(Ce,{children:[e.jsx(Se,{asChild:!0,children:e.jsx("button",{className:"rounded-sm p-1 hover:bg-muted",children:e.jsx(tt,{size:16})})}),e.jsxs(Ae,{align:"end",children:[e.jsxs(U,{onClick:()=>s(t),children:[e.jsx(Je,{size:14,className:"mr-2"}),d("administration.workspaces.actions.edit","Edit")]}),e.jsxs(U,{onClick:p.onClick,children:[e.jsx(b,{size:14,className:"mr-2"}),p.label]}),t.status!=="ARCHIVED"&&e.jsxs(e.Fragment,{children:[e.jsx(ye,{}),e.jsxs(U,{onClick:()=>l(t),className:"text-destructive focus:text-destructive",children:[e.jsx(At,{size:14,className:"mr-2"}),d("administration.workspaces.actions.archive","Archive")]})]})]})]})})]})}function ya(){var Z;const{t}=$(),{toast:r}=ne(),{currentTenant:a}=we(),[n,s]=o.useState(1),[l,i]=o.useState(""),[d,c]=o.useState(""),[u,g]=o.useState(""),[p,b]=o.useState(!1),[j,h]=o.useState(!0),[y,A]=o.useState(0),v=o.useRef(null),[T,S]=o.useState(!1),[N,f]=o.useState("create"),[w,z]=o.useState(null),[P,D]=o.useState(!1),_=Tt();o.useEffect(()=>{const E=setTimeout(()=>{h(!1)},600);return()=>clearTimeout(E)},[]),o.useEffect(()=>{const E=setTimeout(()=>{c(l)},ba);return()=>clearTimeout(E)},[l]),o.useEffect(()=>{s(1)},[d,u]);const{data:B,isLoading:C,error:L,isFetching:F}=Us((a==null?void 0:a.id)??null,n,ga,d.length>=3?d:void 0,u||void 0),m=((Z=B==null?void 0:B.pagination)==null?void 0:Z.totalPages)??1,R=o.useMemo(()=>((B==null?void 0:B.data)??[]).filter(E=>E.type==="CLIENT"),[B==null?void 0:B.data]);o.useEffect(()=>{const E=R.map(X=>X.id).join(",");R.length>0&&v.current!==E&&v.current!==null&&!j&&A(X=>X+1),v.current=E},[R,j]);const I=()=>{z(null),f("create"),S(!0)},q=E=>{z(E),f("edit"),S(!0)},G=async(E,X)=>{try{await _.mutateAsync({id:E.id,status:X}),r({title:t("administration.workspaces.statusUpdated","Status updated")})}catch{r({variant:"destructive",title:t("common.error","Error"),description:t("administration.workspaces.statusError","Failed to update status")})}},ce=E=>{z(E),D(!0)},le=E=>E.status==="ACTIVE"?{label:t("administration.workspaces.actions.suspend","Suspend"),icon:Ct,onClick:()=>G(E,"SUSPENDED")}:E.status==="SUSPENDED"?{label:t("administration.workspaces.actions.activate","Activate"),icon:Oe,onClick:()=>G(E,"ACTIVE")}:{label:t("administration.workspaces.actions.activate","Activate"),icon:Oe,onClick:()=>G(E,"ACTIVE")},O=vt.find(E=>E.value===u);return e.jsxs("div",{className:"space-y-6",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:t("administration.workspaces.description","Manage workspaces for this tenant.")}),e.jsxs("div",{className:"flex flex-col gap-4 md:flex-row md:items-center md:justify-between",children:[e.jsxs("div",{className:"flex flex-col gap-3 md:flex-row md:items-center",children:[e.jsxs("div",{className:"group relative w-full md:max-w-xs",children:[e.jsx(Y,{className:"absolute left-0 top-1/2 -translate-y-1/2 text-muted-foreground/50 transition-colors group-focus-within:text-foreground",size:18}),e.jsx("input",{type:"text",placeholder:t("administration.workspaces.searchPlaceholder","Search workspaces..."),value:l,onChange:E=>i(E.target.value),className:"w-full rounded-none border-0 border-b border-border bg-transparent py-2 pl-7 pr-4 text-sm font-light text-foreground outline-none transition-all placeholder:text-muted-foreground/50 focus-visible:border-foreground focus-visible:ring-0"}),e.jsx("p",{className:`absolute left-0 top-full whitespace-nowrap pt-1 text-xs text-muted-foreground transition-opacity duration-200 ${l.length>0&&l.length<3?"opacity-100":"opacity-0 pointer-events-none"}`,children:t("common.searchMinChars","Type at least 3 characters to search")})]}),e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:()=>b(!p),className:"inline-flex items-center gap-2 whitespace-nowrap rounded-sm border border-border px-3 py-2 text-sm text-foreground transition-colors hover:bg-muted",children:[O?t(O.labelKey,O.fallback):t("administration.workspaces.filter.allStatuses","All Statuses"),e.jsx(Fe,{size:16,className:`transition-transform ${p?"rotate-180":""}`})]}),p&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-10",onClick:()=>b(!1)}),e.jsx("div",{className:"absolute left-0 top-full z-20 mt-1 min-w-[160px] rounded-sm border border-border bg-popover py-1 shadow-md",children:vt.map(E=>e.jsx("button",{onClick:()=>{g(E.value),b(!1)},className:`flex w-full items-center px-3 py-2 text-left text-sm transition-colors hover:bg-accent ${u===E.value?"font-medium text-foreground":"text-muted-foreground"}`,children:t(E.labelKey,E.fallback)},E.value))})]})]})]}),e.jsxs("button",{onClick:I,className:"inline-flex items-center gap-2 rounded-sm bg-foreground px-4 py-2 font-mono text-xs uppercase tracking-wider text-background transition-colors hover:bg-foreground/90",children:[e.jsx(_e,{size:14}),t("administration.workspaces.addWorkspace","Add Workspace")]})]}),e.jsxs("div",{className:"rounded-sm border",children:[C&&e.jsx("div",{className:"divide-y",children:[...Array(5)].map((E,X)=>e.jsxs("div",{className:"flex items-center gap-4 p-4",children:[e.jsx(W,{className:"h-4 w-40"}),e.jsx(W,{className:"h-4 w-20"}),e.jsx(W,{className:"h-4 w-28"})]},X))}),L&&!C&&e.jsxs("div",{className:"flex flex-col items-center justify-center p-12 text-center",children:[e.jsx(se,{size:32,className:"mb-3 text-destructive"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:t("administration.workspaces.loadError","Failed to load workspaces")})]}),!C&&!L&&R.length===0&&e.jsxs("div",{className:"flex flex-col items-center justify-center p-12 text-center",children:[e.jsx(vs,{size:32,className:"mb-3 text-muted-foreground/50"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:d.length>=3||u?t("administration.workspaces.noResults","No workspaces match your search"):t("administration.workspaces.empty","No workspaces found")})]}),!C&&!L&&R.length>0&&e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:`${je} w-[30%]`,children:t("administration.workspaces.columns.name","Name")}),e.jsx("th",{className:`${je} w-[15%]`,children:t("administration.workspaces.columns.code","Code")}),e.jsx("th",{className:`${je} w-[15%]`,children:t("administration.workspaces.columns.status","Status")}),e.jsx("th",{className:`${je} w-[25%]`,children:t("administration.workspaces.columns.created","Created")}),e.jsx("th",{className:`${je} w-[15%]`})]})}),e.jsx("tbody",{children:R.map((E,X)=>e.jsx(va,{workspace:E,index:X,isEntering:j||y>0,isFilterAnimating:y>0,onEdit:q,onArchive:ce,getStatusAction:le,t},`${E.id}-${y}`))})]})]}),!C&&!L&&e.jsx(et,{page:n,totalPages:m,onPageChange:s,disabled:F,className:"py-2"}),e.jsx(fa,{open:T,onOpenChange:S,mode:N,workspace:w}),e.jsx(ha,{open:P,onOpenChange:D,workspace:w})]})}const fe="font-mono text-xs uppercase tracking-widest";function Na(){const{t}=$(),{isGlobalSystemWorkspace:r,isTenantSystemWorkspace:a}=we(),n=r(),s=a();return e.jsxs("div",{className:"animate-page-enter flex-1 overflow-y-auto bg-background",children:[e.jsxs("header",{className:"px-4 pb-6 pt-12 md:px-6",children:[e.jsx("div",{className:"mb-1 font-mono text-[10px] uppercase tracking-widest text-muted-foreground",children:n?t("administration.label","System"):t("administration.labelTenant","Tenant")}),e.jsx("h1",{className:"font-display text-4xl font-light tracking-tight",children:t("administration.title","Administration")})]}),e.jsxs("main",{className:"px-4 pb-12 md:px-6",children:[n&&e.jsxs(pt,{defaultValue:"tenants",children:[e.jsxs(ft,{className:"mb-6",children:[e.jsx(xe,{value:"tenants",className:fe,children:t("administration.tabs.tenants","Tenants")}),e.jsx(xe,{value:"document-types",className:fe,children:t("administration.tabs.documentTypes","Document Types")}),e.jsx(xe,{value:"injectables",className:fe,children:t("administration.tabs.injectables","Injectables")}),e.jsx(xe,{value:"audit",className:fe,children:t("administration.tabs.audit","Audit")})]}),e.jsx(pe,{value:"tenants",children:e.jsx(la,{})}),e.jsx(pe,{value:"document-types",children:e.jsx(jt,{})}),e.jsx(pe,{value:"injectables",children:e.jsx(Un,{})}),e.jsx(pe,{value:"audit",children:e.jsx(Wn,{})})]}),s&&e.jsxs(pt,{defaultValue:"workspaces",children:[e.jsxs(ft,{className:"mb-6",children:[e.jsx(xe,{value:"workspaces",className:fe,children:t("administration.tabs.workspaces","Workspaces")}),e.jsx(xe,{value:"document-types",className:fe,children:t("administration.tabs.documentTypes","Document Types")})]}),e.jsx(pe,{value:"workspaces",children:e.jsx(ya,{})}),e.jsx(pe,{value:"document-types",children:e.jsx(jt,{})})]})]})]})}const qa=Na;export{qa as component};
