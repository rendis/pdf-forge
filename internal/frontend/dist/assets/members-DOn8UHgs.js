import{a as h,y as j,j as e,e as D,z as Z,r as f,X as I,b as ee}from"./index-DwNOOeRl.js";import{u as $,a as N}from"./useMutation-w19V-Ooi.js";import{B as L}from"./button-KMv-mK5M.js";import{S as k}from"./skeleton-w7o_KLq8.js";import{u as y,D as se,a as re,b as te,d as K}from"./dropdown-menu-1OjhImya.js";import{D as q,B as P,a as _,b as F,c as O,T as ne}from"./dialog-CqnzisI0.js";import{S as Q,a as V,b as G,c as H,d as z,U as oe,e as ae,f as le}from"./select-BtW0cTDd.js";import{E as ie}from"./ellipsis-gnN1bKX8.js";import{u as ce}from"./usePermission-gg7bhPld.js";import"./index-BH2KGd0_.js";import"./index-BdQq_4o_.js";import"./index-D2bKTKDf.js";import"./chevron-down-Du3sppip.js";const W="/system/users";async function me(){return(await h.get(W)).data.data}async function de(s){return(await h.post(W,s)).data}async function ue(s){await h.delete(`${W}/${s}/role`)}const E={all:["system-members"],list:()=>[...E.all,"list"]};function be(){return $({queryKey:E.list(),queryFn:me,staleTime:120*1e3})}function xe(){const s=j();return N({mutationFn:r=>de(r),onSuccess:()=>{s.invalidateQueries({queryKey:E.all})}})}function pe(){const s=j();return N({mutationFn:r=>ue(r),onSuccess:()=>{s.invalidateQueries({queryKey:E.all})}})}const fe={SUPERADMIN:"border-destructive/30 bg-destructive/10 text-destructive",PLATFORM_ADMIN:"border-warning-border bg-warning-muted text-warning-foreground",TENANT_OWNER:"border-admin-border bg-admin-muted text-admin-foreground",TENANT_ADMIN:"border-accent-blue-border bg-accent-blue-muted text-accent-blue-foreground",OWNER:"border-admin-border bg-admin-muted text-admin-foreground",ADMIN:"border-accent-blue-border bg-accent-blue-muted text-accent-blue-foreground",EDITOR:"border-success-border bg-success-muted text-success-foreground",OPERATOR:"border-warning-border bg-warning-muted text-warning-foreground",VIEWER:"border-border bg-muted text-muted-foreground"};function Y({role:s,className:r}){const{t}=y(),a=fe[s]??"border-border bg-muted text-muted-foreground";return e.jsx("span",{className:D("inline-flex items-center rounded-sm border px-2 py-0.5 font-mono text-[10px] uppercase tracking-widest",a,r),children:t(`members.roles.${s}`,s.replace(/_/g," "))})}const ge={ACTIVE:{color:"bg-green-500",label:"Active"},INVITED:{color:"bg-yellow-500",label:"Invited"},SUSPENDED:{color:"bg-red-500",label:"Suspended"},SHADOW:{color:"bg-gray-400",label:"Pending"}};function he({status:s,className:r}){const t=ge[s]??{color:"bg-gray-400",label:s};return e.jsxs("span",{className:D("inline-flex items-center gap-1.5 font-mono text-xs text-muted-foreground",r),children:[e.jsx("span",{className:D("h-1.5 w-1.5 rounded-full",t.color)}),t.label]})}const ye={"user is already a member of this workspace":"members.error.alreadyExists","user is already a member of this tenant":"members.error.alreadyExists","workspace member not found":"members.error.notFound","tenant member not found":"members.error.notFound","cannot remove workspace owner":"members.error.cannotRemoveOwner","cannot remove tenant owner":"members.error.cannotRemoveOwner","invalid workspace role":"members.error.invalidRole","invalid tenant role":"members.error.invalidRole","user already has a system role":"members.error.alreadyExists"};function B(s,r){const t=Z(s),a=ye[t];return a?r(a):t}function je({open:s,onOpenChange:r,memberName:t,currentRole:a,assignableRoles:i,onSubmit:m}){const{t:n}=y(),[o,c]=f.useState(a),[d,u]=f.useState(!1),[b,g]=f.useState(null),l=async x=>{if(x.preventDefault(),o!==a){g(null),u(!0);try{await m(o),r(!1)}catch(v){g(B(v,n))}finally{u(!1)}}};return e.jsx(q,{open:s,onOpenChange:r,children:e.jsxs(P,{className:"max-w-md",children:[e.jsxs("div",{className:"flex items-start justify-between border-b border-border p-6",children:[e.jsxs("div",{children:[e.jsx(_,{className:"font-mono text-sm font-medium uppercase tracking-widest text-foreground",children:n("members.changeRole.title","Change Role")}),e.jsx(F,{className:"mt-1 text-sm font-light text-muted-foreground",children:n("members.changeRole.description","Update role for {{name}}.",{name:t})})]}),e.jsxs(O,{className:"text-muted-foreground transition-colors hover:text-foreground",children:[e.jsx(I,{className:"h-5 w-5"}),e.jsx("span",{className:"sr-only",children:"Close"})]})]}),e.jsxs("form",{onSubmit:l,children:[e.jsxs("div",{className:"space-y-6 p-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"mb-2 block font-mono text-[10px] font-medium uppercase tracking-widest text-muted-foreground",children:n("members.changeRole.current","Current Role")}),e.jsx(Y,{role:a})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-2 block font-mono text-[10px] font-medium uppercase tracking-widest text-muted-foreground",children:n("members.changeRole.new","New Role")}),e.jsxs(Q,{value:o,onValueChange:c,children:[e.jsx(V,{className:"rounded-none border-0 border-b border-border bg-transparent py-2 pl-1 text-base font-light shadow-none focus:ring-0",children:e.jsx(G,{})}),e.jsx(H,{children:i.map(x=>e.jsx(z,{value:x,description:n(`members.roleDescriptions.${x}`,""),children:n(`members.roles.${x}`,x.replace(/_/g," "))},x))})]}),o&&e.jsx("p",{className:"mt-1.5 text-xs text-muted-foreground",children:n(`members.roleDescriptions.${o}`,"")})]}),b&&e.jsx("p",{className:"text-sm text-destructive",children:b})]}),e.jsxs("div",{className:"flex justify-end gap-3 border-t border-border p-6",children:[e.jsx("button",{type:"button",onClick:()=>r(!1),disabled:d,className:"rounded-none border border-border bg-background px-6 py-2.5 font-mono text-xs uppercase tracking-wider text-muted-foreground transition-colors hover:border-foreground hover:text-foreground disabled:opacity-50",children:n("common.cancel","Cancel")}),e.jsx("button",{type:"submit",disabled:o===a||d,className:"rounded-none bg-foreground px-6 py-2.5 font-mono text-xs uppercase tracking-wider text-background transition-colors hover:bg-foreground/90 disabled:opacity-50",children:d?n("common.processing","Processing..."):n("members.changeRole.submit","Update Role")})]})]})]})})}function Ne({open:s,onOpenChange:r,memberName:t,onConfirm:a}){const{t:i}=y(),[m,n]=f.useState(!1),[o,c]=f.useState(null),d=async()=>{c(null),n(!0);try{await a(),r(!1)}catch(u){c(B(u,i))}finally{n(!1)}};return e.jsx(q,{open:s,onOpenChange:r,children:e.jsxs(P,{className:"max-w-md",children:[e.jsxs("div",{className:"flex items-start justify-between border-b border-border p-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex h-10 w-10 items-center justify-center bg-destructive/10",children:e.jsx(ne,{className:"h-5 w-5 text-destructive"})}),e.jsx(_,{className:"font-mono text-sm font-medium uppercase tracking-widest text-foreground",children:i("members.remove.title","Remove Member")})]}),e.jsxs(O,{className:"text-muted-foreground transition-colors hover:text-foreground",children:[e.jsx(I,{className:"h-5 w-5"}),e.jsx("span",{className:"sr-only",children:"Close"})]})]}),e.jsxs("div",{className:"p-6",children:[e.jsx(F,{className:"text-sm font-light text-muted-foreground",children:i("members.remove.confirm","Are you sure you want to remove {{name}}? This action cannot be undone.",{name:t})}),o&&e.jsx("p",{className:"mt-3 text-sm text-destructive",children:o})]}),e.jsxs("div",{className:"flex justify-end gap-3 border-t border-border p-6",children:[e.jsx("button",{type:"button",onClick:()=>r(!1),disabled:m,className:"rounded-none border border-border bg-background px-6 py-2.5 font-mono text-xs uppercase tracking-wider text-muted-foreground transition-colors hover:border-foreground hover:text-foreground disabled:opacity-50",children:i("common.cancel","Cancel")}),e.jsx("button",{type:"button",onClick:d,disabled:m,className:"rounded-none bg-destructive px-6 py-2.5 font-mono text-xs uppercase tracking-wider text-destructive-foreground transition-colors hover:bg-destructive/90 disabled:opacity-50",children:m?i("common.processing","Processing..."):i("members.remove.submit","Remove")})]})]})})}const S="p-4 text-left font-mono text-xs uppercase tracking-widest text-muted-foreground";function ve({members:s,assignableRoles:r,canChangeRole:t,canRemove:a,onChangeRole:i,onRemove:m,removeByUserId:n=!1}){const{t:o}=y(),[c,d]=f.useState(null),[u,b]=f.useState(null),g=t||a;return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"rounded-sm border",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:S,children:o("members.table.name","Name")}),e.jsx("th",{className:S,children:o("members.table.email","Email")}),e.jsx("th",{className:S,children:o("members.table.role","Role")}),e.jsx("th",{className:S,children:o("members.table.status","Status")}),g&&e.jsx("th",{className:`${S} w-12`})]})}),e.jsx("tbody",{children:s.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:g?5:4,className:"p-8 text-center text-sm text-muted-foreground",children:o("members.table.empty","No members found")})}):s.map(l=>e.jsxs("tr",{className:"border-b last:border-0 hover:bg-muted/50",children:[e.jsx("td",{className:"p-4 font-medium",children:l.fullName||"—"}),e.jsx("td",{className:"p-4 font-mono text-sm text-muted-foreground",children:l.email}),e.jsx("td",{className:"p-4",children:e.jsx(Y,{role:l.role})}),e.jsx("td",{className:"p-4",children:e.jsx(he,{status:l.status})}),g&&e.jsx("td",{className:"p-4",children:e.jsxs(se,{children:[e.jsx(re,{asChild:!0,children:e.jsx(L,{variant:"ghost",size:"icon",className:"h-8 w-8",children:e.jsx(ie,{className:"h-4 w-4"})})}),e.jsxs(te,{align:"end",children:[t&&i&&e.jsxs(K,{onClick:()=>d(l),children:[e.jsx(oe,{className:"mr-2 h-4 w-4"}),o("members.actions.changeRole","Change Role")]}),a&&m&&e.jsxs(K,{onClick:()=>b(l),className:"text-destructive focus:text-destructive",children:[e.jsx(ae,{className:"mr-2 h-4 w-4"}),o("members.actions.remove","Remove")]})]})]})})]},l.id))})]})}),c&&i&&e.jsx(je,{open:!!c,onOpenChange:l=>!l&&d(null),memberName:c.fullName||c.email,currentRole:c.role,assignableRoles:r,onSubmit:l=>i(c.id,l)}),u&&m&&e.jsx(Ne,{open:!!u,onOpenChange:l=>!l&&b(null),memberName:u.fullName||u.email,onConfirm:()=>m(n?u.userId:u.id)})]})}function we({open:s,onOpenChange:r,assignableRoles:t,onSubmit:a,title:i,description:m}){const{t:n}=y(),[o,c]=f.useState(""),[d,u]=f.useState(""),[b,g]=f.useState(t[0]??""),[l,x]=f.useState(!1),[v,w]=f.useState(null),C=f.useCallback(p=>{p||(c(""),u(""),g(t[0]??""),w(null)),r(p)},[r,t]),J=async p=>{if(p.preventDefault(),!(!o.trim()||!d.trim()||!b)){w(null),x(!0);try{await a({email:o.trim(),fullName:d.trim(),role:b}),C(!1)}catch(X){w(B(X,n))}finally{x(!1)}}};return e.jsx(q,{open:s,onOpenChange:C,children:e.jsxs(P,{className:"max-w-md",children:[e.jsxs("div",{className:"flex items-start justify-between border-b border-border p-6",children:[e.jsxs("div",{children:[e.jsx(_,{className:"font-mono text-sm font-medium uppercase tracking-widest text-foreground",children:i??n("members.add.title","Add Member")}),e.jsx(F,{className:"mt-1 text-sm font-light text-muted-foreground",children:m??n("members.add.description","Add a user by email and assign a role.")})]}),e.jsxs(O,{className:"text-muted-foreground transition-colors hover:text-foreground",children:[e.jsx(I,{className:"h-5 w-5"}),e.jsx("span",{className:"sr-only",children:"Close"})]})]}),e.jsxs("form",{onSubmit:J,children:[e.jsxs("div",{className:"space-y-6 p-6",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"member-email",className:"mb-2 block font-mono text-[10px] font-medium uppercase tracking-widest text-muted-foreground",children:n("members.add.email","Email")}),e.jsx("input",{id:"member-email",type:"email",value:o,onChange:p=>c(p.target.value),placeholder:"user@example.com",required:!0,autoFocus:!0,className:"w-full rounded-none border-0 border-b border-border bg-transparent py-2 text-base font-light text-foreground outline-none transition-all placeholder:text-muted-foreground/50 focus-visible:border-foreground focus-visible:ring-0"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"member-fullname",className:"mb-2 block font-mono text-[10px] font-medium uppercase tracking-widest text-muted-foreground",children:n("members.add.fullName","Full Name")}),e.jsx("input",{id:"member-fullname",type:"text",required:!0,value:d,onChange:p=>u(p.target.value),placeholder:"John Doe",className:"w-full rounded-none border-0 border-b border-border bg-transparent py-2 text-base font-light text-foreground outline-none transition-all placeholder:text-muted-foreground/50 focus-visible:border-foreground focus-visible:ring-0"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-2 block font-mono text-[10px] font-medium uppercase tracking-widest text-muted-foreground",children:n("members.add.role","Role")}),e.jsxs(Q,{value:b,onValueChange:g,children:[e.jsx(V,{className:"rounded-none border-0 border-b border-border bg-transparent py-2 pl-1 text-base font-light shadow-none focus:ring-0",children:e.jsx(G,{})}),e.jsx(H,{children:t.map(p=>e.jsx(z,{value:p,description:n(`members.roleDescriptions.${p}`,""),children:n(`members.roles.${p}`,p.replace(/_/g," "))},p))})]}),b&&e.jsx("p",{className:"mt-1.5 text-xs text-muted-foreground",children:n(`members.roleDescriptions.${b}`,"")})]}),e.jsx("p",{className:`min-h-[20px] text-sm text-destructive ${v?"visible":"invisible"}`,children:v??" "})]}),e.jsxs("div",{className:"flex justify-end gap-3 border-t border-border p-6",children:[e.jsx("button",{type:"button",onClick:()=>C(!1),disabled:l,className:"rounded-none border border-border bg-background px-6 py-2.5 font-mono text-xs uppercase tracking-wider text-muted-foreground transition-colors hover:border-foreground hover:text-foreground disabled:opacity-50",children:n("common.cancel","Cancel")}),e.jsx("button",{type:"submit",disabled:!o.trim()||!b||l,className:"rounded-none bg-foreground px-6 py-2.5 font-mono text-xs uppercase tracking-wider text-background transition-colors hover:bg-foreground/90 disabled:opacity-50",children:l?n("common.processing","Processing..."):n("members.add.submit","Add Member")})]})]})]})})}function U({label:s,title:r,description:t,members:a,isLoading:i,error:m,assignableRoles:n,canAdd:o,canChangeRole:c,canRemove:d,onAdd:u,onChangeRole:b,onRemove:g,removeByUserId:l}){const{t:x}=y(),[v,w]=f.useState(!1);return e.jsxs("div",{className:"animate-page-enter flex-1 overflow-y-auto bg-background",children:[e.jsxs("header",{className:"px-4 pb-6 pt-12 md:px-6",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"mb-1 font-mono text-[10px] uppercase tracking-widest text-muted-foreground",children:s}),e.jsx("h1",{className:"font-display text-4xl font-light tracking-tight",children:r})]}),o&&e.jsxs(L,{onClick:()=>w(!0),className:"rounded-none bg-foreground text-background hover:bg-foreground/90",children:[e.jsx(le,{className:"mr-2 h-4 w-4"}),x("members.add.button","ADD MEMBER")]})]}),e.jsx("p",{className:"mt-2 text-sm text-muted-foreground",children:t})]}),e.jsx("main",{className:"px-4 pb-12 md:px-6",children:i?e.jsxs("div",{className:"space-y-3",children:[e.jsx(k,{className:"h-10 w-full"}),e.jsx(k,{className:"h-14 w-full"}),e.jsx(k,{className:"h-14 w-full"}),e.jsx(k,{className:"h-14 w-full"})]}):m?e.jsx("div",{className:"rounded-sm border border-destructive/20 bg-destructive/5 p-6 text-center text-sm text-destructive",children:x("members.error.load","Failed to load members")}):e.jsx(ve,{members:a,assignableRoles:n,canChangeRole:c,canRemove:d,onChangeRole:b,onRemove:g,removeByUserId:l})}),e.jsx(we,{open:v,onOpenChange:w,assignableRoles:n,onSubmit:u})]})}const Se=["SUPERADMIN","PLATFORM_ADMIN"];function Re(s){var r,t,a;return{id:s.id,userId:s.userId,email:((r=s.user)==null?void 0:r.email)??"",fullName:((t=s.user)==null?void 0:t.fullName)??"",role:s.role,status:((a=s.user)==null?void 0:a.status)??"ACTIVE"}}function Me(){const{t:s}=y(),{data:r,isLoading:t,error:a}=be(),i=xe(),m=pe(),n=(r??[]).map(Re);return e.jsx(U,{label:s("members.system.label","System"),title:s("members.system.title","System Users"),description:s("members.system.description","Manage users with system-level roles."),members:n,isLoading:t,error:a,assignableRoles:Se,canAdd:!0,canChangeRole:!1,canRemove:!0,onAdd:async o=>{await i.mutateAsync({email:o.email,fullName:o.fullName,role:o.role})},onRemove:async o=>{await m.mutateAsync(o)},removeByUserId:!0})}const A="/tenant/members";async function ke(){return(await h.get(A)).data.data}async function Ee(s){return(await h.post(A,s)).data}async function Ae(s,r){return(await h.put(`${A}/${s}`,r)).data}async function Te(s){await h.delete(`${A}/${s}`)}const R={all:["tenant-members"],list:()=>[...R.all,"list"]};function Ce(){return $({queryKey:R.list(),queryFn:ke,staleTime:120*1e3})}function De(){const s=j();return N({mutationFn:r=>Ee(r),onSuccess:()=>{s.invalidateQueries({queryKey:R.all})}})}function Ie(){const s=j();return N({mutationFn:({memberId:r,data:t})=>Ae(r,t),onSuccess:()=>{s.invalidateQueries({queryKey:R.all})}})}function $e(){const s=j();return N({mutationFn:r=>Te(r),onSuccess:()=>{s.invalidateQueries({queryKey:R.all})}})}const qe=["TENANT_OWNER","TENANT_ADMIN"];function Pe(s){var r,t,a,i;return{id:s.id,userId:((r=s.user)==null?void 0:r.id)??"",email:((t=s.user)==null?void 0:t.email)??"",fullName:((a=s.user)==null?void 0:a.fullName)??"",role:s.role,status:((i=s.user)==null?void 0:i.status)??s.membershipStatus}}function _e(){const{t:s}=y(),{data:r,isLoading:t,error:a}=Ce(),i=De(),m=Ie(),n=$e(),o=(r??[]).map(Pe);return e.jsx(U,{label:s("members.tenant.label","Tenant"),title:s("members.tenant.title","Tenant Members"),description:s("members.tenant.description","Manage members of this organization."),members:o,isLoading:t,error:a,assignableRoles:qe,canAdd:!0,canChangeRole:!0,canRemove:!0,onAdd:async c=>{await i.mutateAsync({email:c.email,fullName:c.fullName,role:c.role})},onChangeRole:async(c,d)=>{await m.mutateAsync({memberId:c,data:{role:d}})},onRemove:async c=>{await n.mutateAsync(c)}})}const T="/workspace/members";async function Fe(){return(await h.get(T)).data.data}async function Oe(s){return(await h.post(T,s)).data}async function We(s,r){return(await h.put(`${T}/${s}`,r)).data}async function Be(s){await h.delete(`${T}/${s}`)}const M={all:["workspace-members"],list:()=>[...M.all,"list"]};function Ue(){return $({queryKey:M.list(),queryFn:Fe,staleTime:120*1e3})}function Ke(){const s=j();return N({mutationFn:r=>Oe(r),onSuccess:()=>{s.invalidateQueries({queryKey:M.all})}})}function Le(){const s=j();return N({mutationFn:({memberId:r,data:t})=>We(r,t),onSuccess:()=>{s.invalidateQueries({queryKey:M.all})}})}function Qe(){const s=j();return N({mutationFn:r=>Be(r),onSuccess:()=>{s.invalidateQueries({queryKey:M.all})}})}const Ve=["ADMIN","EDITOR","OPERATOR","VIEWER"];function Ge(s){var r,t,a,i;return{id:s.id,userId:((r=s.user)==null?void 0:r.id)??"",email:((t=s.user)==null?void 0:t.email)??"",fullName:((a=s.user)==null?void 0:a.fullName)??"",role:s.role,status:((i=s.user)==null?void 0:i.status)??s.membershipStatus}}function He(){const{t:s}=y(),{hasPermission:r,Permission:t}=ce(),{data:a,isLoading:i,error:m}=Ue(),n=Ke(),o=Le(),c=Qe(),d=(a??[]).map(Ge),u=r(t.MEMBERS_INVITE),b=r(t.MEMBERS_UPDATE_ROLE),g=r(t.MEMBERS_REMOVE);return e.jsx(U,{label:s("members.workspace.label","Workspace"),title:s("members.workspace.title","Members"),description:s("members.workspace.description","Manage workspace members and their roles."),members:d,isLoading:i,error:m,assignableRoles:Ve,canAdd:u,canChangeRole:b,canRemove:g,onAdd:async l=>{await n.mutateAsync({email:l.email,fullName:l.fullName,role:l.role})},onChangeRole:async(l,x)=>{await o.mutateAsync({memberId:l,data:{role:x}})},onRemove:async l=>{await c.mutateAsync(l)}})}function is(){const{isGlobalSystemWorkspace:s,isTenantSystemWorkspace:r}=ee();return s()?e.jsx(Me,{}):r()?e.jsx(_e,{}):e.jsx(He,{})}export{is as component};
