import{a as j,y as R,j as e,r as g,X as V,m as M,T as k,k as C,n as D,e as F,b as q}from"./index-YYj3FBXU.js";import{S as G}from"./skeleton-DR0ZwBB5.js";import{u as O,P as S}from"./usePermission-DOHebSR5.js";import{u as J,a as N}from"./useMutation-DMBu63cN.js";import{D as T,B as I,a as P,b as L,c as $,T as U}from"./dialog-CB29n4bA.js";import{u as h,D as H,a as Q,b as X,d as E,f as Y}from"./dropdown-menu-C_J-baFS.js";import{V as B}from"./variable-Dtxt5UXL.js";import{E as Z}from"./ellipsis-BZR-ZpiN.js";import{P as ee,a as _}from"./plus-Db3KDbnG.js";import{P as te,a as se}from"./power-Dzw7xQJK.js";import{T as ae}from"./trash-6czKAp0V.js";import"./index-BZogh0PE.js";const v="/workspace/injectables";async function re(){return(await j.get(v)).data.items}async function ne(t){return(await j.post(v,t)).data}async function oe(t,n){return(await j.put(`${v}/${t}`,n)).data}async function ie(t){await j.delete(`${v}/${t}`)}async function le(t){return(await j.post(`${v}/${t}/activate`)).data}async function ce(t){return(await j.post(`${v}/${t}/deactivate`)).data}const A={all:["workspace-injectables"],lists:()=>[...A.all,"list"],list:t=>[...A.lists(),t]};function w(){const t=R();return()=>t.invalidateQueries({queryKey:A.all})}function de(t){return J({queryKey:A.list(t??""),queryFn:re,enabled:!!t,staleTime:300*1e3})}function ue(){const t=w();return N({mutationFn:ne,onSuccess:t})}function me(){const t=w();return N({mutationFn:({id:n,data:s})=>oe(n,s),onSuccess:t})}function xe(){const t=w();return N({mutationFn:ie,onSuccess:t})}function pe(){const t=w();return N({mutationFn:le,onSuccess:t})}function ge(){const t=w();return N({mutationFn:ce,onSuccess:t})}function K({keyValue:t,onKeyChange:n,label:s,onLabelChange:r,defaultValue:a,onDefaultValueChange:o,description:x,onDescriptionChange:p,showKeyHint:c=!0,idPrefix:l}){const{t:i}=h(),u="w-full rounded-none border-0 border-b border-border bg-transparent py-2 text-base font-light text-foreground outline-none transition-all placeholder:text-muted-foreground/50 focus-visible:border-foreground focus-visible:ring-0",d="mb-2 block font-mono text-[10px] font-medium uppercase tracking-widest text-muted-foreground",b="mt-1 text-right text-[10px] font-mono text-muted-foreground/60";return e.jsxs("div",{className:"space-y-6 p-6",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:`${l}-label`,className:d,children:i("variables.label","Display Label")}),e.jsx("input",{id:`${l}-label`,type:"text",value:s,onChange:m=>r(m.target.value),placeholder:i("variables.labelPlaceholder","e.g., Company Name"),maxLength:255,autoFocus:!0,className:u}),e.jsxs("div",{className:b,children:[s.length,"/255"]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:`${l}-key`,className:d,children:i("variables.key","Variable Key")}),e.jsx("input",{id:`${l}-key`,type:"text",value:t,onChange:m=>n(m.target.value.toLowerCase().replace(/[^a-z0-9_]/g,"")),placeholder:i("variables.keyPlaceholder","e.g., company_name"),maxLength:100,className:`${u} font-mono text-sm`}),e.jsxs("div",{className:"flex items-center justify-between mt-1",children:[c?e.jsx("p",{className:"text-xs text-muted-foreground/70",children:i("variables.keyHint","Use snake_case format (letters, numbers, underscores)")}):e.jsx("span",{}),e.jsxs("span",{className:"text-[10px] font-mono text-muted-foreground/60",children:[t.length,"/100"]})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:`${l}-defaultValue`,className:d,children:i("variables.defaultValue","Default Value")}),e.jsx("input",{id:`${l}-defaultValue`,type:"text",value:a,onChange:m=>o(m.target.value),placeholder:i("variables.defaultValuePlaceholder","e.g., Acme Corporation"),className:u})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:`${l}-description`,className:d,children:[i("variables.description","Description"),e.jsxs("span",{className:"ml-1 normal-case text-muted-foreground/50",children:["(",i("common.optional","optional"),")"]})]}),e.jsx("input",{id:`${l}-description`,type:"text",value:x,onChange:m=>p(m.target.value),placeholder:i("variables.descriptionPlaceholder","Brief description of the variable"),maxLength:500,className:u}),e.jsxs("div",{className:b,children:[x.length,"/500"]})]})]})}function W(t){return t.toLowerCase().trim().replace(/[^a-z0-9\s]/g,"").replace(/\s+/g,"_")}function be({open:t,onOpenChange:n}){const{t:s}=h(),[r,a]=g.useState(""),[o,x]=g.useState(""),[p,c]=g.useState(""),[l,i]=g.useState(""),u=ue(),d=g.useCallback(f=>{f||(a(""),x(""),c(""),i("")),n(f)},[n]);function b(f){x(f),(!r||r===W(o))&&a(W(f))}async function m(f){if(f.preventDefault(),!(!r.trim()||!o.trim()||!p.trim()))try{await u.mutateAsync({key:r.trim(),label:o.trim(),defaultValue:p.trim(),description:l.trim()||void 0}),d(!1)}catch{}}const y=r.trim().length>0&&o.trim().length>0&&p.trim().length>0;return e.jsx(T,{open:t,onOpenChange:d,children:e.jsxs(I,{className:"max-w-md",children:[e.jsxs("div",{className:"flex items-start justify-between border-b border-border p-6",children:[e.jsxs("div",{children:[e.jsx(P,{className:"font-mono text-sm font-medium uppercase tracking-widest text-foreground",children:s("variables.createDialog.title","New Variable")}),e.jsx(L,{className:"mt-1 text-sm font-light text-muted-foreground",children:s("variables.createDialog.description","Create a new variable to use in templates")})]}),e.jsxs($,{className:"text-muted-foreground transition-colors hover:text-foreground",children:[e.jsx(V,{className:"h-5 w-5"}),e.jsx("span",{className:"sr-only",children:"Close"})]})]}),e.jsxs("form",{onSubmit:m,children:[e.jsx(K,{keyValue:r,onKeyChange:a,label:o,onLabelChange:b,defaultValue:p,onDefaultValueChange:c,description:l,onDescriptionChange:i,idPrefix:"injectable"}),e.jsxs("div",{className:"flex justify-end gap-3 border-t border-border p-6",children:[e.jsx("button",{type:"button",onClick:()=>d(!1),disabled:u.isPending,className:"rounded-none border border-border bg-background px-6 py-2.5 font-mono text-xs uppercase tracking-wider text-muted-foreground transition-colors hover:border-foreground hover:text-foreground disabled:opacity-50",children:s("common.cancel","Cancel")}),e.jsx("button",{type:"submit",disabled:!y||u.isPending,className:"rounded-none bg-foreground px-6 py-2.5 font-mono text-xs uppercase tracking-wider text-background transition-colors hover:bg-foreground/90 disabled:opacity-50",children:u.isPending?s("common.creating","Creating..."):s("variables.createDialog.submit","Create Variable")})]})]})]})})}function fe({open:t,onOpenChange:n,injectable:s}){const{t:r}=h(),a=xe();async function o(){if(!(!s||a.isPending))try{await a.mutateAsync(s.id),n(!1)}catch{}}return e.jsx(T,{open:t,onOpenChange:n,children:e.jsxs(I,{className:"max-w-md",children:[e.jsxs("div",{className:"flex items-start justify-between border-b border-border p-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex h-10 w-10 items-center justify-center bg-destructive/10",children:e.jsx(U,{className:"h-5 w-5 text-destructive"})}),e.jsx(P,{className:"font-mono text-sm font-medium uppercase tracking-widest text-foreground",children:r("variables.deleteDialog.title","Delete Variable")})]}),e.jsxs($,{className:"text-muted-foreground transition-colors hover:text-foreground",children:[e.jsx(V,{className:"h-5 w-5"}),e.jsx("span",{className:"sr-only",children:"Close"})]})]}),e.jsx("div",{className:"p-6",children:e.jsx(L,{className:"text-sm font-light text-muted-foreground",children:r("variables.deleteDialog.message",'Are you sure you want to delete the variable "{{name}}"? This action cannot be undone.',{name:(s==null?void 0:s.label)??""})})}),e.jsxs("div",{className:"flex justify-end gap-3 border-t border-border p-6",children:[e.jsx("button",{type:"button",onClick:()=>n(!1),disabled:a.isPending,className:"rounded-none border border-border bg-background px-6 py-2.5 font-mono text-xs uppercase tracking-wider text-muted-foreground transition-colors hover:border-foreground hover:text-foreground disabled:opacity-50",children:r("common.cancel","Cancel")}),e.jsx("button",{type:"button",onClick:o,disabled:a.isPending,className:"rounded-none bg-destructive px-6 py-2.5 font-mono text-xs uppercase tracking-wider text-destructive-foreground transition-colors hover:bg-destructive/90 disabled:opacity-50",children:a.isPending?r("common.deleting","Deleting..."):r("common.delete","Delete")})]})]})})}function he({open:t,onOpenChange:n,injectable:s}){const{t:r}=h(),[a,o]=g.useState((s==null?void 0:s.key)??""),[x,p]=g.useState((s==null?void 0:s.label)??""),[c,l]=g.useState((s==null?void 0:s.defaultValue)??""),[i,u]=g.useState((s==null?void 0:s.description)??""),d=me();async function b(y){if(y.preventDefault(),!(!s||!a.trim()||!x.trim()||!c.trim()))try{await d.mutateAsync({id:s.id,data:{key:a.trim(),label:x.trim(),defaultValue:c.trim(),description:i.trim()||void 0}}),n(!1)}catch{}}const m=a.trim().length>0&&x.trim().length>0&&c.trim().length>0;return e.jsx(T,{open:t,onOpenChange:n,children:e.jsxs(I,{className:"max-w-md",children:[e.jsxs("div",{className:"flex items-start justify-between border-b border-border p-6",children:[e.jsxs("div",{children:[e.jsx(P,{className:"font-mono text-sm font-medium uppercase tracking-widest text-foreground",children:r("variables.editDialog.title","Edit Variable")}),e.jsx(L,{className:"mt-1 text-sm font-light text-muted-foreground",children:r("variables.editDialog.description","Update the variable properties")})]}),e.jsxs($,{className:"text-muted-foreground transition-colors hover:text-foreground",children:[e.jsx(V,{className:"h-5 w-5"}),e.jsx("span",{className:"sr-only",children:"Close"})]})]}),e.jsxs("form",{onSubmit:b,children:[e.jsx(K,{keyValue:a,onKeyChange:o,label:x,onLabelChange:p,defaultValue:c,onDefaultValueChange:l,description:i,onDescriptionChange:u,idPrefix:"edit-injectable"}),e.jsxs("div",{className:"flex justify-end gap-3 border-t border-border p-6",children:[e.jsx("button",{type:"button",onClick:()=>n(!1),disabled:d.isPending,className:"rounded-none border border-border bg-background px-6 py-2.5 font-mono text-xs uppercase tracking-wider text-muted-foreground transition-colors hover:border-foreground hover:text-foreground disabled:opacity-50",children:r("common.cancel","Cancel")}),e.jsx("button",{type:"submit",disabled:!m||d.isPending,className:"rounded-none bg-foreground px-6 py-2.5 font-mono text-xs uppercase tracking-wider text-background transition-colors hover:bg-foreground/90 disabled:opacity-50",children:d.isPending?r("common.saving","Saving..."):r("common.save","Save Changes")})]})]})]})})}const je=10,ve=.05;function ye({injectable:t,index:n=0,onEdit:s,onDelete:r}){const{t:a}=h(),{hasPermission:o}=O(),x=o(S.INJECTABLE_EDIT),p=o(S.INJECTABLE_DELETE),c=o(S.INJECTABLE_TOGGLE_STATUS),l=pe(),i=ge();async function u(){t.isActive?await i.mutateAsync(t.id):await l.mutateAsync(t.id)}const d=l.isPending||i.isPending,b=n<je,m=b?n*ve:0;return e.jsxs(M.tr,{initial:b?{opacity:0,x:20}:void 0,animate:{opacity:1,x:0},transition:{duration:.2,ease:"easeOut",delay:m},className:"group transition-colors hover:bg-accent",children:[e.jsx("td",{className:"border-b border-border py-5 pl-4 pr-4 align-middle",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(B,{className:"text-role transition-colors shrink-0",size:18}),e.jsxs(k,{children:[e.jsx(C,{asChild:!0,children:e.jsx("span",{className:"block max-w-[140px] truncate font-mono text-sm text-foreground",children:t.key})}),e.jsx(D,{side:"top",children:e.jsx("span",{className:"font-mono text-sm",children:t.key})})]})]})}),e.jsx("td",{className:"border-b border-border py-5 align-middle",children:e.jsxs(k,{children:[e.jsx(C,{asChild:!0,children:e.jsx("span",{className:"block max-w-[180px] truncate text-sm text-foreground",children:t.label})}),e.jsx(D,{side:"top",children:t.label})]})}),e.jsx("td",{className:"border-b border-border py-5 align-middle",children:t.description?e.jsxs(k,{children:[e.jsx(C,{asChild:!0,children:e.jsx("span",{className:"block max-w-[140px] truncate text-sm text-muted-foreground",children:t.description})}),e.jsx(D,{side:"top",className:"max-w-xs",children:t.description})]}):e.jsx("span",{className:"text-sm text-muted-foreground",children:"-"})}),e.jsx("td",{className:"border-b border-border py-5 align-middle",children:t.defaultValue?e.jsxs(k,{children:[e.jsx(C,{asChild:!0,children:e.jsx("span",{className:"block max-w-[100px] truncate font-mono text-sm text-foreground",children:t.defaultValue})}),e.jsx(D,{side:"top",className:"max-w-xs",children:e.jsx("span",{className:"font-mono text-sm",children:t.defaultValue})})]}):e.jsx("span",{className:"font-mono text-sm text-muted-foreground",children:"-"})}),e.jsx("td",{className:"border-b border-border py-5 align-middle",children:e.jsxs("span",{className:F("inline-flex items-center gap-1.5 font-mono text-xs uppercase tracking-wider",t.isActive?"text-green-600":"text-muted-foreground"),children:[e.jsx("span",{className:F("h-1.5 w-1.5 rounded-full",t.isActive?"bg-green-500":"bg-muted-foreground")}),t.isActive?a("variables.active","Active"):a("variables.inactive","Inactive")]})}),e.jsx("td",{className:"border-b border-border py-4 pr-4 align-middle",children:e.jsx("div",{className:"flex items-center justify-center",children:e.jsxs(H,{children:[e.jsx(Q,{asChild:!0,children:e.jsx("button",{className:"text-muted-foreground transition-colors hover:text-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",children:e.jsx(Z,{size:20})})}),e.jsxs(X,{align:"end",children:[x&&e.jsxs(E,{onClick:s,children:[e.jsx(ee,{className:"mr-2 h-4 w-4"}),a("common.edit","Edit")]}),c&&e.jsx(E,{onClick:u,disabled:d,children:t.isActive?e.jsxs(e.Fragment,{children:[e.jsx(te,{className:"mr-2 h-4 w-4"}),a("variables.deactivate","Deactivate")]}):e.jsxs(e.Fragment,{children:[e.jsx(se,{className:"mr-2 h-4 w-4"}),a("variables.activate","Activate")]})}),p&&e.jsxs(e.Fragment,{children:[e.jsx(Y,{}),e.jsxs(E,{onClick:r,className:"text-destructive focus:text-destructive",children:[e.jsx(ae,{className:"mr-2 h-4 w-4"}),a("common.delete","Delete")]})]})]})]})})})]})}function Ne({injectables:t,onEdit:n,onDelete:s}){const{t:r}=h();return e.jsxs("table",{className:"w-full border-collapse text-left",children:[e.jsx("thead",{className:"sticky top-0 z-10 bg-background",children:e.jsxs("tr",{children:[e.jsx("th",{className:"w-[25%] border-b border-border py-4 pl-4 font-mono text-[10px] font-normal uppercase tracking-widest text-muted-foreground",children:r("variables.columns.key","Variable Key")}),e.jsx("th",{className:"w-[30%] border-b border-border py-4 font-mono text-[10px] font-normal uppercase tracking-widest text-muted-foreground",children:r("variables.columns.label","Display Label")}),e.jsx("th",{className:"w-[20%] border-b border-border py-4 font-mono text-[10px] font-normal uppercase tracking-widest text-muted-foreground",children:r("variables.columns.description","Description")}),e.jsx("th",{className:"w-[15%] border-b border-border py-4 font-mono text-[10px] font-normal uppercase tracking-widest text-muted-foreground",children:r("variables.columns.defaultValue","Default Value")}),e.jsx("th",{className:"w-[10%] border-b border-border py-4 font-mono text-[10px] font-normal uppercase tracking-widest text-muted-foreground",children:r("variables.columns.status","Status")}),e.jsx("th",{className:"w-[10%] border-b border-border py-4 pr-4 font-mono text-[10px] font-normal uppercase tracking-widest text-muted-foreground",children:e.jsx("div",{className:"flex items-center justify-center",children:r("variables.columns.action","Action")})})]})}),e.jsx("tbody",{className:"font-light",children:t.map((a,o)=>e.jsx(ye,{injectable:a,index:o,onEdit:()=>n(a),onDelete:()=>s(a)},a.id))})]})}function we(){const{t}=h(),{currentWorkspace:n}=q(),{hasPermission:s}=O(),r=s(S.INJECTABLE_CREATE),{data:a,isLoading:o}=de((n==null?void 0:n.id)??null),[x,p]=g.useState(!1),[c,l]=g.useState(null),[i,u]=g.useState(!1),[d,b]=g.useState(!1);function m(f){l(f),u(!0)}function y(f){l(f),b(!0)}return e.jsxs(M.div,{className:"animate-page-enter flex h-full flex-1 flex-col bg-background",children:[e.jsx("header",{className:"shrink-0 px-4 pb-6 pt-12 md:px-6 lg:px-6",children:e.jsxs("div",{className:"flex flex-col justify-between gap-6 md:flex-row md:items-end",children:[e.jsxs("div",{children:[e.jsx("div",{className:"mb-1 font-mono text-[10px] uppercase tracking-widest text-muted-foreground",children:t("variables.header","Workspace")}),e.jsx("h1",{className:"font-display text-4xl font-light leading-tight tracking-tight text-foreground md:text-5xl",children:t("variables.title","Variables")})]}),r&&e.jsxs("button",{onClick:()=>p(!0),className:"group flex h-12 items-center gap-2 rounded-none bg-foreground px-6 text-sm font-medium tracking-wide text-background shadow-lg shadow-muted transition-colors hover:bg-foreground/90",children:[e.jsx(_,{size:20}),e.jsx("span",{children:t("variables.create","CREATE VARIABLE")})]})]})}),e.jsxs("div",{className:"flex-1 overflow-y-auto px-4 pb-12 md:px-6 lg:px-6",children:[o&&e.jsx("div",{className:"space-y-4 pt-6",children:[...Array(5)].map((f,z)=>e.jsx(G,{className:"h-16 w-full"},z))}),!o&&(!a||a.length===0)&&e.jsxs("div",{className:"flex flex-col items-center justify-center py-20 text-center",children:[e.jsx("div",{className:"mb-4 flex h-16 w-16 items-center justify-center rounded-full bg-muted/50",children:e.jsx(B,{size:32,className:"text-muted-foreground"})}),e.jsx("p",{className:"text-lg text-muted-foreground",children:t("variables.empty","No variables defined yet")}),e.jsx("p",{className:"mt-2 text-sm text-muted-foreground/70",children:t("variables.emptyHint","Create your first variable to use in templates")}),r&&e.jsxs("button",{onClick:()=>p(!0),className:"mt-6 flex items-center gap-2 border-b border-transparent pb-0.5 font-mono text-xs uppercase tracking-widest text-muted-foreground transition-colors hover:border-foreground hover:text-foreground",children:[e.jsx(_,{size:16}),t("variables.create","Create Variable")]})]}),!o&&a&&a.length>0&&e.jsx(Ne,{injectables:a,onEdit:m,onDelete:y})]}),e.jsx(be,{open:x,onOpenChange:p}),e.jsx(he,{open:i,onOpenChange:u,injectable:c},(c==null?void 0:c.id)??"new"),e.jsx(fe,{open:d,onOpenChange:b,injectable:c})]})}const Fe=we;export{Fe as component};
