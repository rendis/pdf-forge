import{u as C,b as N,r as l,j as e,e as S,X as V}from"./index-DLKA0qzp.js";import{R as A,P as L,O as F,C as P,T as z,D as E,a as R}from"./index-2wdrRtIR.js";import{f as $,g as W,D as X,T as q,h as B}from"./DocumentTypeConflictDialog-CoGT7lQ1.js";import{a as G,D as H}from"./templates-api-CWMPjD60.js";import{u as J}from"./dropdown-menu-CM6ykDne.js";function Y({open:y,onOpenChange:c,folderId:I}){const{t:a}=J(),j=C(),{currentWorkspace:m}=N(),[p,x]=l.useState(""),[u,b]=l.useState([]),[r,h]=l.useState(null),[i,o]=l.useState(!1),[s,d]=l.useState({open:!1,conflict:null,pendingTemplateId:null,pendingVersionId:null}),D=$(),g=W(),v=l.useCallback(t=>{t&&(x(""),b([]),h(null),o(!1),d({open:!1,conflict:null,pendingTemplateId:null,pendingVersionId:null})),c(t)},[c]),T=(t,n)=>{m&&(c(!1),j({to:"/workspace/$workspaceId/editor/$templateId/version/$versionId",params:{workspaceId:m.id,templateId:t,versionId:n}}))},w=async t=>{if(t.preventDefault(),!(!p.trim()||!m||i)){o(!0);try{const n=await D.mutateAsync({title:p.trim(),folderId:I??void 0,isPublicLibrary:!1});if(u.length>0&&await G(n.template.id,u),r)try{await g.mutateAsync({templateId:n.template.id,data:{documentTypeId:r}})}catch(f){if(f instanceof H){d({open:!0,conflict:f.conflict,pendingTemplateId:n.template.id,pendingVersionId:n.initialVersion.id}),o(!1);return}throw f}T(n.template.id,n.initialVersion.id)}catch{o(!1)}}},k=async()=>{if(!(!s.pendingTemplateId||!s.pendingVersionId||!r)){o(!0);try{await g.mutateAsync({templateId:s.pendingTemplateId,data:{documentTypeId:r,force:!0}}),d({open:!1,conflict:null,pendingTemplateId:null,pendingVersionId:null}),T(s.pendingTemplateId,s.pendingVersionId)}catch{d({open:!1,conflict:null,pendingTemplateId:null,pendingVersionId:null}),o(!1)}}};return e.jsxs(e.Fragment,{children:[e.jsx(A,{open:y,onOpenChange:v,children:e.jsxs(L,{children:[e.jsx(F,{className:"fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0"}),e.jsxs(P,{className:S("fixed left-[50%] top-[50%] z-50 w-full max-w-lg translate-x-[-50%] translate-y-[-50%] border border-border bg-background p-0 shadow-lg duration-200","data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95"),children:[e.jsxs("div",{className:"flex items-start justify-between border-b border-border p-6",children:[e.jsxs("div",{children:[e.jsx(z,{className:"font-mono text-sm font-medium uppercase tracking-widest text-foreground",children:a("templates.createDialog.title","New Template")}),e.jsx(E,{className:"mt-1 text-sm font-light text-muted-foreground",children:a("templates.createDialog.description","Create a new document template")})]}),e.jsxs(R,{className:"text-muted-foreground transition-colors hover:text-foreground",children:[e.jsx(V,{className:"h-5 w-5"}),e.jsx("span",{className:"sr-only",children:"Close"})]})]}),e.jsxs("form",{onSubmit:w,children:[e.jsxs("div",{className:"space-y-6 p-6",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"template-title",className:"mb-2 block font-mono text-[10px] font-medium uppercase tracking-widest text-muted-foreground",children:a("templates.createDialog.titleLabel","Title")}),e.jsx("input",{id:"template-title",type:"text",value:p,onChange:t=>x(t.target.value),placeholder:a("templates.createDialog.titlePlaceholder","Enter template title..."),maxLength:255,autoFocus:!0,className:"w-full rounded-none border-0 border-b border-border bg-transparent py-2 text-base font-light text-foreground outline-none transition-all placeholder:text-muted-foreground/50 focus-visible:border-foreground focus-visible:ring-0"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-2 block font-mono text-[10px] font-medium uppercase tracking-widest text-muted-foreground",children:a("templates.createDialog.documentTypeLabel","Document Type")}),e.jsx(X,{currentTypeId:r,currentTypeName:null,onAssign:async t=>h(t),disabled:i})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-2 block font-mono text-[10px] font-medium uppercase tracking-widest text-muted-foreground",children:a("templates.createDialog.tagsLabel","Tags")}),e.jsx(q,{selectedTagIds:u,onSelectionChange:b})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 border-t border-border p-6",children:[e.jsx("button",{type:"button",onClick:()=>c(!1),disabled:i,className:"rounded-none border border-border bg-background px-6 py-2.5 font-mono text-xs uppercase tracking-wider text-muted-foreground transition-colors hover:border-foreground hover:text-foreground disabled:opacity-50",children:a("common.cancel","Cancel")}),e.jsx("button",{type:"submit",disabled:!p.trim()||i,className:"rounded-none bg-foreground px-6 py-2.5 font-mono text-xs uppercase tracking-wider text-background transition-colors hover:bg-foreground/90 disabled:opacity-50",children:i?a("common.creating","Creating..."):a("templates.createDialog.submit","Create Template")})]})]})]})]})}),e.jsx(B,{open:s.open,conflictTemplate:s.conflict,onCancel:()=>{d({open:!1,conflict:null,pendingTemplateId:null,pendingVersionId:null}),o(!1)},onForce:k,isLoading:g.isPending})]})}export{Y as C};
