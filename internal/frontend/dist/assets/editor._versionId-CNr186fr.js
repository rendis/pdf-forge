import{j as e,ab as A,r as t,w as P}from"./index-Mn5rH39a.js";import{u as R,a as g,D as F,P as T,e as V,i as L,S as $,b as M}from"./document-import-YMSYuGQ_.js";import{B as b}from"./button-CtHMO38A.js";import"./badge-XElsizj0.js";import"./label-D8fNF-db.js";import"./select-DSwL33K2.js";import{u as w}from"./dropdown-menu-C1xsa6LN.js";import{D as U,d as _,e as q,a as z,T as f,b as B,f as G}from"./dialog-CBYldx3V.js";import{S as H}from"./scroll-area-Dx2yCiC8.js";import{C as j}from"./circle-alert-Ch1xiGPV.js";import{d as v}from"./send-Bdk5dTqX.js";import{A as O}from"./arrow-left-Day3Qwk4.js";import"./index-UXmO5FXU.js";import"./index-wkqwAxKy.js";import"./file-text-CKr7-iIO.js";import"./chevron-left-CiKzdUFh.js";import"./chevron-down-BYG9_VU0.js";import"./plus-Cfv6BkAk.js";import"./trash-2-DIs6o-B7.js";import"./list-BghAqgvZ.js";import"./ellipsis-D73O4n5e.js";import"./square-check-big-8fkl3Uv1.js";import"./variable-D6VysuzC.js";import"./search-C-KX9vCT.js";import"./arrow-right-DhIx3wpO.js";import"./layers-DKfqMMQV.js";import"./i18n-iWqPoxY8.js";import"./clock-CVM06wH-.js";import"./folder-open-GvK6pB0S.js";import"./power-Dk5SRhDU.js";import"./square-pen-DfjEwFam.js";import"./trash-Bl9M9p3A.js";import"./index-DEI3p7AC.js";import"./index-BdQq_4o_.js";function W({open:p,onOpenChange:a,validation:r,onConfirm:d}){const{t:u}=w(),o=r.errors.length>0,i=r.warnings.length>0;return e.jsx(U,{open:p,onOpenChange:a,children:e.jsxs(_,{className:"max-w-2xl max-h-[80vh]",children:[e.jsxs(q,{children:[e.jsx(z,{className:"flex items-center gap-2",children:o?e.jsxs(e.Fragment,{children:[e.jsx(j,{className:"h-5 w-5 text-destructive"}),"Errores de Validaci贸n"]}):i?e.jsxs(e.Fragment,{children:[e.jsx(f,{className:"h-5 w-5 text-warning"}),"Advertencias de Importaci贸n"]}):e.jsxs(e.Fragment,{children:[e.jsx(v,{className:"h-5 w-5 text-success"}),"Validaci贸n Exitosa"]})}),e.jsx(B,{children:o?"El documento tiene errores cr铆ticos que deben corregirse antes de importar.":i?"El documento tiene advertencias no cr铆ticas. Puedes importarlo de todas formas.":"El documento es v谩lido y est谩 listo para importar."})]}),e.jsx(H,{className:"max-h-[60vh]",children:e.jsxs("div",{className:"space-y-4 pr-4",children:[o&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("h4",{className:"text-sm font-semibold text-destructive flex items-center gap-2",children:[e.jsx(j,{className:"h-4 w-4"}),"Errores (",r.errors.length,")"]}),e.jsx("div",{className:"space-y-2",children:r.errors.map((s,c)=>e.jsx("div",{className:"p-3 bg-destructive/10 border border-destructive/20 rounded-md",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(j,{className:"h-4 w-4 text-destructive mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-destructive",children:s.message}),s.path&&e.jsxs("p",{className:"text-xs text-muted-foreground mt-1 font-mono",children:["Ubicaci贸n: ",s.path]}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["C贸digo: ",s.code]})]})]})},c))})]}),i&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("h4",{className:"text-sm font-semibold text-yellow-600 flex items-center gap-2",children:[e.jsx(f,{className:"h-4 w-4"}),"Advertencias (",r.warnings.length,")"]}),e.jsx("div",{className:"space-y-2",children:r.warnings.map((s,c)=>e.jsx("div",{className:"p-3 bg-yellow-500/10 border border-yellow-500/20 rounded-md",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(f,{className:"h-4 w-4 text-yellow-600 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-yellow-700 dark:text-yellow-400",children:s.message}),s.path&&e.jsxs("p",{className:"text-xs text-muted-foreground mt-1 font-mono",children:["Ubicaci贸n: ",s.path]}),s.suggestion&&e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[" ",s.suggestion]}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["C贸digo: ",s.code]})]})]})},c))})]}),!o&&!i&&e.jsx("div",{className:"p-4 bg-success-muted border border-success-border rounded-md",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(v,{className:"h-5 w-5 text-success"}),e.jsx("p",{className:"text-sm text-success-foreground",children:"El documento pas贸 todas las validaciones correctamente."})]})})]})}),e.jsxs(G,{className:"gap-2",children:[e.jsx(b,{variant:"outline",onClick:()=>a(!1),children:o?"Cerrar":"Cancelar"}),!o&&e.jsx(b,{onClick:d,children:i?"Importar de todas formas":"Importar"})]})]})})}function Ie(){const{workspaceId:p,versionId:a}=A.useParams(),{t:r}=w(),[d,u]=t.useState(!1),{variables:o}=R(),[i,s]=t.useState(!1),[c,N]=t.useState(null),m=t.useRef(null);t.useEffect(()=>{g.setState({pageSize:T.A4,margins:F})},[]);const x=t.useRef("<p>Comienza a escribir tu documento aqui...</p>"),C=t.useCallback(n=>{x.current=n},[]),S=t.useCallback(async()=>{u(!0);try{console.log("Saving content for version:",a),console.log("Content:",x.current),await new Promise(n=>setTimeout(n,500))}finally{u(!1)}},[a]),k=t.useCallback(()=>{if(!m.current)return;const n=m.current,h={pagination:g.getState()},l={title:`Version ${a}`,language:"es"},D=`documento-${a}-${Date.now()}.json`;V(n,h,l,D)},[a]),y=t.useCallback(async()=>{if(!m.current)return;const n=m.current,h={pagination:g.getState()},l=await L(n,h,o,{validateReferences:!0,autoMigrate:!0});if(l){if(l.validation.errors.length>0||l.validation.warnings.length>0){N(l),s(!0);return}n&&(x.current=n.getHTML())}},[o]),E=t.useCallback(()=>{s(!1),N(null)},[]);return e.jsxs("div",{className:"flex flex-col h-screen",children:[e.jsxs("header",{className:"flex items-center justify-between px-4 py-2 border-b bg-card",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(P,{to:"/workspace/$workspaceId/templates",params:{workspaceId:p},children:e.jsxs("button",{className:"rounded-none border border-border bg-background px-6 py-2.5 font-mono text-xs uppercase tracking-wider text-muted-foreground transition-colors hover:border-foreground hover:text-foreground flex items-center",children:[e.jsx(O,{className:"mr-2 h-4 w-4"}),r("common.back")]})}),e.jsxs("span",{className:"text-sm text-muted-foreground font-mono",children:["Version: ",a]})]}),e.jsxs("button",{onClick:S,disabled:d,className:"rounded-none bg-foreground px-6 py-2.5 font-mono text-xs uppercase tracking-wider text-background transition-colors hover:bg-foreground/90 disabled:opacity-50 flex items-center",children:[e.jsx($,{className:"mr-2 h-4 w-4"}),r(d?"common.saving":"common.save")]})]}),e.jsx("div",{className:"flex-1 overflow-hidden",children:e.jsx(M,{initialContent:x.current,onContentChange:C,variables:o,onExport:k,onImport:y,editorRef:m},"editor")}),c&&e.jsx(W,{open:i,onOpenChange:s,validation:c.validation,onConfirm:E})]})}export{Ie as component};
