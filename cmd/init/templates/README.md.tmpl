# {{.ProjectName}}

Built with [pdf-forge](https://github.com/rendis/pdf-forge) — multi-tenant PDF template engine powered by Typst.

## Quick Start

```bash
# Check dependencies
make doctor

# Run locally (auto-embeds frontend on first run if Node.js + pnpm available)
make migrate
make run

# Or start with Docker (full stack with frontend)
docker compose up --build
```

- **API**: http://localhost:8080
- **Frontend**: http://localhost:8080 (after auto-embed or via Docker)

## Commands

```bash
make help         # Show all available commands
make run          # Run server (auto-embeds frontend if missing)
make dev          # Hot reload with air (auto-embeds frontend if missing)
make migrate      # Apply database migrations
make embed-app    # Build and embed frontend (requires Node.js + pnpm)
make build        # Build production binary
make test         # Run tests
make docker-up    # Start full stack (postgres + api + frontend)
make doctor       # Check system dependencies
```

## Project Structure

```
├── main.go                 # Entrypoint (sdk.New + extensions.Register + engine.Run)
├── extensions/
│   ├── register.go         # Register your injectors, mapper, middleware, hooks
│   ├── injectors/          # Custom injector implementations
│   ├── mapper.go           # Transform render request payloads
│   ├── init.go             # Shared setup before injectors run
│   ├── provider.go         # Dynamic workspace-specific injectables
│   ├── auth.go             # Custom render endpoint authentication
│   └── middleware.go       # HTTP middleware
├── settings/
│   └── app.yaml            # Configuration (override with DOC_ENGINE_* env vars)
├── Makefile                # Development commands
├── Dockerfile              # Multi-stage build (frontend + backend)
└── docker-compose.yaml     # Full stack: postgres + api
```

## Frontend

The frontend is auto-embedded on `make run` / `make dev` if Node.js and pnpm are installed.
You can also embed it manually or use Docker:

```bash
# Explicit embed (also triggered automatically by make run/dev)
make embed-app

# Pin a specific pdf-forge version
make embed-app PDF_FORGE_VERSION=v1.2.0

# With a custom base path
BASE_PATH=/pdf-forge make embed-app
```

Without Node.js/pnpm, use Docker for full stack: `docker compose up --build`.

## Configuration

All settings in `settings/app.yaml` can be overridden with `DOC_ENGINE_*` environment variables.

Key settings:
- `server.port` (default: 8080)
- `database.*` — PostgreSQL connection
- `auth.panel` — OIDC provider (omit for dummy auth)
- `typst.max_concurrent` (default: 20)

## Documentation

- [pdf-forge docs](https://github.com/rendis/pdf-forge/tree/main/core/docs)
- [Extensibility guide](https://github.com/rendis/pdf-forge/blob/main/core/docs/extensibility-guide.md)
- [Configuration reference](https://github.com/rendis/pdf-forge/blob/main/core/docs/configuration.md)
